// koffee 1.4.0
var Action, Quaternion, Vector, _;

_ = require('kxk')._;

Quaternion = require('./lib/quaternion');

Vector = require('./lib/vector');

Action = (function() {
    Action.NOOP = 0;

    Action.ROTATE = 1;

    Action.FLY = 2;

    Action.TOGGLE = 3;

    Action.FALL = 4;

    Action.PUSH = 5;

    Action.EXPLODE = 6;

    Action.IMPLODE = 7;

    Action.FORWARD = 8;

    Action.CLIMB_UP = 9;

    Action.CLIMB_DOWN = 10;

    Action.TURN_LEFT = 11;

    Action.TURN_RIGHT = 12;

    Action.JUMP = 13;

    Action.JUMP_FORWARD = 14;

    Action.FALL_FORWARD = 15;

    Action.SHOOT = 16;

    Action.LOOK_UP = 17;

    Action.LOOK_DOWN = 18;

    Action.LOOK_RESET = 19;

    Action.TUCKER = 20;

    Action.SHOW = 1;

    Action.HIDE = 2;

    Action.DELETE = 3;

    Action.ONCE = 0;

    Action.CONTINUOUS = 1;

    Action.REPEAT = 2;

    Action.TIMED = 3;

    function Action(o, i, n, d, m) {
        var ref, ref1, ref2;
        if (_.isPlainObject(o)) {
            i = (ref = o.id) != null ? ref : -1;
            n = o.name;
            d = (ref1 = o.duration) != null ? ref1 : 0;
            m = (ref2 = o.mode) != null ? ref2 : d && Action.TIMED || Action.ONCE;
            o = o.func;
        } else {
            if (i != null) {
                i;
            } else {
                i = -1;
            }
            if (d != null) {
                d;
            } else {
                d = 0;
            }
            if (m != null) {
                m;
            } else {
                m = d && Action.TIMED || Action.ONCE;
            }
        }
        this.object = o;
        this.name = n;
        this.id = i;
        this.mode = m;
        this.duration = d;
        this.event = null;
        this.deleted = false;
        this.reset();
    }

    Action.prototype.del = function() {
        if (this.event != null) {
            this.event.removeAction(this);
        }
        if (this.object != null) {
            this.object.removeAction(this);
        }
        return this.deleted = true;
    };

    Action.prototype.perform = function() {
        if (this.object.performAction != null) {
            return this.object.performAction(this);
        } else if (_.isFunction(this.object)) {
            return this.object(this);
        }
    };

    Action.prototype.init = function() {
        var base;
        return typeof (base = this.object).initAction === "function" ? base.initAction(this) : void 0;
    };

    Action.prototype.finish = function() {
        var base;
        return typeof (base = this.object).finishAction === "function" ? base.finishAction(this) : void 0;
    };

    Action.prototype.finished = function() {
        var ref;
        if ((ref = this.object) != null) {
            if (typeof ref.actionFinished === "function") {
                ref.actionFinished(this);
            }
        }
        if (this.deleted) {
            return;
        }
        return this.reset();
    };

    Action.prototype.atStart = function() {
        return this.current === 0;
    };

    Action.prototype.reset = function() {
        this.start = 0;
        this.rest = 0;
        this.last = 0;
        return this.current = 0;
    };

    Action.prototype.takeOver = function(action) {
        var newPos, oldPos, relOther, relTime, sinFac;
        this.current = action.current;
        this.start = action.start;
        this.last = action.last;
        this.rest = action.rest;
        relOther = action.getRelativeTime();
        relTime = this.getRelativeTime();
        switch (action.id) {
            case Action.FORWARD:
                oldPos = this.object.position.plus(this.object.getDir().mul(relOther));
                break;
            case Action.CLIMB_DOWN:
                oldPos = this.object.position.plus(this.object.getDir().mul((relOther / 0.2) / 2));
                break;
            case Action.JUMP:
                oldPos = this.object.position.plus(this.object.getUp().mul(Math.sin(Math.PI / 2 * relOther)));
        }
        sinFac = Math.sin(Math.PI / 2 * relTime);
        switch (this.id) {
            case Action.JUMP:
                newPos = this.object.position.plus(this.object.getUp().mul(sinFac));
                break;
            case Action.JUMP_FORWARD:
                newPos = this.object.position.plus(this.object.getDir(this.object.new_dir_sgn).mul(relTime).plus(this.object.getUp().mul(sinFac)));
        }
        this.object.takenOffset = newPos.to(oldPos);
        return this.object.takenOrig = newPos.to(oldPos);
    };

    Action.prototype.getRelativeDelta = function() {
        return (this.current - this.last) / this.getDuration();
    };

    Action.prototype.getDuration = function() {
        return world.mapMsTime(this.duration);
    };

    Action.prototype.getRelativeTime = function() {
        var s;
        s = 1 / (16 + this.getDuration());
        return s * (16 + this.current);
    };

    Action.prototype.performWithEvent = function(event) {
        var currentDiff, eventTime, msDur, ref;
        eventTime = event.getTime();
        if (this.start === 0) {
            this.start = eventTime;
            this.current = 0;
            this.rest = 0;
            this.last = 0;
            if (this.mode === Action.ONCE) {
                event.removeAction(this);
            }
            this.perform();
            this.last = this.current;
            if (this.mode === Action.ONCE) {
                return this.finished();
            }
        } else {
            currentDiff = eventTime - this.start;
            msDur = this.getDuration();
            if (currentDiff >= (msDur - 4)) {
                this.current = msDur;
                this.rest = currentDiff - msDur;
                this.perform();
                this.last = 0;
                if (this.mode === Action.CONTINUOUS) {
                    this.current = this.rest;
                    this.start = eventTime;
                    this.last = 0;
                    this.rest = 0;
                    return;
                }
                if ((ref = this.mode) === Action.ONCE || ref === Action.TIMED) {
                    event.removeAction(this);
                }
                this.finish();
                if (this.mode === Action.REPEAT) {
                    if (this.current >= this.getDuration()) {
                        this.reset();
                    }
                    return;
                }
                return event.addFinishedAction(this);
            } else {
                this.current = currentDiff;
                this.perform();
                return this.last = this.current;
            }
        }
    };

    return Action;

})();

module.exports = Action;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQTs7QUFBRSxJQUFNLE9BQUEsQ0FBUSxLQUFSOztBQUVSLFVBQUEsR0FBYSxPQUFBLENBQVEsa0JBQVI7O0FBQ2IsTUFBQSxHQUFhLE9BQUEsQ0FBUSxjQUFSOztBQUVQO0lBRUYsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxNQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsR0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE1BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsSUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE9BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxPQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsT0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFFBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxVQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsU0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFVBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsWUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFlBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxLQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsT0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFNBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxVQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsTUFBRCxHQUFnQjs7SUFFaEIsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsTUFBRCxHQUFnQjs7SUFFaEIsTUFBQyxDQUFBLElBQUQsR0FBYzs7SUFDZCxNQUFD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QUEsSUFBRCxHQUFXLElBQUMsQ0FBQSxRQWhDaEI7YUFyQko7O0lBSmM7Ozs7OztBQTJEdEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDBcbiMgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4jIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMFxuIyAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcblxueyBfIH0gPSByZXF1aXJlICdreGsnXG5cblF1YXRlcm5pb24gPSByZXF1aXJlICcuL2xpYi9xdWF0ZXJuaW9uJ1xuVmVjdG9yICAgICA9IHJlcXVpcmUgJy4vbGliL3ZlY3RvcidcblxuY2xhc3MgQWN0aW9uXG4gICAgXG4gICAgQE5PT1AgICAgICAgICA9IDBcbiAgICBAUk9UQVRFICAgICAgID0gMSAjIHN3aXRjaCwgZ2F0ZSwgYm9tYlxuICAgIEBGTFkgICAgICAgICAgPSAyICMgYnVsbGV0XG4gICAgQFRPR0dMRSAgICAgICA9IDMgIyBzd2l0Y2gsIGdhdGVcbiAgICBARkFMTCAgICAgICAgID0gNCAjIHB1c2hhYmxlXG4gICAgQFBVU0ggICAgICAgICA9IDUgIyBwdXNoYWJsZVxuICAgIEBFWFBMT0RFICAgICAgPSA2ICMgYm9tYlxuICAgIEBJTVBMT0RFICAgICAgPSA3ICMgYm9tYlxuICAgIEBGT1JXQVJEICAgICAgPSA4ICMgYm90XG4gICAgQENMSU1CX1VQICAgICA9IDkgIyBib3RcbiAgICBAQ0xJTUJfRE9XTiAgID0gMTAgIyAuLi5cbiAgICBAVFVSTl9MRUZUICAgID0gMTFcbiAgICBAVFVSTl9SSUdIVCAgID0gMTJcbiAgICBASlVNUCAgICAgICAgID0gMTNcbiAgICBASlVNUF9GT1JXQVJEID0gMTRcbiAgICBARkFMTF9GT1JXQVJEID0gMTVcbiAgICBAU0hPT1QgICAgICAgID0gMTZcbiAgICBATE9PS19VUCAgICAgID0gMTdcbiAgICBATE9PS19ET1dOICAgID0gMThcbiAgICBATE9PS19SRVNFVCAgID0gMTlcbiAgICBAVFVDS0VSICAgICAgID0gMjBcbiAgICBcbiAgICBAU0hPVyAgICAgICAgID0gMVxuICAgIEBISURFICAgICAgICAgPSAyXG4gICAgQERFTEVURSAgICAgICA9IDNcbiAgICBcbiAgICBAT05DRSAgICAgICA9IDBcbiAgICBAQ09OVElOVU9VUyA9IDFcbiAgICBAUkVQRUFUICAgICA9IDJcbiAgICBAVElNRUQgICAgICA9IDNcblxuICAgIEA6IChvLCBpLCBuLCBkLCBtKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgXy5pc1BsYWluT2JqZWN0IG8gXG4gICAgICAgICAgICBpID0gby5pZCA/IC0xXG4gICAgICAgICAgICBuID0gby5uYW1lXG4gICAgICAgICAgICBkID0gby5kdXJhdGlvbiA/IDBcbiAgICAgICAgICAgIG0gPSBvLm1vZGUgPyAoZCBhbmQgQWN0aW9uLlRJTUVEIG9yIEFjdGlvbi5PTkNFKVxuICAgICAgICAgICAgbyA9IG8uZnVuY1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpID89IC0xXG4gICAgICAgICAgICBkID89IDBcbiAgICAgICAgICAgIG0gPz0gKGQgYW5kIEFjdGlvbi5USU1FRCBvciBBY3Rpb24uT05DRSlcblxuICAgICAgICBAb2JqZWN0ICAgICA9IG9cbiAgICAgICAgQG5hbWUgICAgICAgPSBuXG4gICAgICAgIEBpZCAgICAgICAgID0gaVxuICAgICAgICBAbW9kZSAgICAgICA9IG1cbiAgICAgICAgQGR1cmF0aW9uICAgPSBkXG4gICAgICAgIEBldmVudCAgICAgID0gbnVsbFxuICAgICAgICBAZGVsZXRlZCAgICA9IGZhbHNlXG4gICAgICAgIEByZXNldCgpXG5cbiAgICBkZWw6IC0+XG4gICAgICAgICMga2xvZyBcIkFjdGlvbi5kZWwgI3tAbmFtZX0gI3tAZXZlbnQ/fSAje0BvYmplY3Q/fVwiXG4gICAgICAgIGlmIEBldmVudD8gIHRoZW4gQGV2ZW50LnJlbW92ZUFjdGlvbiBAXG4gICAgICAgIGlmIEBvYmplY3Q/IHRoZW4gQG9iamVjdC5yZW1vdmVBY3Rpb24gQFxuICAgICAgICBAZGVsZXRlZCA9IHRydWVcblxuICAgIHBlcmZvcm06IC0+IFxuICAgICAgICAjIGtsb2cgXCJBY3Rpb24ucGVyZm9ybSAje0BuYW1lfSBhY3Rpb24/ICN7QG9iamVjdC5wZXJmb3JtQWN0aW9uP30gI3tAb2JqZWN0Lm5hbWV9XCIgaWYgbm90IEBuYW1lIGluICBbJ25vb3AnLCAncm90YXRpb24nXVxuICAgICAgICBpZiBAb2JqZWN0LnBlcmZvcm1BY3Rpb24/IFxuICAgICAgICAgICAgQG9iamVjdC5wZXJmb3JtQWN0aW9uIEBcbiAgICAgICAgZWxzZSBpZiBfLmlzRnVuY3Rpb24gQG9iamVjdFxuICAgICAgICAgICAgQG9iamVjdCBAXG4gICAgXG4gICAgaW5pdDogLT4gICAgQG9iamVjdC5pbml0QWN0aW9uPyBAXG4gICAgZmluaXNoOiAtPiAgQG9iamVjdC5maW5pc2hBY3Rpb24/IEBcbiAgICBmaW5pc2hlZDogLT4gXG4gICAgICAgICMga2xvZyBcIkFjdGlvbi5maW5pc2hlZCAje0BuYW1lfSAje0BvYmplY3Q/LmFjdGlvbkZpbmlzaGVkPyBhbmQgJy4nIG9yICd1bmZpbmlzaGVkJ31cIlxuICAgICAgICBAb2JqZWN0Py5hY3Rpb25GaW5pc2hlZD8gQFxuICAgICAgICByZXR1cm4gaWYgQGRlbGV0ZWRcbiAgICAgICAgQHJlc2V0KClcblxuICAgIGF0U3RhcnQ6IC0+IEBjdXJyZW50ID09IDBcbiAgICAgICAgXG4gICAgcmVzZXQ6IC0+XG4gICAgICAgICMga2xvZyBcImFjdGlvbi5yZXNldCAje0BuYW1lfVwiXG4gICAgICAgIEBzdGFydCAgICA9IDAgIyB3b3JsZCB0aW1lXG4gICAgICAgIEByZXN0ICAgICA9IDAgXG4gICAgICAgIEBsYXN0ICAgICA9IDAgIyByZWxhdGl2ZSAobXMgc2luY2UgQHN0YXJ0KVxuICAgICAgICBAY3VycmVudCAgPSAwICMgcmVsYXRpdmUgKG1zIHNpbmNlIEBzdGFydClcblxuICAgIHRha2VPdmVyOiAoYWN0aW9uKSAtPlxuXG4gICAgICAgIEBjdXJyZW50ICA9IGFjdGlvbi5jdXJyZW50XG4gICAgICAgIEBzdGFydCAgICA9IGFjdGlvbi5zdGFydFxuICAgICAgICBAbGFzdCAgICAgPSBhY3Rpb24ubGFzdFxuICAgICAgICBAcmVzdCAgICAgPSBhY3Rpb24ucmVzdFxuXG4gICAgICAgIHJlbE90aGVyICA9IGFjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKVxuICAgICAgICByZWxUaW1lICAgPSBAZ2V0UmVsYXRpdmVUaW1lKClcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBhY3Rpb24uaWRcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkZPUldBUkRcbiAgICAgICAgICAgICAgICBvbGRQb3MgPSBAb2JqZWN0LnBvc2l0aW9uLnBsdXMgQG9iamVjdC5nZXREaXIoKS5tdWwgcmVsT3RoZXJcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkNMSU1CX0RPV05cbiAgICAgICAgICAgICAgICBvbGRQb3MgPSBAb2JqZWN0LnBvc2l0aW9uLnBsdXMgQG9iamVjdC5nZXREaXIoKS5tdWwgKHJlbE90aGVyLzAuMikvMlxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uSlVNUFxuICAgICAgICAgICAgICAgIG9sZFBvcyA9IEBvYmplY3QucG9zaXRpb24ucGx1cyBAb2JqZWN0LmdldFVwKCkubXVsIE1hdGguc2luIE1hdGguUEkvMiAqIHJlbE90aGVyXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHNpbkZhYyA9IE1hdGguc2luIE1hdGguUEkvMiAqIHJlbFRpbWVcbiAgICAgICAgc3dpdGNoIEBpZFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uSlVNUFxuICAgICAgICAgICAgICAgIG5ld1BvcyA9IEBvYmplY3QucG9zaXRpb24ucGx1cyBAb2JqZWN0LmdldFVwKCkubXVsIHNpbkZhY1xuICAgICAgICAgICAgd2hlbiBBY3Rpb24uSlVNUF9GT1JXQVJEXG4gICAgICAgICAgICAgICAgbmV3UG9zID0gQG9iamVjdC5wb3NpdGlvbi5wbHVzIEBvYmplY3QuZ2V0RGlyKEBvYmplY3QubmV3X2Rpcl9zZ24pLm11bChyZWxUaW1lKS5wbHVzIEBvYmplY3QuZ2V0VXAoKS5tdWwgc2luRmFjIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAb2JqZWN0LnRha2VuT2Zmc2V0ID0gbmV3UG9zLnRvIG9sZFBvc1xuICAgICAgICBAb2JqZWN0LnRha2VuT3JpZyAgID0gbmV3UG9zLnRvIG9sZFBvc1xuXG4gICAgZ2V0UmVsYXRpdmVEZWx0YTogLT4gKEBjdXJyZW50LUBsYXN0KSAvIEBnZXREdXJhdGlvbigpXG4gICAgZ2V0RHVyYXRpb246ICAgICAgLT4gd29ybGQubWFwTXNUaW1lIEBkdXJhdGlvblxuICAgIGdldFJlbGF0aXZlVGltZTogIC0+IFxuICAgIFxuICAgICAgICBzID0gMS8oMTYrQGdldER1cmF0aW9uKCkpXG4gICAgICAgIHMgKiAoMTYrQGN1cnJlbnQpXG5cbiAgICBwZXJmb3JtV2l0aEV2ZW50OiAoZXZlbnQpIC0+XG4gICAgICAgIFxuICAgICAgICBldmVudFRpbWUgPSBldmVudC5nZXRUaW1lKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBzdGFydCA9PSAwXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBzdGFydCAgID0gZXZlbnRUaW1lXG4gICAgICAgICAgICBAY3VycmVudCA9IDBcbiAgICAgICAgICAgIEByZXN0ICAgID0gMFxuICAgICAgICAgICAgQGxhc3QgICAgPSAwXG5cbiAgICAgICAgICAgIGV2ZW50LnJlbW92ZUFjdGlvbiBAIGlmIEBtb2RlID09IEFjdGlvbi5PTkNFXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICMga2xvZyBcIiN7QG5hbWV9IHN0YXJ0ICN7QHN0YXJ0fSAje0BnZXRSZWxhdGl2ZURlbHRhKCl9ICN7QGdldFJlbGF0aXZlVGltZSgpfVwiXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBwZXJmb3JtKClcbiAgICAgICAgICAgIEBsYXN0ID0gQGN1cnJlbnRcbiAgICAgICAgICAgICMgQGZpbmlzaGVkKCkgaWYgQGR1cmF0aW9uID09IDAgYW5kIEBtb2RlID09IEFjdGlvbi5PTkNFXG4gICAgICAgICAgICBAZmluaXNoZWQoKSBpZiBAbW9kZSA9PSBBY3Rpb24uT05DRVxuICAgICAgICAgICAgXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY3VycmVudERpZmYgPSBldmVudFRpbWUgLSBAc3RhcnRcbiAgICAgICAgICAgIG1zRHVyID0gQGdldER1cmF0aW9uKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgY3VycmVudERpZmYgPj0gKG1zRHVyIC0gNCkgIyBhY3Rpb24gKGFsbW9zdCkgZmluaXNoZWRcbiAgICAgICAgICAgICAgICBAY3VycmVudCA9IG1zRHVyXG4gICAgICAgICAgICAgICAgQHJlc3QgICAgPSBjdXJyZW50RGlmZiAtIG1zRHVyXG4gICAgICAgICAgICAgICAgIyBrbG9nIFwiYWN0aW9uICN7bmFtZX0gcGVyZm9ybVdpdGhFdmVudCBzdGFydCAje0BzdGFydH0gcmVzdCAje2N1cnJlbnREaWZmfS0je21zRHVyfSA9ICN7QHJlc3R9XCIgaWYgQG5hbWUgIT0gJ25vb3AnXG4gICAgICAgICAgICAgICAgIyBrbG9nIFwiI3tAbmFtZX0gZW5kICAgI3tAY3VycmVudH0gI3tAZ2V0UmVsYXRpdmVEZWx0YSgpfSAje0BnZXRSZWxhdGl2ZVRpbWUoKX1cIlxuICAgICAgICAgICAgICAgIEBwZXJmb3JtKClcbiAgICAgICAgICAgICAgICBAbGFzdCAgICA9IDBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiBAbW9kZSA9PSBBY3Rpb24uQ09OVElOVU9VU1xuICAgICAgICAgICAgICAgICAgICAjIGtsb2cgXCJhY3Rpb24ucGVyZm9ybVdpdGhFdmVudCAje0BuYW1lfSBtb2RlID09IEFjdGlvbi5DT05USU5VT1VTXCJcbiAgICAgICAgICAgICAgICAgICAgQGN1cnJlbnQgPSBAcmVzdFxuICAgICAgICAgICAgICAgICAgICBAc3RhcnQgPSBldmVudFRpbWVcbiAgICAgICAgICAgICAgICAgICAgQGxhc3QgID0gMFxuICAgICAgICAgICAgICAgICAgICBAcmVzdCAgPSAwXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBldmVudC5yZW1vdmVBY3Rpb24gQCBpZiBAbW9kZSBpbiBbQWN0aW9uLk9OQ0UsIEFjdGlvbi5USU1FRF1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBAZmluaXNoKClcbiAgICBcbiAgICAgICAgICAgICAgICBpZiBAbW9kZSA9PSBBY3Rpb24uUkVQRUFUXG4gICAgICAgICAgICAgICAgICAgIGlmIEBjdXJyZW50ID49IEBnZXREdXJhdGlvbigpICMgaWYga2VlcFJlc3Qgd2Fzbid0IGNhbGxlZCAtPiByZXNldCBzdGFydCBhbmQgY3VycmVudCB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIEByZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGV2ZW50LmFkZEZpbmlzaGVkQWN0aW9uIEBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBAY3VycmVudCA9IGN1cnJlbnREaWZmXG4gICAgICAgICAgICAgICAgIyBrbG9nIFwiI3tAbmFtZX0gICAgICAje0BjdXJyZW50fSAje0BnZXRSZWxhdGl2ZURlbHRhKCl9ICN7QGdldFJlbGF0aXZlVGltZSgpfVwiXG4gICAgICAgICAgICAgICAgQHBlcmZvcm0oKVxuICAgICAgICAgICAgICAgIEBsYXN0ICAgID0gQGN1cnJlbnRcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IEFjdGlvblxuIl19
//# sourceURL=../coffee/action.coffee