// koffee 1.4.0
var Action, _;

_ = require('lodash');

Action = (function() {
    Action.NOOP = 0;

    Action.ROTATE = 1;

    Action.FLY = 2;

    Action.TOGGLE = 3;

    Action.FALL = 4;

    Action.PUSH = 5;

    Action.EXPLODE = 6;

    Action.IMPLODE = 7;

    Action.FORWARD = 8;

    Action.CLIMB_UP = 9;

    Action.CLIMB_DOWN = 10;

    Action.TURN_LEFT = 11;

    Action.TURN_RIGHT = 12;

    Action.JUMP = 13;

    Action.JUMP_FORWARD = 14;

    Action.FALL_FORWARD = 15;

    Action.SHOOT = 16;

    Action.LOOK_UP = 17;

    Action.LOOK_DOWN = 18;

    Action.LOOK_RESET = 19;

    Action.TUCKER = 20;

    Action.SHOW = 1;

    Action.HIDE = 2;

    Action.DELETE = 3;

    Action.ONCE = 0;

    Action.CONTINUOUS = 1;

    Action.REPEAT = 2;

    Action.TIMED = 3;

    function Action(o, i, n, d, m) {
        var ref, ref1, ref2;
        if (_.isPlainObject(o)) {
            i = (ref = o.id) != null ? ref : -1;
            n = o.name;
            d = (ref1 = o.duration) != null ? ref1 : 0;
            m = (ref2 = o.mode) != null ? ref2 : d && Action.TIMED || Action.ONCE;
            o = o.func;
        } else {
            if (i != null) {
                i;
            } else {
                i = -1;
            }
            if (d != null) {
                d;
            } else {
                d = 0;
            }
            if (m != null) {
                m;
            } else {
                m = d && Action.TIMED || Action.ONCE;
            }
        }
        this.object = o;
        this.name = n;
        this.id = i;
        this.mode = m;
        this.duration = d;
        this.event = null;
        this.deleted = false;
        this.reset();
    }

    Action.prototype.del = function() {
        if (this.event != null) {
            this.event.removeAction(this);
        }
        if (this.object != null) {
            this.object.removeAction(this);
        }
        return this.deleted = true;
    };

    Action.prototype.perform = function() {
        if (this.object.performAction != null) {
            return this.object.performAction(this);
        } else if (_.isFunction(this.object)) {
            return this.object(this);
        }
    };

    Action.prototype.init = function() {
        var base;
        return typeof (base = this.object).initAction === "function" ? base.initAction(this) : void 0;
    };

    Action.prototype.finish = function() {
        var base;
        return typeof (base = this.object).finishAction === "function" ? base.finishAction(this) : void 0;
    };

    Action.prototype.finished = function() {
        var ref;
        if ((ref = this.object) != null) {
            if (typeof ref.actionFinished === "function") {
                ref.actionFinished(this);
            }
        }
        if (this.deleted) {
            return;
        }
        return this.reset();
    };

    Action.prototype.reset = function() {
        this.start = 0;
        this.rest = 0;
        this.last = 0;
        return this.current = 0;
    };

    Action.prototype.takeOver = function(action) {
        this.current = action.current;
        this.start = action.start;
        this.last = action.last;
        return this.rest = action.rest;
    };

    Action.prototype.keepRest = function() {
        if (this.rest !== 0) {
            this.current = this.rest;
            return this.rest = 0;
        }
    };

    Action.prototype.getRelativeTime = function() {
        return this.current / this.getDuration();
    };

    Action.prototype.getRelativeDelta = function() {
        return (this.current - this.last) / this.getDuration();
    };

    Action.prototype.getDuration = function() {
        return world.mapMsTime(this.duration);
    };

    Action.prototype.performWithEvent = function(event) {
        var currentDiff, eventTime, msDur, ref;
        eventTime = event.getTime();
        if (this.start === 0) {
            this.start = eventTime;
            this.current = 0;
            this.rest = 0;
            this.last = 0;
            if (this.mode === Action.ONCE) {
                event.removeAction(this);
            }
            this.perform();
            this.last = this.current;
            if (this.mode === Action.ONCE) {
                return this.finished();
            }
        } else {
            currentDiff = eventTime - this.start;
            msDur = this.getDuration();
            if (currentDiff >= msDur) {
                this.current = msDur;
                this.rest = currentDiff - msDur;
                this.perform();
                this.last = 0;
                if (this.mode === Action.CONTINUOUS) {
                    this.current = this.rest;
                    this.start = eventTime;
                    this.last = 0;
                    this.rest = 0;
                    return;
                }
                if ((ref = this.mode) === Action.ONCE || ref === Action.TIMED) {
                    event.removeAction(this);
                }
                this.finish();
                if (this.mode === Action.REPEAT) {
                    if (this.current >= this.getDuration()) {
                        this.reset();
                    }
                    return;
                }
                return event.addFinishedAction(this);
            } else {
                this.current = currentDiff;
                this.perform();
                return this.last = this.current;
            }
        }
    };

    return Action;

})();

module.exports = Action;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQTs7QUFBQSxDQUFBLEdBQU0sT0FBQSxDQUFRLFFBQVI7O0FBRUE7SUFFRixNQUFDLENBQUEsSUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE1BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxHQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsTUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsT0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE9BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxPQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsUUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFVBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxTQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsVUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxZQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsWUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLEtBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxPQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsU0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFVBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxNQUFELEdBQWdCOztJQUVoQixNQUFDLENBQUEsSUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxNQUFELEdBQWdCOztJQUVoQixNQUFDLENBQUEsSUFBRCxHQUFjOztJQUNkLE1BQUMsQ0FBQSxVQUFELEdBQWM7O0lBQ2QsTUFBQyxDQUFBLE1BQUQsR0FBYzs7SUFDZCxNQUFDLENBQUEs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QUNULDJCQU5KOztnQkFPQSxXQUF3QixJQUFDLENBQUEsS0FBRCxLQUFVLE1BQU0sQ0FBQyxJQUFqQixJQUFBLEdBQUEsS0FBdUIsTUFBTSxDQUFDLEtBQXREO29CQUFBLEtBQUssQ0FBQyxZQUFOLENBQW1CLElBQW5CLEVBQUE7O2dCQUVBLElBQUMsQ0FBQSxNQUFELENBQUE7Z0JBRUEsSUFBRyxJQUFDLENBQUEsSUFBRCxLQUFTLE1BQU0sQ0FBQyxNQUFuQjtvQkFDSSxJQUFHLElBQUMsQ0FBQSxPQUFELElBQVksSUFBQyxDQUFBLFdBQUQsQ0FBQSxDQUFmO3dCQUNJLElBQUMsQ0FBQSxLQUFELENBQUEsRUFESjs7QUFFQSwyQkFISjs7dUJBS0EsS0FBSyxDQUFDLGlCQUFOLENBQXdCLElBQXhCLEVBeEJKO2FBQUEsTUFBQTtnQkEwQkksSUFBQyxDQUFBLE9BQUQsR0FBVztnQkFDWCxJQUFDLENBQUEsT0FBRCxDQUFBO3VCQUNBLElBQUMsQ0FBQSxJQUFELEdBQVcsSUFBQyxDQUFBLFFBNUJoQjthQWRKOztJQUhjOzs7Ozs7QUErQ3RCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4jIDAwMDAwMDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDBcbiMgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG5cbl8gICA9IHJlcXVpcmUgJ2xvZGFzaCdcblxuY2xhc3MgQWN0aW9uXG4gICAgXG4gICAgQE5PT1AgICAgICAgICA9IDBcbiAgICBAUk9UQVRFICAgICAgID0gMSAjIHN3aXRjaCwgZ2F0ZSwgYm9tYlxuICAgIEBGTFkgICAgICAgICAgPSAyICMgYnVsbGV0XG4gICAgQFRPR0dMRSAgICAgICA9IDMgIyBzd2l0Y2gsIGdhdGVcbiAgICBARkFMTCAgICAgICAgID0gNCAjIHB1c2hhYmxlXG4gICAgQFBVU0ggICAgICAgICA9IDUgIyBwdXNoYWJsZVxuICAgIEBFWFBMT0RFICAgICAgPSA2ICMgYm9tYlxuICAgIEBJTVBMT0RFICAgICAgPSA3ICMgYm9tYlxuICAgIEBGT1JXQVJEICAgICAgPSA4ICMgYm90XG4gICAgQENMSU1CX1VQICAgICA9IDkgIyBib3RcbiAgICBAQ0xJTUJfRE9XTiAgID0gMTAgIyAuLi5cbiAgICBAVFVSTl9MRUZUICAgID0gMTFcbiAgICBAVFVSTl9SSUdIVCAgID0gMTJcbiAgICBASlVNUCAgICAgICAgID0gMTNcbiAgICBASlVNUF9GT1JXQVJEID0gMTRcbiAgICBARkFMTF9GT1JXQVJEID0gMTVcbiAgICBAU0hPT1QgICAgICAgID0gMTZcbiAgICBATE9PS19VUCAgICAgID0gMTdcbiAgICBATE9PS19ET1dOICAgID0gMThcbiAgICBATE9PS19SRVNFVCAgID0gMTlcbiAgICBAVFVDS0VSICAgICAgID0gMjBcbiAgICBcbiAgICBAU0hPVyAgICAgICAgID0gMVxuICAgIEBISURFICAgICAgICAgPSAyXG4gICAgQERFTEVURSAgICAgICA9IDNcbiAgICBcbiAgICBAT05DRSAgICAgICA9IDBcbiAgICBAQ09OVElOVU9VUyA9IDFcbiAgICBAUkVQRUFUICAgICA9IDJcbiAgICBAVElNRUQgICAgICA9IDNcblxuICAgIGNvbnN0cnVjdG9yOiAobywgaSwgbiwgZCwgbSkgLT4gICAgICAgIFxuICAgICAgICBpZiBfLmlzUGxhaW5PYmplY3QgbyBcbiAgICAgICAgICAgIGkgPSBvLmlkID8gLTFcbiAgICAgICAgICAgIG4gPSBvLm5hbWVcbiAgICAgICAgICAgIGQgPSBvLmR1cmF0aW9uID8gMFxuICAgICAgICAgICAgbSA9IG8ubW9kZSA/IChkIGFuZCBBY3Rpb24uVElNRUQgb3IgQWN0aW9uLk9OQ0UpXG4gICAgICAgICAgICBvID0gby5mdW5jXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGkgPz0gLTFcbiAgICAgICAgICAgIGQgPz0gMFxuICAgICAgICAgICAgbSA/PSAoZCBhbmQgQWN0aW9uLlRJTUVEIG9yIEFjdGlvbi5PTkNFKVxuICAgICAgICAjIGxvZyBcIkFjdGlvbi5jb25zdHJ1Y3RvciAje2l9ICN7bn0gI3tkfSAje219XCJcbiAgICAgICAgQG9iamVjdCAgICAgPSBvXG4gICAgICAgIEBuYW1lICAgICAgID0gblxuICAgICAgICBAaWQgICAgICAgICA9IGlcbiAgICAgICAgQG1vZGUgICAgICAgPSBtXG4gICAgICAgIEBkdXJhdGlvbiAgID0gZFxuICAgICAgICBAZXZlbnQgICAgICA9IG51bGxcbiAgICAgICAgQGRlbGV0ZWQgICAgPSBmYWxzZVxuICAgICAgICBAcmVzZXQoKVxuXG4gICAgZGVsOiAtPlxuICAgICAgICAjIGxvZyBcIkFjdGlvbi5kZWwgI3tAbmFtZX0gI3tAZXZlbnQ/fSAje0BvYmplY3Q/fVwiXG4gICAgICAgIGlmIEBldmVudD8gIHRoZW4gQGV2ZW50LnJlbW92ZUFjdGlvbiBAXG4gICAgICAgIGlmIEBvYmplY3Q/IHRoZW4gQG9iamVjdC5yZW1vdmVBY3Rpb24gQFxuICAgICAgICBAZGVsZXRlZCA9IHRydWVcblxuICAgIHBlcmZvcm06IC0+IFxuICAgICAgICAjIGxvZyBcIkFjdGlvbi5wZXJmb3JtICN7QG5hbWV9IGFjdGlvbj8gI3tAb2JqZWN0LnBlcmZvcm1BY3Rpb24/fSAje0BvYmplY3QubmFtZX1cIiBpZiBub3QgQG5hbWUgaW4gIFsnbm9vcCcsICdyb3RhdGlvbiddXG4gICAgICAgIGlmIEBvYmplY3QucGVyZm9ybUFjdGlvbj8gXG4gICAgICAgICAgICBAb2JqZWN0LnBlcmZvcm1BY3Rpb24gQFxuICAgICAgICBlbHNlIGlmIF8uaXNGdW5jdGlvbiBAb2JqZWN0XG4gICAgICAgICAgICBAb2JqZWN0IEBcbiAgICBcbiAgICBpbml0OiAtPiAgICBAb2JqZWN0LmluaXRBY3Rpb24/IEBcbiAgICBmaW5pc2g6IC0+ICBAb2JqZWN0LmZpbmlzaEFjdGlvbj8gQFxuICAgIGZpbmlzaGVkOiAtPiBcbiAgICAgICAgIyBsb2cgXCJBY3Rpb24uZmluaXNoZWQgI3tAbmFtZX0gI3tAb2JqZWN0Py5hY3Rpb25GaW5pc2hlZD99XCJcbiAgICAgICAgQG9iamVjdD8uYWN0aW9uRmluaXNoZWQ/IEBcbiAgICAgICAgcmV0dXJuIGlmIEBkZWxldGVkXG4gICAgICAgIEByZXNldCgpXG4gICAgICAgICMgaWYgQGN1cnJlbnQgPj0gQGdldER1cmF0aW9uKCkgIyBpZiBrZWVwUmVzdCB3YXNuJ3QgY2FsbGVkIC0+IHJlc2V0IHN0YXJ0IGFuZCBjdXJyZW50IHZhbHVlc1xuICAgICAgICAgICAgIyBAcmVzZXQoKVxuICAgICAgICAjIGVsc2UgXG4gICAgICAgICAgICAjIGxvZyAna2VlcGluZyByZXN0JywgQGN1cnJlbnRcblxuICAgIHJlc2V0OiAtPlxuICAgICAgICAjIGxvZyBcImFjdGlvbi5yZXNldCAje0BuYW1lfVwiXG4gICAgICAgIEBzdGFydCAgID0gMCAjIHdvcmxkIHRpbWVcbiAgICAgICAgQHJlc3QgICAgPSAwIFxuICAgICAgICBAbGFzdCAgICA9IDAgIyByZWxhdGl2ZSAobXMgc2luY2UgQHN0YXJ0KVxuICAgICAgICBAY3VycmVudCA9IDAgIyByZWxhdGl2ZSAobXMgc2luY2UgQHN0YXJ0KVxuICAgICAgICAjQGV2ZW50ICAgPSBudWxsICBcblxuICAgIHRha2VPdmVyOiAoYWN0aW9uKSAtPlxuICAgICAgICAjIGxvZyBcInRha2VPdmVyICN7YWN0aW9uLnJlc3R9IGZyb20gI3thY3Rpb24ubmFtZX0gdGhpczogI3tAbmFtZX1cIlxuICAgICAgICBAY3VycmVudCA9IGFjdGlvbi5jdXJyZW50XG4gICAgICAgIEBzdGFydCAgID0gYWN0aW9uLnN0YXJ0XG4gICAgICAgIEBsYXN0ICAgID0gYWN0aW9uLmxhc3RcbiAgICAgICAgQHJlc3QgICAgPSBhY3Rpb24ucmVzdFxuXG4gICAga2VlcFJlc3Q6ICgpIC0+XG4gICAgICAgIGlmIEByZXN0ICE9IDBcbiAgICAgICAgICAgIEBjdXJyZW50ID0gQHJlc3RcbiAgICAgICAgICAgIEByZXN0ICAgID0gMFxuXG4gICAgZ2V0UmVsYXRpdmVUaW1lOiAgLT4gQGN1cnJlbnQgLyBAZ2V0RHVyYXRpb24oKSBcbiAgICBnZXRSZWxhdGl2ZURlbHRhOiAtPiAoQGN1cnJlbnQtQGxhc3QpIC8gQGdldER1cmF0aW9uKClcbiAgICBnZXREdXJhdGlvbjogICAgICAtPiB3b3JsZC5tYXBNc1RpbWUgQGR1cmF0aW9uIFxuXG4gICAgcGVyZm9ybVdpdGhFdmVudDogKGV2ZW50KSAtPlxuICAgICAgICBldmVudFRpbWUgPSBldmVudC5nZXRUaW1lKClcbiAgICAgICAgIyBsb2cgXCJhY3Rpb24ucGVyZm9ybVdpdGhFdmVudCAje0BuYW1lfSAje0BpZH0gZXZlbnRUaW1lICN7ZXZlbnRUaW1lfSBzdGFydCAje0BzdGFydH1cIiBpZiBAbmFtZS5zdGFydHNXaXRoICdleGl0J1xuICAgICAgICBpZiBAc3RhcnQgPT0gMFxuICAgICAgICAgICAgQHN0YXJ0ICAgPSBldmVudFRpbWVcbiAgICAgICAgICAgIEBjdXJyZW50ID0gMFxuICAgICAgICAgICAgQHJlc3QgICAgPSAwXG4gICAgICAgICAgICBAbGFzdCAgICA9IDBcbiAgICAgICAgICAgICMgZXZlbnQucmVtb3ZlQWN0aW9uIEAgaWYgQGR1cmF0aW9uID09IDAgYW5kIEBtb2RlID09IEFjdGlvbi5PTkNFXG4gICAgICAgICAgICBldmVudC5yZW1vdmVBY3Rpb24gQCBpZiBAbW9kZSA9PSBBY3Rpb24uT05DRVxuICAgICAgICAgICAgQHBlcmZvcm0oKVxuICAgICAgICAgICAgQGxhc3QgPSBAY3VycmVudFxuICAgICAgICAgICAgIyBAZmluaXNoZWQoKSBpZiBAZHVyYXRpb24gPT0gMCBhbmQgQG1vZGUgPT0gQWN0aW9uLk9OQ0VcbiAgICAgICAgICAgIEBmaW5pc2hlZCgpIGlmIEBtb2RlID09IEFjdGlvbi5PTkNFXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGN1cnJlbnREaWZmID0gZXZlbnRUaW1lIC0gQHN0YXJ0XG4gICAgICAgICAgICBtc0R1ciA9IEBnZXREdXJhdGlvbigpXG4gICAgICAgICAgICBpZiBjdXJyZW50RGlmZiA+PSBtc0R1clxuICAgICAgICAgICAgICAgIEBjdXJyZW50ID0gbXNEdXJcbiAgICAgICAgICAgICAgICAjIEBzdGFydCAgID0gbXNEdXJcbiAgICAgICAgICAgICAgICBAcmVzdCAgICA9IGN1cnJlbnREaWZmIC0gbXNEdXJcbiAgICAgICAgICAgICAgICAjIGxvZyBcImFjdGlvbiAje25hbWV9IHBlcmZvcm1XaXRoRXZlbnQgc3RhcnQgI3tAc3RhcnR9IHJlc3QgI3tjdXJyZW50RGlmZn0tI3ttc0R1cn0gPSAje0ByZXN0fVwiIGlmIEBuYW1lICE9ICdub29wJ1xuICAgICAgICAgICAgICAgIEBwZXJmb3JtKClcbiAgICAgICAgICAgICAgICBAbGFzdCAgICA9IDBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiBAbW9kZSA9PSBBY3Rpb24uQ09OVElOVU9VU1xuICAgICAgICAgICAgICAgICAgICAjIGxvZyBcImFjdGlvbi5wZXJmb3JtV2l0aEV2ZW50ICN7QG5hbWV9IG1vZGUgPT0gQWN0aW9uLkNPTlRJTlVPVVNcIlxuICAgICAgICAgICAgICAgICAgICBAY3VycmVudCA9IEByZXN0XG4gICAgICAgICAgICAgICAgICAgIEBzdGFydCA9IGV2ZW50VGltZVxuICAgICAgICAgICAgICAgICAgICBAbGFzdCAgPSAwXG4gICAgICAgICAgICAgICAgICAgIEByZXN0ICA9IDBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgZXZlbnQucmVtb3ZlQWN0aW9uIEAgaWYgQG1vZGUgaW4gW0FjdGlvbi5PTkNFLCBBY3Rpb24uVElNRURdXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgQGZpbmlzaCgpXG4gICAgXG4gICAgICAgICAgICAgICAgaWYgQG1vZGUgPT0gQWN0aW9uLlJFUEVBVFxuICAgICAgICAgICAgICAgICAgICBpZiBAY3VycmVudCA+PSBAZ2V0RHVyYXRpb24oKSAjIGlmIGtlZXBSZXN0IHdhc24ndCBjYWxsZWQgLT4gcmVzZXQgc3RhcnQgYW5kIGN1cnJlbnQgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICBAcmVzZXQoKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBldmVudC5hZGRGaW5pc2hlZEFjdGlvbiBAXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgQGN1cnJlbnQgPSBjdXJyZW50RGlmZlxuICAgICAgICAgICAgICAgIEBwZXJmb3JtKClcbiAgICAgICAgICAgICAgICBAbGFzdCAgICA9IEBjdXJyZW50XG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpb25cbiJdfQ==
//# sourceURL=../coffee/action.coffee