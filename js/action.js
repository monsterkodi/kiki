// koffee 1.4.0
var Action, _;

_ = require('kxk')._;

Action = (function() {
    Action.NOOP = 0;

    Action.ROTATE = 1;

    Action.FLY = 2;

    Action.TOGGLE = 3;

    Action.FALL = 4;

    Action.PUSH = 5;

    Action.EXPLODE = 6;

    Action.IMPLODE = 7;

    Action.FORWARD = 8;

    Action.CLIMB_UP = 9;

    Action.CLIMB_DOWN = 10;

    Action.TURN_LEFT = 11;

    Action.TURN_RIGHT = 12;

    Action.JUMP = 13;

    Action.JUMP_FORWARD = 14;

    Action.FALL_FORWARD = 15;

    Action.SHOOT = 16;

    Action.LOOK_UP = 17;

    Action.LOOK_DOWN = 18;

    Action.LOOK_RESET = 19;

    Action.TUCKER = 20;

    Action.SHOW = 1;

    Action.HIDE = 2;

    Action.DELETE = 3;

    Action.ONCE = 0;

    Action.CONTINUOUS = 1;

    Action.REPEAT = 2;

    Action.TIMED = 3;

    function Action(o, i, n, d, m) {
        var ref, ref1, ref2;
        if (_.isPlainObject(o)) {
            i = (ref = o.id) != null ? ref : -1;
            n = o.name;
            d = (ref1 = o.duration) != null ? ref1 : 0;
            m = (ref2 = o.mode) != null ? ref2 : d && Action.TIMED || Action.ONCE;
            o = o.func;
        } else {
            if (i != null) {
                i;
            } else {
                i = -1;
            }
            if (d != null) {
                d;
            } else {
                d = 0;
            }
            if (m != null) {
                m;
            } else {
                m = d && Action.TIMED || Action.ONCE;
            }
        }
        this.object = o;
        this.name = n;
        this.id = i;
        this.mode = m;
        this.duration = d;
        this.event = null;
        this.deleted = false;
        this.reset();
    }

    Action.prototype.del = function() {
        if (this.event != null) {
            this.event.removeAction(this);
        }
        if (this.object != null) {
            this.object.removeAction(this);
        }
        return this.deleted = true;
    };

    Action.prototype.perform = function() {
        if (this.object.performAction != null) {
            return this.object.performAction(this);
        } else if (_.isFunction(this.object)) {
            return this.object(this);
        }
    };

    Action.prototype.init = function() {
        var base;
        return typeof (base = this.object).initAction === "function" ? base.initAction(this) : void 0;
    };

    Action.prototype.finish = function() {
        var base;
        return typeof (base = this.object).finishAction === "function" ? base.finishAction(this) : void 0;
    };

    Action.prototype.finished = function() {
        var ref;
        if ((ref = this.object) != null) {
            if (typeof ref.actionFinished === "function") {
                ref.actionFinished(this);
            }
        }
        if (this.deleted) {
            return;
        }
        return this.reset();
    };

    Action.prototype.atStart = function() {
        return this.current === 0;
    };

    Action.prototype.reset = function() {
        this.start = 0;
        this.rest = 0;
        this.last = 0;
        return this.current = 0;
    };

    Action.prototype.takeOver = function(action) {
        this.current = action.current;
        this.start = action.start;
        this.last = action.last;
        return this.rest = action.rest;
    };

    Action.prototype.getRelativeDelta = function() {
        return (this.current - this.last) / this.getDuration();
    };

    Action.prototype.getDuration = function() {
        return world.mapMsTime(this.duration);
    };

    Action.prototype.getRelativeTime = function() {
        var s;
        s = 1 / (16 + this.getDuration());
        return s * (16 + this.current);
    };

    Action.prototype.performWithEvent = function(event) {
        var currentDiff, eventTime, msDur, ref;
        eventTime = event.getTime();
        if (this.start === 0) {
            this.start = eventTime;
            this.current = 0;
            this.rest = 0;
            this.last = 0;
            if (this.mode === Action.ONCE) {
                event.removeAction(this);
            }
            this.perform();
            this.last = this.current;
            if (this.mode === Action.ONCE) {
                return this.finished();
            }
        } else {
            currentDiff = eventTime - this.start;
            msDur = this.getDuration();
            if (currentDiff >= (msDur - 4)) {
                this.current = msDur;
                this.rest = currentDiff - msDur;
                this.perform();
                this.last = 0;
                if (this.mode === Action.CONTINUOUS) {
                    this.current = this.rest;
                    this.start = eventTime;
                    this.last = 0;
                    this.rest = 0;
                    return;
                }
                if ((ref = this.mode) === Action.ONCE || ref === Action.TIMED) {
                    event.removeAction(this);
                }
                this.finish();
                if (this.mode === Action.REPEAT) {
                    if (this.current >= this.getDuration()) {
                        this.reset();
                    }
                    return;
                }
                return event.addFinishedAction(this);
            } else {
                this.current = currentDiff;
                this.perform();
                return this.last = this.current;
            }
        }
    };

    return Action;

})();

module.exports = Action;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQTs7QUFBRSxJQUFNLE9BQUEsQ0FBUSxLQUFSOztBQUVGO0lBRUYsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxNQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsR0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE1BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsSUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLE9BQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxPQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsT0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFFBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxVQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsU0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFVBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsWUFBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFlBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxLQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsT0FBRCxHQUFnQjs7SUFDaEIsTUFBQyxDQUFBLFNBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxVQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsTUFBRCxHQUFnQjs7SUFFaEIsTUFBQyxDQUFBLElBQUQsR0FBZ0I7O0lBQ2hCLE1BQUMsQ0FBQSxJQUFELEdBQWdCOztJQUNoQixNQUFDLENBQUEsTUFBRCxHQUFnQjs7SUFFaEIsTUFBQyxDQUFBLElBQUQsR0FBYzs7SUFDZCxNQUFDLENBQUEsVUFBRCxHQUFjOztJQUNkLE1BQUMsQ0FBQSxNQUFELEdBQWM7O0lBQ2QsTUFBQyxDQUFBLEtBQUQs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QUEsSUFBRCxHQUFTO0FBQ1QsMkJBTko7O2dCQVFBLFdBQXdCLElBQUMsQ0FBQSxLQUFELEtBQVUsTUFBTSxDQUFDLElBQWpCLElBQUEsR0FBQSxLQUF1QixNQUFNLENBQUMsS0FBdEQ7b0JBQUEsS0FBSyxDQUFDLFlBQU4sQ0FBbUIsSUFBbkIsRUFBQTs7Z0JBRUEsSUFBQyxDQUFBLE1BQUQsQ0FBQTtnQkFFQSxJQUFHLElBQUMsQ0FBQSxJQUFELEtBQVMsTUFBTSxDQUFDLE1BQW5CO29CQUNJLElBQUcsSUFBQyxDQUFBLE9BQUQsSUFBWSxJQUFDLENBQUEsV0FBRCxDQUFBLENBQWY7d0JBQ0ksSUFBQyxDQUFBLEtBQUQsQ0FBQSxFQURKOztBQUVBLDJCQUhKOzt1QkFLQSxLQUFLLENBQUMsaUJBQU4sQ0FBd0IsSUFBeEIsRUF6Qko7YUFBQSxNQUFBO2dCQTZCSSxJQUFDLENBQUEsT0FBRCxHQUFXO2dCQUVYLElBQUMsQ0FBQSxPQUFELENBQUE7dUJBQ0EsSUFBQyxDQUFBLElBQUQsR0FBVyxJQUFDLENBQUEsUUFoQ2hCO2FBckJKOztJQUpjOzs7Ozs7QUEyRHRCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4jIDAwMDAwMDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDBcbiMgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG5cbnsgXyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5jbGFzcyBBY3Rpb25cbiAgICBcbiAgICBATk9PUCAgICAgICAgID0gMFxuICAgIEBST1RBVEUgICAgICAgPSAxICMgc3dpdGNoLCBnYXRlLCBib21iXG4gICAgQEZMWSAgICAgICAgICA9IDIgIyBidWxsZXRcbiAgICBAVE9HR0xFICAgICAgID0gMyAjIHN3aXRjaCwgZ2F0ZVxuICAgIEBGQUxMICAgICAgICAgPSA0ICMgcHVzaGFibGVcbiAgICBAUFVTSCAgICAgICAgID0gNSAjIHB1c2hhYmxlXG4gICAgQEVYUExPREUgICAgICA9IDYgIyBib21iXG4gICAgQElNUExPREUgICAgICA9IDcgIyBib21iXG4gICAgQEZPUldBUkQgICAgICA9IDggIyBib3RcbiAgICBAQ0xJTUJfVVAgICAgID0gOSAjIGJvdFxuICAgIEBDTElNQl9ET1dOICAgPSAxMCAjIC4uLlxuICAgIEBUVVJOX0xFRlQgICAgPSAxMVxuICAgIEBUVVJOX1JJR0hUICAgPSAxMlxuICAgIEBKVU1QICAgICAgICAgPSAxM1xuICAgIEBKVU1QX0ZPUldBUkQgPSAxNFxuICAgIEBGQUxMX0ZPUldBUkQgPSAxNVxuICAgIEBTSE9PVCAgICAgICAgPSAxNlxuICAgIEBMT09LX1VQICAgICAgPSAxN1xuICAgIEBMT09LX0RPV04gICAgPSAxOFxuICAgIEBMT09LX1JFU0VUICAgPSAxOVxuICAgIEBUVUNLRVIgICAgICAgPSAyMFxuICAgIFxuICAgIEBTSE9XICAgICAgICAgPSAxXG4gICAgQEhJREUgICAgICAgICA9IDJcbiAgICBAREVMRVRFICAgICAgID0gM1xuICAgIFxuICAgIEBPTkNFICAgICAgID0gMFxuICAgIEBDT05USU5VT1VTID0gMVxuICAgIEBSRVBFQVQgICAgID0gMlxuICAgIEBUSU1FRCAgICAgID0gM1xuXG4gICAgQDogKG8sIGksIG4sIGQsIG0pIC0+XG4gICAgICAgIGlmIF8uaXNQbGFpbk9iamVjdCBvIFxuICAgICAgICAgICAgaSA9IG8uaWQgPyAtMVxuICAgICAgICAgICAgbiA9IG8ubmFtZVxuICAgICAgICAgICAgZCA9IG8uZHVyYXRpb24gPyAwXG4gICAgICAgICAgICBtID0gby5tb2RlID8gKGQgYW5kIEFjdGlvbi5USU1FRCBvciBBY3Rpb24uT05DRSlcbiAgICAgICAgICAgIG8gPSBvLmZ1bmNcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaSA/PSAtMVxuICAgICAgICAgICAgZCA/PSAwXG4gICAgICAgICAgICBtID89IChkIGFuZCBBY3Rpb24uVElNRUQgb3IgQWN0aW9uLk9OQ0UpXG4gICAgICAgICMga2xvZyBcIkFjdGlvbi5jb25zdHJ1Y3RvciAje2l9ICN7bn0gI3tkfSAje219XCJcbiAgICAgICAgQG9iamVjdCAgICAgPSBvXG4gICAgICAgIEBuYW1lICAgICAgID0gblxuICAgICAgICBAaWQgICAgICAgICA9IGlcbiAgICAgICAgQG1vZGUgICAgICAgPSBtXG4gICAgICAgIEBkdXJhdGlvbiAgID0gZFxuICAgICAgICBAZXZlbnQgICAgICA9IG51bGxcbiAgICAgICAgQGRlbGV0ZWQgICAgPSBmYWxzZVxuICAgICAgICBAcmVzZXQoKVxuXG4gICAgZGVsOiAtPlxuICAgICAgICAjIGtsb2cgXCJBY3Rpb24uZGVsICN7QG5hbWV9ICN7QGV2ZW50P30gI3tAb2JqZWN0P31cIlxuICAgICAgICBpZiBAZXZlbnQ/ICB0aGVuIEBldmVudC5yZW1vdmVBY3Rpb24gQFxuICAgICAgICBpZiBAb2JqZWN0PyB0aGVuIEBvYmplY3QucmVtb3ZlQWN0aW9uIEBcbiAgICAgICAgQGRlbGV0ZWQgPSB0cnVlXG5cbiAgICBwZXJmb3JtOiAtPiBcbiAgICAgICAgIyBrbG9nIFwiQWN0aW9uLnBlcmZvcm0gI3tAbmFtZX0gYWN0aW9uPyAje0BvYmplY3QucGVyZm9ybUFjdGlvbj99ICN7QG9iamVjdC5uYW1lfVwiIGlmIG5vdCBAbmFtZSBpbiAgWydub29wJywgJ3JvdGF0aW9uJ11cbiAgICAgICAgaWYgQG9iamVjdC5wZXJmb3JtQWN0aW9uPyBcbiAgICAgICAgICAgIEBvYmplY3QucGVyZm9ybUFjdGlvbiBAXG4gICAgICAgIGVsc2UgaWYgXy5pc0Z1bmN0aW9uIEBvYmplY3RcbiAgICAgICAgICAgIEBvYmplY3QgQFxuICAgIFxuICAgIGluaXQ6IC0+ICAgIEBvYmplY3QuaW5pdEFjdGlvbj8gQFxuICAgIGZpbmlzaDogLT4gIEBvYmplY3QuZmluaXNoQWN0aW9uPyBAXG4gICAgZmluaXNoZWQ6IC0+IFxuICAgICAgICAjIGtsb2cgXCJBY3Rpb24uZmluaXNoZWQgI3tAbmFtZX0gI3tAb2JqZWN0Py5hY3Rpb25GaW5pc2hlZD8gYW5kICcuJyBvciAndW5maW5pc2hlZCd9XCJcbiAgICAgICAgQG9iamVjdD8uYWN0aW9uRmluaXNoZWQ/IEBcbiAgICAgICAgcmV0dXJuIGlmIEBkZWxldGVkXG4gICAgICAgIEByZXNldCgpXG5cbiAgICBhdFN0YXJ0OiAtPiBAY3VycmVudCA9PSAwXG4gICAgICAgIFxuICAgIHJlc2V0OiAtPlxuICAgICAgICAjIGtsb2cgXCJhY3Rpb24ucmVzZXQgI3tAbmFtZX1cIlxuICAgICAgICBAc3RhcnQgICA9IDAgIyB3b3JsZCB0aW1lXG4gICAgICAgIEByZXN0ICAgID0gMCBcbiAgICAgICAgQGxhc3QgICAgPSAwICMgcmVsYXRpdmUgKG1zIHNpbmNlIEBzdGFydClcbiAgICAgICAgQGN1cnJlbnQgPSAwICMgcmVsYXRpdmUgKG1zIHNpbmNlIEBzdGFydClcblxuICAgIHRha2VPdmVyOiAoYWN0aW9uKSAtPlxuICAgICAgICAjIGtsb2cgXCJ0YWtlT3ZlciAje2FjdGlvbi5yZXN0fSBmcm9tICN7YWN0aW9uLm5hbWV9IHRoaXM6ICN7QG5hbWV9XCJcbiAgICAgICAgQGN1cnJlbnQgPSBhY3Rpb24uY3VycmVudFxuICAgICAgICBAc3RhcnQgICA9IGFjdGlvbi5zdGFydFxuICAgICAgICBAbGFzdCAgICA9IGFjdGlvbi5sYXN0XG4gICAgICAgIEByZXN0ICAgID0gYWN0aW9uLnJlc3RcblxuICAgIGdldFJlbGF0aXZlRGVsdGE6IC0+IChAY3VycmVudC1AbGFzdCkgLyBAZ2V0RHVyYXRpb24oKVxuICAgIGdldER1cmF0aW9uOiAgICAgIC0+IHdvcmxkLm1hcE1zVGltZSBAZHVyYXRpb24gXG4gICAgZ2V0UmVsYXRpdmVUaW1lOiAgLT4gXG4gICAgXG4gICAgICAgIHMgPSAxLygxNitAZ2V0RHVyYXRpb24oKSlcbiAgICAgICAgcyAqICgxNitAY3VycmVudClcblxuICAgIHBlcmZvcm1XaXRoRXZlbnQ6IChldmVudCkgLT5cbiAgICAgICAgXG4gICAgICAgIGV2ZW50VGltZSA9IGV2ZW50LmdldFRpbWUoKVxuICAgICAgICBcbiAgICAgICAgaWYgQHN0YXJ0ID09IDBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQHN0YXJ0ICAgPSBldmVudFRpbWVcbiAgICAgICAgICAgIEBjdXJyZW50ID0gMFxuICAgICAgICAgICAgQHJlc3QgICAgPSAwXG4gICAgICAgICAgICBAbGFzdCAgICA9IDBcblxuICAgICAgICAgICAgZXZlbnQucmVtb3ZlQWN0aW9uIEAgaWYgQG1vZGUgPT0gQWN0aW9uLk9OQ0VcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBrbG9nIFwiI3tAbmFtZX0gc3RhcnQgI3tAc3RhcnR9ICN7QGdldFJlbGF0aXZlRGVsdGEoKX0gI3tAZ2V0UmVsYXRpdmVUaW1lKCl9XCJcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQHBlcmZvcm0oKVxuICAgICAgICAgICAgQGxhc3QgPSBAY3VycmVudFxuICAgICAgICAgICAgIyBAZmluaXNoZWQoKSBpZiBAZHVyYXRpb24gPT0gMCBhbmQgQG1vZGUgPT0gQWN0aW9uLk9OQ0VcbiAgICAgICAgICAgIEBmaW5pc2hlZCgpIGlmIEBtb2RlID09IEFjdGlvbi5PTkNFXG4gICAgICAgICAgICBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjdXJyZW50RGlmZiA9IGV2ZW50VGltZSAtIEBzdGFydFxuICAgICAgICAgICAgbXNEdXIgPSBAZ2V0RHVyYXRpb24oKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBjdXJyZW50RGlmZiA+PSAobXNEdXIgLSA0KSAjIGFjdGlvbiAoYWxtb3N0KSBmaW5pc2hlZFxuICAgICAgICAgICAgICAgIEBjdXJyZW50ID0gbXNEdXJcbiAgICAgICAgICAgICAgICBAcmVzdCAgICA9IGN1cnJlbnREaWZmIC0gbXNEdXJcbiAgICAgICAgICAgICAgICAjIGtsb2cgXCJhY3Rpb24gI3tuYW1lfSBwZXJmb3JtV2l0aEV2ZW50IHN0YXJ0ICN7QHN0YXJ0fSByZXN0ICN7Y3VycmVudERpZmZ9LSN7bXNEdXJ9ID0gI3tAcmVzdH1cIiBpZiBAbmFtZSAhPSAnbm9vcCdcbiAgICAgICAgICAgICAgICAjIGtsb2cgXCIje0BuYW1lfSBlbmQgICAje0BjdXJyZW50fSAje0BnZXRSZWxhdGl2ZURlbHRhKCl9ICN7QGdldFJlbGF0aXZlVGltZSgpfVwiXG4gICAgICAgICAgICAgICAgQHBlcmZvcm0oKVxuICAgICAgICAgICAgICAgIEBsYXN0ICAgID0gMFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIEBtb2RlID09IEFjdGlvbi5DT05USU5VT1VTXG4gICAgICAgICAgICAgICAgICAgICMga2xvZyBcImFjdGlvbi5wZXJmb3JtV2l0aEV2ZW50ICN7QG5hbWV9IG1vZGUgPT0gQWN0aW9uLkNPTlRJTlVPVVNcIlxuICAgICAgICAgICAgICAgICAgICBAY3VycmVudCA9IEByZXN0XG4gICAgICAgICAgICAgICAgICAgIEBzdGFydCA9IGV2ZW50VGltZVxuICAgICAgICAgICAgICAgICAgICBAbGFzdCAgPSAwXG4gICAgICAgICAgICAgICAgICAgIEByZXN0ICA9IDBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGV2ZW50LnJlbW92ZUFjdGlvbiBAIGlmIEBtb2RlIGluIFtBY3Rpb24uT05DRSwgQWN0aW9uLlRJTUVEXVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIEBmaW5pc2goKVxuICAgIFxuICAgICAgICAgICAgICAgIGlmIEBtb2RlID09IEFjdGlvbi5SRVBFQVRcbiAgICAgICAgICAgICAgICAgICAgaWYgQGN1cnJlbnQgPj0gQGdldER1cmF0aW9uKCkgIyBpZiBrZWVwUmVzdCB3YXNuJ3QgY2FsbGVkIC0+IHJlc2V0IHN0YXJ0IGFuZCBjdXJyZW50IHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgQHJlc2V0KClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZXZlbnQuYWRkRmluaXNoZWRBY3Rpb24gQFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIEBjdXJyZW50ID0gY3VycmVudERpZmZcbiAgICAgICAgICAgICAgICAjIGtsb2cgXCIje0BuYW1lfSAgICAgICN7QGN1cnJlbnR9ICN7QGdldFJlbGF0aXZlRGVsdGEoKX0gI3tAZ2V0UmVsYXRpdmVUaW1lKCl9XCJcbiAgICAgICAgICAgICAgICBAcGVyZm9ybSgpXG4gICAgICAgICAgICAgICAgQGxhc3QgICAgPSBAY3VycmVudFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gQWN0aW9uXG4iXX0=
//# sourceURL=../coffee/action.coffee