// koffee 1.4.0
var Camera, Matrix, Quaternion, Vector, clamp,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

clamp = require('kxk').clamp;

Matrix = require('./lib/matrix');

Vector = require('./lib/vector');

Quaternion = require('./lib/quaternion');

Camera = (function(superClass) {
    extend(Camera, superClass);

    Camera.INSIDE = 0;

    Camera.BEHIND = 1;

    Camera.FOLLOW = 2;

    function Camera(player, opt) {
        var ref, ref1, ref2, ref3;
        this.player = player;
        this.fov = (ref = opt != null ? opt.fov : void 0) != null ? ref : 90;
        this.near = (ref1 = opt != null ? opt.near : void 0) != null ? ref1 : 0.01;
        this.eye_distance = this.near;
        this.far = (ref2 = opt != null ? opt.far : void 0) != null ? ref2 : 30;
        this.mode = Camera.BEHIND;
        this.aspect = (ref3 = opt.aspect) != null ? ref3 : -1;
        this.dist = 10;
        this.border = [0, 0, 0, 0];
        Camera.__super__.constructor.apply(this, arguments);
        this.setViewport(0.0, 0.0, 1.0, 1.0);
        this.cam = new THREE.PerspectiveCamera(this.fov, this.aspect, this.near, this.far);
        this.cam.position.z = this.dist;
    }

    Camera.prototype.step = function(step) {
        var camPos, pos;
        switch (this.mode) {
            case Camera.INSIDE:
                this.insideProjection();
                break;
            case Camera.BEHIND:
                this.behindProjection();
                break;
            case Camera.FOLLOW:
                this.followProjection();
        }
        camPos = this.getPosition();
        this.cam.position.copy(camPos);
        this.cam.up.copy(this.getYVector());
        this.cam.lookAt(camPos.plus(this.getZVector()));
        if (this.light != null) {
            pos = this.getPosition().plus(this.light_offset);
            this.light.setDirection(-this.getZVector());
            return this.light.setPosition(new Vector(pos[X], pos[Y], pos[Z], 1.0));
        }
    };

    Camera.prototype.getLookAtPosition = function() {
        return this.getZVector().mul(-this.eye_distance).plus(this.getPosition());
    };

    Camera.prototype.setOrientation = function(o) {
        this.setYVector(o.rotate(Vector.unitY));
        this.setZVector(o.rotate(Vector.unitZ));
        this.setXVector(o.rotate(Vector.minusX));
        this.cam.up.copy(this.getYVector());
        return this.cam.lookAt(this.getPosition().plus(this.getZVector()));
    };

    Camera.prototype.updateViewport = function() {};

    Camera.prototype.setViewportBorder = function(l, b, r, t) {};

    Camera.prototype.setViewport = function(l, b, w, h) {};

    Camera.prototype.setFov = function(fov) {
        return this.fov = Math.max(2.0, Math.min(fov, 175.0));
    };

    Camera.prototype.insideProjection = function() {
        var camPos, lookAngle, lookDelta, newLookVector, playerDir, playerPos, playerUp, posDelta, rot;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        lookAngle = this.player.look_angle;
        posDelta = world.getSpeed() / 10.0;
        camPos = playerPos;
        if (lookAngle < 0) {
            camPos.add(playerUp.mul(-2 * lookAngle / 90));
        }
        this.setPosition(this.getPosition().mul(1.0 - posDelta).plus(camPos.mul(posDelta)));
        if (lookAngle) {
            this.setXVector(playerDir.cross(playerUp).normal());
            rot = Quaternion.rotationAroundVector(lookAngle, this.getXVector());
            this.setYVector(rot.rotate(playerUp));
            this.setZVector(rot.rotate(playerDir));
        } else {
            lookDelta = (2.0 - this.getZVector().dot(playerDir)) * world.getSpeed() / 50.0;
            newLookVector = this.getZVector().mul(1.0 - lookDelta).plus(playerDir.mul(lookDelta));
            newLookVector.normalize();
            this.setXVector(playerUp.cross(newLookVector).normal());
            this.setYVector(playerUp);
            this.setZVector(newLookVector);
        }
        return this.projection;
    };

    Camera.prototype.behindProjection = function() {
        var botToCamera, camPos, lookAngle, lookDelta, min_f, newLookVector, playerDir, playerPos, playerUp, posDelta, rot;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        lookAngle = this.player.look_angle;
        botToCamera = playerUp.minus(playerDir.mul(2));
        min_f = botToCamera.length();
        botToCamera.normalize();
        min_f = Math.min(world.getWallDistanceForRay(playerPos, botToCamera), min_f);
        camPos = playerPos.plus(botToCamera.mul(Math.max(min_f, 0.72) * (1 - Math.abs(lookAngle) / 90)));
        if (lookAngle < 0) {
            camPos.add(playerUp.mul(-2 * lookAngle / 90));
        }
        camPos = world.getInsideWallPosWithDelta(camPos, 0.2);
        posDelta = 0.2;
        this.setPosition(this.getPosition().mul(1.0 - posDelta).plus(camPos.mul(posDelta)));
        if (lookAngle) {
            this.setXVector(playerDir.cross(playerUp).normal());
            rot = Quaternion.rotationAroundVector(lookAngle, this.getXVector());
            this.setYVector(rot.rotate(playerUp));
            return this.setZVector(rot.rotate(playerDir));
        } else {
            lookDelta = 0.3;
            newLookVector = this.getZVector().mul(1.0 - lookDelta).plus((playerDir.minus(playerUp.mul(0.2)).normal()).mul(lookDelta));
            newLookVector.normalize();
            this.setZVector(newLookVector);
            this.setXVector(playerUp.cross(newLookVector).normal());
            return this.setYVector(newLookVector.cross(this.getXVector()).normal());
        }
    };

    Camera.prototype.followProjection = function() {
        var botToCamera, botToCameraNormal, camPos, cameraBotDistance, delta, desiredDistance, difference, horizontalAngle, lookDelta, mappedToXZ, newLeftVector, newLookVector, newUpVector, playerDir, playerLeft, playerPos, playerUp, rotFactor, rotQuat, upDelta, verticalAngle, wall_distance;
        camPos = this.getPosition();
        desiredDistance = 2.0;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        playerLeft = this.player.currentLeft();
        botToCamera = camPos.minus(playerPos);
        cameraBotDistance = botToCamera.length();
        if (cameraBotDistance >= desiredDistance) {
            difference = cameraBotDistance - desiredDistance;
            delta = difference * difference / 400.0;
            camPos = camPos.mul(1.0 - delta).plus(playerPos.mul(delta));
        } else {
            difference = desiredDistance - cameraBotDistance;
            delta = difference / 20.0;
            camPos = camPos.mul(1.0 - delta).plus((playerPos.plus(botToCamera.normal().mul(desiredDistance))).mul(delta));
        }
        botToCamera = camPos.minus(playerPos);
        botToCameraNormal = botToCamera.normal();
        verticalAngle = Vector.RAD2DEG(Math.acos(clamp(-1.0, 1.0, botToCameraNormal.dot(playerUp))));
        if (verticalAngle > 45) {
            rotQuat = Quaternion.rotationAroundVector(verticalAngle / 400.0, botToCameraNormal.cross(playerUp));
            botToCamera = rotQuat.rotate(botToCamera);
            botToCameraNormal = botToCamera.normal();
            camPos = playerPos.plus(botToCamera);
        }
        rotFactor = 1.0;
        wall_distance = world.getWallDistanceForPos(camPos);
        if (wall_distance < 0.5) {
            if (wall_distance < 0.2) {
                camPos = world.getInsideWallPosWithDelta(camPos, 0.2);
                botToCamera = camPos.minus(playerPos);
                botToCameraNormal = botToCamera.normal();
            }
            rotFactor = 0.5 / (wall_distance - 0.2);
        }
        mappedToXZ = (botToCamera.minus(playerUp.mul(botToCamera.dot(playerUp)))).normal();
        horizontalAngle = Vector.RAD2DEG(Math.acos(clamp(-1.0, 1.0, -playerDir.dot(mappedToXZ))));
        if (botToCameraNormal.dot(playerLeft) < 0) {
            horizontalAngle = -horizontalAngle;
        }
        rotQuat = Quaternion.rotationAroundVector(horizontalAngle / (rotFactor * 400.0), playerUp);
        camPos = playerPos.plus(rotQuat.rotate(botToCamera));
        botToCamera = camPos.minus(playerPos);
        botToCameraNormal = botToCamera.normal();
        this.setPosition(camPos);
        lookDelta = this.getZVector().dot(botToCameraNormal);
        lookDelta *= lookDelta / 30.0;
        newLookVector = this.getZVector().mul(1.0 - lookDelta).plus(botToCameraNormal.neg().mul(lookDelta));
        newLookVector.normalize();
        upDelta = 1.5 - this.getYVector().dot(playerUp);
        upDelta *= upDelta / 100.0;
        newUpVector = this.getYVector().mul(1.0 - upDelta).plus(playerUp.mul(upDelta));
        newUpVector.normalize();
        newLeftVector = newUpVector.cross(newLookVector);
        this.setXVector(newLeftVector);
        this.setYVector(newUpVector);
        this.setZVector(newLookVector);
        return this.projection;
    };

    return Camera;

})(Matrix);

module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FtZXJhLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSx5Q0FBQTtJQUFBOzs7QUFBRSxRQUFVLE9BQUEsQ0FBUSxLQUFSOztBQUNaLE1BQUEsR0FBYyxPQUFBLENBQVEsY0FBUjs7QUFDZCxNQUFBLEdBQWMsT0FBQSxDQUFRLGNBQVI7O0FBQ2QsVUFBQSxHQUFjLE9BQUEsQ0FBUSxrQkFBUjs7QUFFUjs7O0lBRUYsTUFBQyxDQUFBLE1BQUQsR0FBVTs7SUFDVixNQUFDLENBQUEsTUFBRCxHQUFVOztJQUNWLE1BQUMsQ0FBQSxNQUFELEdBQVU7O0lBRUcsZ0JBQUMsTUFBRCxFQUFVLEdBQVY7QUFDVCxZQUFBO1FBRFUsSUFBQyxDQUFBLFNBQUQ7UUFDVixJQUFDLENBQUEsR0FBRCwwREFBcUI7UUFDckIsSUFBQyxDQUFBLElBQUQsNkRBQXNCO1FBQ3RCLElBQUMsQ0FBQSxZQUFELEdBQWdCLElBQUMsQ0FBQTtRQUNqQixJQUFDLENBQUEsR0FBRCw0REFBcUI7UUFDckIsSUFBQyxDQUFBLElBQUQsR0FBVSxNQUFNLENBQUM7UUFDakIsSUFBQyxDQUFBLE1BQUQsd0NBQXVCLENBQUM7UUFDeEIsSUFBQyxDQUFBLElBQUQsR0FBVTtRQUNWLElBQUMsQ0FBQSxNQUFELEdBQVUsQ0FBQyxDQUFELEVBQUcsQ0FBSCxFQUFLLENBQUwsRUFBTyxDQUFQO1FBRVYseUNBQUEsU0FBQTtRQUVBLElBQUMsQ0FBQSxXQUFELENBQWEsR0FBYixFQUFrQixHQUFsQixFQUF1QixHQUF2QixFQUE0QixHQUE1QjtRQUVBLElBQUMsQ0FBQSxHQUFELEdBQU8sSUFBSSxLQUFLLENBQUMsaUJBQVYsQ0FBNEIsSUFBQyxDQUFBLEdBQTdCLEVBQWtDLElBQUMsQ0FBQSxNQUFuQyxFQUEyQyxJQUFDLENBQUEsSUFBNUMsRUFBa0QsSUFBQyxDQUFBLEdBQW5EO1FBQ1AsSUFBQyxDQUFBLEdBQUcsQ0FBQyxRQUFRLENB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RCxDQUFBLENBQWEsQ0FBQyxHQUFkLENBQWtCLEdBQUEsR0FBSSxPQUF0QixDQUE4QixDQUFDLElBQS9CLENBQW9DLFFBQVEsQ0FBQyxHQUFULENBQWEsT0FBYixDQUFwQztRQUNkLFdBQVcsQ0FBQyxTQUFaLENBQUE7UUFFQSxhQUFBLEdBQWdCLFdBQVcsQ0FBQyxLQUFaLENBQWtCLGFBQWxCO1FBR2hCLElBQUMsQ0FBQSxVQUFELENBQVksYUFBWjtRQUNBLElBQUMsQ0FBQSxVQUFELENBQVksV0FBWjtRQUNBLElBQUMsQ0FBQSxVQUFELENBQVksYUFBWjtlQUNBLElBQUMsQ0FBQTtJQWhGYTs7OztHQXhKRDs7QUEwT3JCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiXG4jICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAgICAgIDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCBcbiMgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuIyAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMDAwXG4jICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiMgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG57IGNsYW1wIH0gPSByZXF1aXJlICdreGsnXG5NYXRyaXggICAgICA9IHJlcXVpcmUgJy4vbGliL21hdHJpeCdcblZlY3RvciAgICAgID0gcmVxdWlyZSAnLi9saWIvdmVjdG9yJ1xuUXVhdGVybmlvbiAgPSByZXF1aXJlICcuL2xpYi9xdWF0ZXJuaW9uJ1xuXG5jbGFzcyBDYW1lcmEgZXh0ZW5kcyBNYXRyaXhcblxuICAgIEBJTlNJREUgPSAwIFxuICAgIEBCRUhJTkQgPSAxIFxuICAgIEBGT0xMT1cgPSAyXG4gICAgICAgIFxuICAgIGNvbnN0cnVjdG9yOiAoQHBsYXllciwgb3B0KSAtPlxuICAgICAgICBAZm92ICAgID0gb3B0Py5mb3YgPyA5MFxuICAgICAgICBAbmVhciAgID0gb3B0Py5uZWFyID8gMC4wMVxuICAgICAgICBAZXllX2Rpc3RhbmNlID0gQG5lYXJcbiAgICAgICAgQGZhciAgICA9IG9wdD8uZmFyID8gMzBcbiAgICAgICAgQG1vZGUgICA9IENhbWVyYS5CRUhJTkRcbiAgICAgICAgQGFzcGVjdCA9IG9wdC5hc3BlY3QgPyAtMVxuICAgICAgICBAZGlzdCAgID0gMTBcbiAgICAgICAgQGJvcmRlciA9IFswLDAsMCwwXVxuICAgICAgICBcbiAgICAgICAgc3VwZXJcbiAgICAgICAgXG4gICAgICAgIEBzZXRWaWV3cG9ydCAwLjAsIDAuMCwgMS4wLCAxLjAgXG4gICAgICAgIFxuICAgICAgICBAY2FtID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhIEBmb3YsIEBhc3BlY3QsIEBuZWFyLCBAZmFyXG4gICAgICAgIEBjYW0ucG9zaXRpb24ueiA9IEBkaXN0XG4gICAgICAgIFxuICAgIHN0ZXA6IChzdGVwKSAtPlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIEBtb2RlXG4gICAgICAgICAgICB3aGVuIENhbWVyYS5JTlNJREUgdGhlbiBAaW5zaWRlUHJvamVjdGlvbigpICAgICBcbiAgICAgICAgICAgIHdoZW4gQ2FtZXJhLkJFSElORCB0aGVuIEBiZWhpbmRQcm9qZWN0aW9uKClcbiAgICAgICAgICAgIHdoZW4gQ2FtZXJhLkZPTExPVyB0aGVuIEBmb2xsb3dQcm9qZWN0aW9uKClcbiAgICAgICAgXG4gICAgICAgIGNhbVBvcyA9IEBnZXRQb3NpdGlvbigpXG4gICAgICAgIEBjYW0ucG9zaXRpb24uY29weSBjYW1Qb3NcbiAgICAgICAgQGNhbS51cC5jb3B5IEBnZXRZVmVjdG9yKClcbiAgICAgICAgQGNhbS5sb29rQXQgY2FtUG9zLnBsdXMgQGdldFpWZWN0b3IoKVxuXG4gICAgICAgIGlmIEBsaWdodD9cbiAgICAgICAgICAgIHBvcyA9IEBnZXRQb3NpdGlvbigpLnBsdXMgQGxpZ2h0X29mZnNldFxuICAgICAgICAgICAgQGxpZ2h0LnNldERpcmVjdGlvbiAtQGdldFpWZWN0b3IoKVxuICAgICAgICAgICAgQGxpZ2h0LnNldFBvc2l0aW9uIG5ldyBWZWN0b3IgcG9zW1hdLCBwb3NbWV0sIHBvc1taXSwgMS4wICMgcG9zaXRpb25hbCBsaWdodCBzb3VyY2VcbiAgICBcbiAgICBnZXRMb29rQXRQb3NpdGlvbjogLT4gQGdldFpWZWN0b3IoKS5tdWwoLUBleWVfZGlzdGFuY2UpLnBsdXMgQGdldFBvc2l0aW9uKClcbiAgICBcbiAgICBzZXRPcmllbnRhdGlvbjogKG8pIC0+IFxuICAgICAgICBAc2V0WVZlY3RvciBvLnJvdGF0ZSBWZWN0b3IudW5pdFlcbiAgICAgICAgQHNldFpWZWN0b3Igby5yb3RhdGUgVmVjdG9yLnVuaXRaXG4gICAgICAgIEBzZXRYVmVjdG9yIG8ucm90YXRlIFZlY3Rvci5taW51c1hcbiAgICAgICAgQGNhbS51cC5jb3B5IEBnZXRZVmVjdG9yKClcbiAgICAgICAgQGNhbS5sb29rQXQgQGdldFBvc2l0aW9uKCkucGx1cyBAZ2V0WlZlY3RvcigpXG4gICAgICAgICAgICBcbiAgICB1cGRhdGVWaWV3cG9ydDogLT5cbiAgICAgICAgIyBzcyA9IHdvcmxkLnNjcmVlblNpemVcbiAgICAgICAgIyB2cCA9IFtdXG4gICAgICAgICMgdnBbMF0gPSBAdmlld3BvcnRbMF0gKiBzcy53ICsgQGJvcmRlclswXVxuICAgICAgICAjIHZwWzFdID0gQHZpZXdwb3J0WzFdICogc3MuaCArIEBib3JkZXJbMV1cbiAgICAgICAgIyB2cFsyXSA9IEB2aWV3cG9ydFsyXSAqIHNzLncgLSBAYm9yZGVyWzBdIC0gQGJvcmRlclsyXVxuICAgICAgICAjIHZwWzNdID0gQHZpZXdwb3J0WzNdICogc3MuaCAtIEBib3JkZXJbMV0gLSBAYm9yZGVyWzNdXG4gICAgXG4gICAgc2V0Vmlld3BvcnRCb3JkZXI6IChsLCBiLCByLCB0KSAtPlxuICAgICAgICAjIEBib3JkZXIgPSBbbCxiLHIsdF1cbiAgICAgICAgIyBAdXBkYXRlVmlld3BvcnQoKVxuICAgIFxuICAgIHNldFZpZXdwb3J0OiAobCwgYiwgdywgaCkgLT5cbiAgICAgICAgIyBAdmlld3BvcnQgPSBbbCxiLHcsaF0gXG4gICAgICAgICMgQHVwZGF0ZVZpZXdwb3J0KClcbiMgICAgIFxuICAgIHNldEZvdjogKGZvdikgLT4gQGZvdiA9IE1hdGgubWF4KDIuMCwgTWF0aC5taW4gZm92LCAxNzUuMClcbiAgICAgICAgICAgIFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAgICAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAwMDAwMDAwICAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMFxuICAgICMgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICBcbiAgICBpbnNpZGVQcm9qZWN0aW9uOiAoKSAtPlxuICAgICAgICBcbiAgICAgICAgcGxheWVyUG9zID0gQHBsYXllci5jdXJyZW50UG9zKClcbiAgICAgICAgcGxheWVyRGlyID0gQHBsYXllci5jdXJyZW50RGlyKClcbiAgICAgICAgcGxheWVyVXAgID0gQHBsYXllci5jdXJyZW50VXAoKVxuICAgICAgICBsb29rQW5nbGUgPSBAcGxheWVyLmxvb2tfYW5nbGVcbiAgICAgICAgXG4gICAgICAgIHBvc0RlbHRhID0gd29ybGQuZ2V0U3BlZWQoKSAvIDEwLjAgIyBzbW9vdGggY2FtZXJhIG1vdmVtZW50IGEgbGl0dGxlIGJpdFxuICAgICAgICBjYW1Qb3MgPSBwbGF5ZXJQb3NcbiAgICAgICAgaWYgbG9va0FuZ2xlIDwgMFxuICAgICAgICAgICAgY2FtUG9zLmFkZCBwbGF5ZXJVcC5tdWwgLTIqbG9va0FuZ2xlLzkwXG4gICAgICAgIEBzZXRQb3NpdGlvbiBAZ2V0UG9zaXRpb24oKS5tdWwoMS4wLXBvc0RlbHRhKS5wbHVzIGNhbVBvcy5tdWwgcG9zRGVsdGFcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBsb29rQW5nbGUgIyBwbGF5ZXIgaXMgbG9va2luZyB1cCBvciBkb3duXG4gICAgICAgICAgICBAc2V0WFZlY3RvciBwbGF5ZXJEaXIuY3Jvc3MocGxheWVyVXApLm5vcm1hbCgpXG4gICAgICAgICAgICByb3QgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yIGxvb2tBbmdsZSwgQGdldFhWZWN0b3IoKVxuICAgICAgICAgICAgQHNldFlWZWN0b3Igcm90LnJvdGF0ZSBwbGF5ZXJVcCBcbiAgICAgICAgICAgIEBzZXRaVmVjdG9yIHJvdC5yb3RhdGUgcGxheWVyRGlyICMubmVnKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgIyBzbW9vdGggY2FtZXJhIHJvdGF0aW9uIGEgbGl0dGxlIGJpdFxuICAgICAgICAgICAgbG9va0RlbHRhID0gKDIuMCAtIEBnZXRaVmVjdG9yKCkuZG90IHBsYXllckRpcikgKiB3b3JsZC5nZXRTcGVlZCgpIC8gNTAuMFxuICAgICAgICAgICAgbmV3TG9va1ZlY3RvciA9IEBnZXRaVmVjdG9yKCkubXVsKDEuMCAtIGxvb2tEZWx0YSkucGx1cyBwbGF5ZXJEaXIubXVsIGxvb2tEZWx0YVxuICAgICAgICAgICAgbmV3TG9va1ZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICAgICAgQHNldFhWZWN0b3IgcGxheWVyVXAuY3Jvc3MobmV3TG9va1ZlY3Rvcikubm9ybWFsKClcbiAgICAgICAgICAgIEBzZXRZVmVjdG9yIHBsYXllclVwXG4gICAgICAgICAgICBAc2V0WlZlY3RvciBuZXdMb29rVmVjdG9yXG4gICAgICAgICAgICBcbiAgICAgICAgQHByb2plY3Rpb25cbiAgICBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuICAgIFxuICAgIGJlaGluZFByb2plY3Rpb246ICgpIC0+XG4gICAgICAgIHBsYXllclBvcyA9IEBwbGF5ZXIuY3VycmVudFBvcygpXG4gICAgICAgIHBsYXllckRpciA9IEBwbGF5ZXIuY3VycmVudERpcigpXG4gICAgICAgIHBsYXllclVwICA9IEBwbGF5ZXIuY3VycmVudFVwKClcbiAgICAgICAgbG9va0FuZ2xlID0gQHBsYXllci5sb29rX2FuZ2xlXG4gICAgICAgIFxuICAgICAgICAjIGZpbmQgYSB2YWxpZCBjYW1lcmEgcG9zaXRpb25cbiAgICAgICAgYm90VG9DYW1lcmEgPSBwbGF5ZXJVcC5taW51cyBwbGF5ZXJEaXIubXVsIDJcbiAgICAgICAgbWluX2YgPSBib3RUb0NhbWVyYS5sZW5ndGgoKVxuICAgICAgICBib3RUb0NhbWVyYS5ub3JtYWxpemUoKVxuICAgICAgICBcbiAgICAgICAgbWluX2YgPSBNYXRoLm1pbiB3b3JsZC5nZXRXYWxsRGlzdGFuY2VGb3JSYXkocGxheWVyUG9zLCBib3RUb0NhbWVyYSksIG1pbl9mXG4gICAgICAgIGNhbVBvcyA9IHBsYXllclBvcy5wbHVzIGJvdFRvQ2FtZXJhLm11bCBNYXRoLm1heChtaW5fZiwgMC43MikgKiAoMS1NYXRoLmFicyhsb29rQW5nbGUpLzkwKVxuICAgICAgICBpZiBsb29rQW5nbGUgPCAwXG4gICAgICAgICAgICBjYW1Qb3MuYWRkIHBsYXllclVwLm11bCAtMipsb29rQW5nbGUvOTBcbiAgICAgICAgXG4gICAgICAgIGNhbVBvcyA9IHdvcmxkLmdldEluc2lkZVdhbGxQb3NXaXRoRGVsdGEgY2FtUG9zLCAwLjJcbiAgICAgICAgICAgIFxuICAgICAgICAjIHNtb290aCBjYW1lcmEgbW92ZW1lbnQgYSBsaXR0bGUgYml0XG4gICAgICAgIHBvc0RlbHRhID0gMC4yXG4gICAgICAgIEBzZXRQb3NpdGlvbiBAZ2V0UG9zaXRpb24oKS5tdWwoMS4wIC0gcG9zRGVsdGEpLnBsdXMgY2FtUG9zLm11bCBwb3NEZWx0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYgbG9va0FuZ2xlXG4gICAgICAgICAgICAjIGxvZyBcImxvb2tfYW5nbGUgI3tsb29rQW5nbGV9XCJcbiAgICAgICAgICAgIEBzZXRYVmVjdG9yIHBsYXllckRpci5jcm9zcyhwbGF5ZXJVcCkubm9ybWFsKCkgXG4gICAgICAgICAgICByb3QgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yIGxvb2tBbmdsZSwgQGdldFhWZWN0b3IoKSBcbiAgICAgICAgICAgIEBzZXRZVmVjdG9yIHJvdC5yb3RhdGUgcGxheWVyVXAgIFxuICAgICAgICAgICAgQHNldFpWZWN0b3Igcm90LnJvdGF0ZSBwbGF5ZXJEaXIgIy5uZWcoKSAgXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgICMgc21vb3RoIGNhbWVyYSByb3RhdGlvbiBhIGxpdHRsZSBiaXRcbiAgICAgICAgICAgIGxvb2tEZWx0YSA9IDAuM1xuICAgICAgICAgICAgbmV3TG9va1ZlY3RvciA9IEBnZXRaVmVjdG9yKCkubXVsKDEuMCAtIGxvb2tEZWx0YSkucGx1cyAocGxheWVyRGlyLm1pbnVzKHBsYXllclVwLm11bCgwLjIpKS5ub3JtYWwoKSkubXVsIGxvb2tEZWx0YVxuICAgICAgICAgICAgbmV3TG9va1ZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBAc2V0WlZlY3RvciBuZXdMb29rVmVjdG9yICBcbiAgICAgICAgICAgIEBzZXRYVmVjdG9yIHBsYXllclVwLmNyb3NzKG5ld0xvb2tWZWN0b3IpLm5vcm1hbCgpIFxuICAgICAgICAgICAgQHNldFlWZWN0b3IgbmV3TG9va1ZlY3Rvci5jcm9zcyhAZ2V0WFZlY3RvcigpKS5ub3JtYWwoKSBcbiAgICAgICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgIyAgIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAgICAgIDAwXG5cbiAgICBmb2xsb3dQcm9qZWN0aW9uOiAoKSAtPlxuICAgICAgICBcbiAgICAgICAgY2FtUG9zID0gQGdldFBvc2l0aW9uKClcbiAgICAgICAgZGVzaXJlZERpc3RhbmNlID0gMi4wICMgZGVzaXJlZCBkaXN0YW5jZSBmcm9tIGNhbWVyYSB0byBib3RcbiAgICBcbiAgICAgICAgcGxheWVyUG9zICAgPSBAcGxheWVyLmN1cnJlbnRQb3MoKVxuICAgICAgICBwbGF5ZXJEaXIgICA9IEBwbGF5ZXIuY3VycmVudERpcigpXG4gICAgICAgIHBsYXllclVwICAgID0gQHBsYXllci5jdXJyZW50VXAoKVxuICAgICAgICBwbGF5ZXJMZWZ0ICA9IEBwbGF5ZXIuY3VycmVudExlZnQoKVxuICAgIFxuICAgICAgICAjIGZpcnN0LCBhZGp1c3QgZGlzdGFuY2UgZnJvbSBjYW1lcmEgdG8gYm90XG4gICAgICAgICBcbiAgICAgICAgYm90VG9DYW1lcmEgPSBjYW1Qb3MubWludXMgcGxheWVyUG9zICAgICAjIHZlY3RvciBmcm9tIGJvdCB0byBjdXJyZW50IHBvc1xuICAgICAgICBjYW1lcmFCb3REaXN0YW5jZSA9IGJvdFRvQ2FtZXJhLmxlbmd0aCgpICMgZGlzdGFuY2UgZnJvbSBjYW1lcmEgdG8gYm90XG4gICAgICAgIFxuICAgICAgICBpZiBjYW1lcmFCb3REaXN0YW5jZSA+PSBkZXNpcmVkRGlzdGFuY2VcbiAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBjYW1lcmFCb3REaXN0YW5jZSAtIGRlc2lyZWREaXN0YW5jZVxuICAgICAgICAgICAgZGVsdGEgPSBkaWZmZXJlbmNlKmRpZmZlcmVuY2UvNDAwLjAgICMgd2VpZ2h0IGZvciBmb2xsb3dpbmcgc3BlZWRcbiAgICAgICAgICAgIGNhbVBvcyA9IGNhbVBvcy5tdWwoMS4wLWRlbHRhKS5wbHVzIHBsYXllclBvcy5tdWwgZGVsdGFcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGRlc2lyZWREaXN0YW5jZSAtIGNhbWVyYUJvdERpc3RhbmNlXG4gICAgICAgICAgICBkZWx0YSA9IGRpZmZlcmVuY2UvMjAuMCAjIHdlaWdodCBmb3IgbmVnYXRpdmUgZm9sbG93aW5nIHNwZWVkXG4gICAgICAgICAgICBjYW1Qb3MgPSBjYW1Qb3MubXVsKDEuMC1kZWx0YSkucGx1cyAocGxheWVyUG9zLnBsdXMgYm90VG9DYW1lcmEubm9ybWFsKCkubXVsIGRlc2lyZWREaXN0YW5jZSkubXVsIGRlbHRhXG4gICAgXG4gICAgICAgICMgc2Vjb25kLCByb3RhdGUgYXJvdW5kIGJvdFxuICAgIFxuICAgICAgICBib3RUb0NhbWVyYSA9IGNhbVBvcy5taW51cyBwbGF5ZXJQb3NcbiAgICAgICAgYm90VG9DYW1lcmFOb3JtYWwgPSBib3RUb0NhbWVyYS5ub3JtYWwoKVxuICAgICBcbiAgICAgICAgIyByb3RhdGUgY2FtZXJhIHZlcnRpY2FsbHlcbiAgICAgICAgdmVydGljYWxBbmdsZSA9IFZlY3Rvci5SQUQyREVHIE1hdGguYWNvcyhjbGFtcCgtMS4wLCAxLjAsIGJvdFRvQ2FtZXJhTm9ybWFsLmRvdCBwbGF5ZXJVcCkpXG4gICAgICAgIGlmIHZlcnRpY2FsQW5nbGUgPiA0NVxuICAgICAgICAgICAgIyBsb2cgXCJ2ZXJ0aWNhbEFuZ2xlICN7dmVydGljYWxBbmdsZX1cIlxuICAgICAgICAgICAgcm90UXVhdCAgICAgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yKHZlcnRpY2FsQW5nbGUvNDAwLjAsIGJvdFRvQ2FtZXJhTm9ybWFsLmNyb3NzKHBsYXllclVwKSlcbiAgICAgICAgICAgIGJvdFRvQ2FtZXJhID0gcm90UXVhdC5yb3RhdGUgYm90VG9DYW1lcmEgXG4gICAgICAgICAgICBib3RUb0NhbWVyYU5vcm1hbCA9IGJvdFRvQ2FtZXJhLm5vcm1hbCgpXG4gICAgICAgICAgICBjYW1Qb3MgICAgICA9IHBsYXllclBvcy5wbHVzIGJvdFRvQ2FtZXJhXG5cbiAgICAgICAgcm90RmFjdG9yID0gMS4wXG5cbiAgICAgICAgd2FsbF9kaXN0YW5jZSA9IHdvcmxkLmdldFdhbGxEaXN0YW5jZUZvclBvcyBjYW1Qb3NcbiAgICAgICAgaWYgd2FsbF9kaXN0YW5jZSA8IDAuNSAjIHRyeSBhdm9pZCBwaWVyY2luZyB3YWxsc1xuICAgICAgICAgICAgaWYgd2FsbF9kaXN0YW5jZSA8IDAuMlxuICAgICAgICAgICAgICAgIGNhbVBvcyA9IHdvcmxkLmdldEluc2lkZVdhbGxQb3NXaXRoRGVsdGEgY2FtUG9zLCAwLjJcbiAgICAgICAgICAgICAgICBib3RUb0NhbWVyYSA9IGNhbVBvcy5taW51cyBwbGF5ZXJQb3NcbiAgICAgICAgICAgICAgICBib3RUb0NhbWVyYU5vcm1hbCA9IGJvdFRvQ2FtZXJhLm5vcm1hbCgpXG4gICAgICAgICAgICByb3RGYWN0b3IgPSAwLjUgLyAod2FsbF9kaXN0YW5jZS0wLjIpXG4gICAgIFxuICAgICAgICAjIHRyeSB2aWV3IGJvdCBmcm9tIGJlaGluZFxuICAgICAgICAjIGNhbGN1bGF0ZSBob3Jpem9udGFsIGFuZ2xlIGJldHdlZW4gYm90IG9yaWVudGF0aW9uIGFuZCB2ZWN0b3IgdG8gY2FtZXJhXG4gICAgICAgIG1hcHBlZFRvWFogPSAoYm90VG9DYW1lcmEubWludXMgcGxheWVyVXAubXVsKGJvdFRvQ2FtZXJhLmRvdCBwbGF5ZXJVcCkpLm5vcm1hbCgpXG4gICAgICAgIGhvcml6b250YWxBbmdsZSA9IFZlY3Rvci5SQUQyREVHIE1hdGguYWNvcyhjbGFtcCgtMS4wLCAxLjAsIC1wbGF5ZXJEaXIuZG90IG1hcHBlZFRvWFopKVxuICAgICAgICBpZiBib3RUb0NhbWVyYU5vcm1hbC5kb3QocGxheWVyTGVmdCkgPCAwXG4gICAgICAgICAgICBob3Jpem9udGFsQW5nbGUgPSAtaG9yaXpvbnRhbEFuZ2xlXG4gICAgICAgIHJvdFF1YXQgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yIGhvcml6b250YWxBbmdsZS8ocm90RmFjdG9yKjQwMC4wKSwgcGxheWVyVXAgXG4gICAgICAgIGNhbVBvcyA9IHBsYXllclBvcy5wbHVzIHJvdFF1YXQucm90YXRlIGJvdFRvQ2FtZXJhXG5cbiAgICAgICAgYm90VG9DYW1lcmEgPSBjYW1Qb3MubWludXMgcGxheWVyUG9zXG4gICAgICAgIGJvdFRvQ2FtZXJhTm9ybWFsID0gYm90VG9DYW1lcmEubm9ybWFsKClcbiAgICBcbiAgICAgICAgQHNldFBvc2l0aW9uIGNhbVBvcyAjIGZpbmFsbHksIHNldCB0aGUgcG9zaXRpb25cbiAgICAgICAgXG4gICAgICAgICMgc2xvd2x5IGFkanVzdCBsb29rIGRpcmVjdGlvbiBieSBpbnRlcnBvbGF0aW5nIGN1cnJlbnQgYW5kIGRlc2lyZWQgZGlyZWN0aW9uc1xuICAgICAgICBsb29rRGVsdGEgPSBAZ2V0WlZlY3RvcigpLmRvdCBib3RUb0NhbWVyYU5vcm1hbFxuICAgICAgICBsb29rRGVsdGEgKj0gbG9va0RlbHRhIC8gMzAuMCAgICBcbiAgICAgICAgbmV3TG9va1ZlY3RvciA9IEBnZXRaVmVjdG9yKCkubXVsKDEuMC1sb29rRGVsdGEpLnBsdXMgYm90VG9DYW1lcmFOb3JtYWwubmVnKCkubXVsKGxvb2tEZWx0YSlcbiAgICAgICAgbmV3TG9va1ZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICBcbiAgICAgICAgIyBzbG93bHkgYWRqdXN0IHVwIHZlY3RvciBieSBpbnRlcnBvbGF0aW5nIGN1cnJlbnQgYW5kIGRlc2lyZWQgdXAgdmVjdG9yc1xuICAgICAgICB1cERlbHRhID0gMS41LUBnZXRZVmVjdG9yKCkuZG90IHBsYXllclVwXG4gICAgICAgIHVwRGVsdGEgKj0gdXBEZWx0YSAvIDEwMC4wICAgIFxuICAgICAgICBuZXdVcFZlY3RvciA9IEBnZXRZVmVjdG9yKCkubXVsKDEuMC11cERlbHRhKS5wbHVzIHBsYXllclVwLm11bCh1cERlbHRhKVxuICAgICAgICBuZXdVcFZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICBcbiAgICAgICAgbmV3TGVmdFZlY3RvciA9IG5ld1VwVmVjdG9yLmNyb3NzIG5ld0xvb2tWZWN0b3JcbiAgICBcbiAgICAgICAgIyBmaW5pc2hlZCBpbnRlcnBvbGF0aW9ucywgdXBkYXRlIGNhbWVyYSBtYXRyaXhcbiAgICAgICAgQHNldFhWZWN0b3IgbmV3TGVmdFZlY3RvclxuICAgICAgICBAc2V0WVZlY3RvciBuZXdVcFZlY3RvclxuICAgICAgICBAc2V0WlZlY3RvciBuZXdMb29rVmVjdG9yXG4gICAgICAgIEBwcm9qZWN0aW9uXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBDYW1lcmEiXX0=
//# sourceURL=../coffee/camera.coffee