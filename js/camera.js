// koffee 1.4.0
var Camera, Matrix, Quaternion, Vector, clamp,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

clamp = require('kxk').clamp;

Matrix = require('./lib/matrix');

Vector = require('./lib/vector');

Quaternion = require('./lib/quaternion');

Camera = (function(superClass) {
    extend(Camera, superClass);

    Camera.INSIDE = 0;

    Camera.BEHIND = 1;

    Camera.FOLLOW = 2;

    function Camera(player, opt) {
        var ref, ref1, ref2, ref3;
        this.player = player;
        this.fov = (ref = opt != null ? opt.fov : void 0) != null ? ref : 90;
        this.near = (ref1 = opt != null ? opt.near : void 0) != null ? ref1 : 0.01;
        this.eye_distance = this.near;
        this.far = (ref2 = opt != null ? opt.far : void 0) != null ? ref2 : 30;
        this.mode = Camera.BEHIND;
        this.aspect = (ref3 = opt.aspect) != null ? ref3 : -1;
        this.dist = 10;
        Camera.__super__.constructor.apply(this, arguments);
        this.cam = new THREE.PerspectiveCamera(this.fov, this.aspect, this.near, this.far);
        this.cam.position.z = this.dist;
    }

    Camera.prototype.step = function() {
        var camPos, pos;
        switch (this.mode) {
            case Camera.INSIDE:
                this.insideProjection();
                break;
            case Camera.BEHIND:
                this.behindProjection();
                break;
            case Camera.FOLLOW:
                this.followProjection();
        }
        camPos = this.getPosition();
        this.cam.position.copy(camPos);
        this.cam.up.copy(this.getYVector());
        this.lookAt(camPos.plus(this.getZVector()));
        this.cam.updateProjectionMatrix();
        if (this.light != null) {
            pos = this.getPosition().plus(this.light_offset);
            this.light.setDirection(-this.getZVector());
            return this.light.setPosition(new Vector(pos[X], pos[Y], pos[Z], 1.0));
        }
    };

    Camera.prototype.getLookAtPosition = function() {
        return this.getZVector().mul(-this.eye_distance).plus(this.getPosition());
    };

    Camera.prototype.setOrientation = function(o) {
        this.setYVector(o.rotate(Vector.unitY));
        this.setZVector(o.rotate(Vector.unitZ));
        this.setXVector(o.rotate(Vector.minusX));
        this.cam.up.copy(this.getYVector());
        return this.lookAt(this.getPosition().plus(this.getZVector()));
    };

    Camera.prototype.lookAt = function(v) {
        return this.cam.lookAt(v.threeVector());
    };

    Camera.prototype.setFov = function(fov) {
        return this.fov = Math.max(2.0, Math.min(fov, 175.0));
    };

    Camera.prototype.insideProjection = function() {
        var camPos, lookAngle, lookDelta, newLookVector, playerDir, playerPos, playerUp, posDelta, rot;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        lookAngle = this.player.look_angle;
        posDelta = world.getSpeed() / 10.0;
        camPos = playerPos;
        if (lookAngle < 0) {
            camPos.add(playerUp.mul(-2 * lookAngle / 90));
        }
        this.setPosition(this.getPosition().mul(1.0 - posDelta).plus(camPos.mul(posDelta)));
        if (lookAngle) {
            this.setXVector(playerDir.cross(playerUp).normal());
            rot = Quaternion.rotationAroundVector(lookAngle, this.getXVector());
            this.setYVector(rot.rotate(playerUp));
            this.setZVector(rot.rotate(playerDir));
        } else {
            lookDelta = (2.0 - this.getZVector().dot(playerDir)) * world.getSpeed() / 50.0;
            newLookVector = this.getZVector().mul(1.0 - lookDelta).plus(playerDir.mul(lookDelta));
            newLookVector.normalize();
            this.setXVector(playerUp.cross(newLookVector).normal());
            this.setYVector(playerUp);
            this.setZVector(newLookVector);
        }
        return this.projection;
    };

    Camera.prototype.behindProjection = function() {
        var botToCamera, camPos, lookAngle, lookDelta, min_f, newLookVector, playerDir, playerPos, playerUp, posDelta, rot;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        lookAngle = this.player.look_angle;
        botToCamera = playerUp.minus(playerDir.mul(2));
        min_f = botToCamera.length();
        botToCamera.normalize();
        min_f = Math.min(world.getWallDistanceForRay(playerPos, botToCamera), min_f);
        camPos = playerPos.plus(botToCamera.mul(Math.max(min_f, 0.72) * (1 - Math.abs(lookAngle) / 90)));
        if (lookAngle < 0) {
            camPos.add(playerUp.mul(-2 * lookAngle / 90));
        }
        camPos = world.getInsideWallPosWithDelta(camPos, 0.2);
        posDelta = 0.2;
        this.setPosition(this.getPosition().mul(1.0 - posDelta).plus(camPos.mul(posDelta)));
        if (lookAngle) {
            this.setXVector(playerDir.cross(playerUp).normal());
            rot = Quaternion.rotationAroundVector(lookAngle, this.getXVector());
            this.setYVector(rot.rotate(playerUp));
            return this.setZVector(rot.rotate(playerDir));
        } else {
            lookDelta = 0.3;
            newLookVector = this.getZVector().mul(1.0 - lookDelta).plus((playerDir.minus(playerUp.mul(0.2)).normal()).mul(lookDelta));
            newLookVector.normalize();
            this.setZVector(newLookVector);
            this.setXVector(playerUp.cross(newLookVector).normal());
            return this.setYVector(newLookVector.cross(this.getXVector()).normal());
        }
    };

    Camera.prototype.followProjection = function() {
        var botToCamera, botToCameraNormal, camPos, cameraBotDistance, delta, desiredDistance, difference, horizontalAngle, lookDelta, mappedToXZ, newLeftVector, newLookVector, newUpVector, playerDir, playerLeft, playerPos, playerUp, rotFactor, rotQuat, upDelta, verticalAngle, wall_distance;
        camPos = this.getPosition();
        desiredDistance = 2.0;
        playerPos = this.player.currentPos();
        playerDir = this.player.currentDir();
        playerUp = this.player.currentUp();
        playerLeft = this.player.currentLeft();
        botToCamera = camPos.minus(playerPos);
        cameraBotDistance = botToCamera.length();
        if (cameraBotDistance >= desiredDistance) {
            difference = cameraBotDistance - desiredDistance;
            delta = difference * difference / 400.0;
            camPos = camPos.mul(1.0 - delta).plus(playerPos.mul(delta));
        } else {
            difference = desiredDistance - cameraBotDistance;
            delta = difference / 20.0;
            camPos = camPos.mul(1.0 - delta).plus((playerPos.plus(botToCamera.normal().mul(desiredDistance))).mul(delta));
        }
        botToCamera = camPos.minus(playerPos);
        botToCameraNormal = botToCamera.normal();
        verticalAngle = Vector.RAD2DEG(Math.acos(clamp(-1.0, 1.0, botToCameraNormal.dot(playerUp))));
        if (verticalAngle > 45) {
            rotQuat = Quaternion.rotationAroundVector(verticalAngle / 400.0, botToCameraNormal.cross(playerUp));
            botToCamera = rotQuat.rotate(botToCamera);
            botToCameraNormal = botToCamera.normal();
            camPos = playerPos.plus(botToCamera);
        }
        rotFactor = 1.0;
        wall_distance = world.getWallDistanceForPos(camPos);
        if (wall_distance < 0.5) {
            if (wall_distance < 0.2) {
                camPos = world.getInsideWallPosWithDelta(camPos, 0.2);
                botToCamera = camPos.minus(playerPos);
                botToCameraNormal = botToCamera.normal();
            }
            rotFactor = 0.5 / (wall_distance - 0.2);
        }
        mappedToXZ = (botToCamera.minus(playerUp.mul(botToCamera.dot(playerUp)))).normal();
        horizontalAngle = Vector.RAD2DEG(Math.acos(clamp(-1.0, 1.0, -playerDir.dot(mappedToXZ))));
        if (botToCameraNormal.dot(playerLeft) < 0) {
            horizontalAngle = -horizontalAngle;
        }
        rotQuat = Quaternion.rotationAroundVector(horizontalAngle / (rotFactor * 400.0), playerUp);
        camPos = playerPos.plus(rotQuat.rotate(botToCamera));
        botToCamera = camPos.minus(playerPos);
        botToCameraNormal = botToCamera.normal();
        this.setPosition(camPos);
        lookDelta = this.getZVector().dot(botToCameraNormal);
        lookDelta *= lookDelta / 30.0;
        newLookVector = this.getZVector().mul(1.0 - lookDelta).plus(botToCameraNormal.neg().mul(lookDelta));
        newLookVector.normalize();
        upDelta = 1.5 - this.getYVector().dot(playerUp);
        upDelta *= upDelta / 100.0;
        newUpVector = this.getYVector().mul(1.0 - upDelta).plus(playerUp.mul(upDelta));
        newUpVector.normalize();
        newLeftVector = newUpVector.cross(newLookVector);
        this.setXVector(newLeftVector);
        this.setYVector(newUpVector);
        this.setZVector(newLookVector);
        return this.projection;
    };

    return Camera;

})(Matrix);

module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FtZXJhLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSx5Q0FBQTtJQUFBOzs7QUFBRSxRQUFVLE9BQUEsQ0FBUSxLQUFSOztBQUVaLE1BQUEsR0FBYyxPQUFBLENBQVEsY0FBUjs7QUFDZCxNQUFBLEdBQWMsT0FBQSxDQUFRLGNBQVI7O0FBQ2QsVUFBQSxHQUFjLE9BQUEsQ0FBUSxrQkFBUjs7QUFFUjs7O0lBRUYsTUFBQyxDQUFBLE1BQUQsR0FBVTs7SUFDVixNQUFDLENBQUEsTUFBRCxHQUFVOztJQUNWLE1BQUMsQ0FBQSxNQUFELEdBQVU7O0lBRVAsZ0JBQUMsTUFBRCxFQUFVLEdBQVY7QUFDQyxZQUFBO1FBREEsSUFBQyxDQUFBLFNBQUQ7UUFDQSxJQUFDLENBQUEsR0FBRCwwREFBcUI7UUFDckIsSUFBQyxDQUFBLElBQUQsNkRBQXNCO1FBQ3RCLElBQUMsQ0FBQSxZQUFELEdBQWdCLElBQUMsQ0FBQTtRQUNqQixJQUFDLENBQUEsR0FBRCw0REFBcUI7UUFDckIsSUFBQyxDQUFBLElBQUQsR0FBVSxNQUFNLENBQUM7UUFDakIsSUFBQyxDQUFBLE1BQUQsd0NBQXVCLENBQUM7UUFDeEIsSUFBQyxDQUFBLElBQUQsR0FBVTtRQUVWLHlDQUFBLFNBQUE7UUFFQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUksS0FBSyxDQUFDLGlCQUFWLENBQTRCLElBQUMsQ0FBQSxHQUE3QixFQUFrQyxJQUFDLENBQUEsTUFBbkMsRUFBMkMsSUFBQyxDQUFBLElBQTVDLEVBQWtELElBQUMsQ0FBQSxHQUFuRDtRQUVQLElBQUMsQ0FBQSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQWQsR0FBa0IsSUFBQyxDQUFBO0lBYnBCOztxQkFlSCxJQUFBLEdBQU0sU0FBQTtBQUVGLFlBQUE7QUFBQSxnQkFBTyxJQUFDLENBQUEsSUFBUjtBQUFBLGlCQUNTLE1BQU0sQ0FBQyxNQURoQjtnQkFDNEIsSUFBQyxDQUFB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QUQsQ0FBWSxhQUFaO1FBQ0EsSUFBQyxDQUFBLFVBQUQsQ0FBWSxXQUFaO1FBQ0EsSUFBQyxDQUFBLFVBQUQsQ0FBWSxhQUFaO2VBQ0EsSUFBQyxDQUFBO0lBaEZhOzs7O0dBL0lEOztBQWlPckIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJcbiMgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwIFxuIyAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4jICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwMDBcbiMgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuIyAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG5cbnsgY2xhbXAgfSA9IHJlcXVpcmUgJ2t4aydcblxuTWF0cml4ICAgICAgPSByZXF1aXJlICcuL2xpYi9tYXRyaXgnXG5WZWN0b3IgICAgICA9IHJlcXVpcmUgJy4vbGliL3ZlY3RvcidcblF1YXRlcm5pb24gID0gcmVxdWlyZSAnLi9saWIvcXVhdGVybmlvbidcblxuY2xhc3MgQ2FtZXJhIGV4dGVuZHMgTWF0cml4XG5cbiAgICBASU5TSURFID0gMCBcbiAgICBAQkVISU5EID0gMSBcbiAgICBARk9MTE9XID0gMlxuICAgICAgICBcbiAgICBAOiAoQHBsYXllciwgb3B0KSAtPlxuICAgICAgICBAZm92ICAgID0gb3B0Py5mb3YgPyA5MFxuICAgICAgICBAbmVhciAgID0gb3B0Py5uZWFyID8gMC4wMVxuICAgICAgICBAZXllX2Rpc3RhbmNlID0gQG5lYXJcbiAgICAgICAgQGZhciAgICA9IG9wdD8uZmFyID8gMzBcbiAgICAgICAgQG1vZGUgICA9IENhbWVyYS5CRUhJTkRcbiAgICAgICAgQGFzcGVjdCA9IG9wdC5hc3BlY3QgPyAtMVxuICAgICAgICBAZGlzdCAgID0gMTBcbiAgICAgICAgXG4gICAgICAgIHN1cGVyXG4gICAgICAgIFxuICAgICAgICBAY2FtID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhIEBmb3YsIEBhc3BlY3QsIEBuZWFyLCBAZmFyXG4gICAgICAgIFxuICAgICAgICBAY2FtLnBvc2l0aW9uLnogPSBAZGlzdFxuICAgICAgICAgICAgICAgIFxuICAgIHN0ZXA6IC0+XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggQG1vZGVcbiAgICAgICAgICAgIHdoZW4gQ2FtZXJhLklOU0lERSB0aGVuIEBpbnNpZGVQcm9qZWN0aW9uKCkgICAgIFxuICAgICAgICAgICAgd2hlbiBDYW1lcmEuQkVISU5EIHRoZW4gQGJlaGluZFByb2plY3Rpb24oKVxuICAgICAgICAgICAgd2hlbiBDYW1lcmEuRk9MTE9XIHRoZW4gQGZvbGxvd1Byb2plY3Rpb24oKVxuICAgICAgICBcbiAgICAgICAgY2FtUG9zID0gQGdldFBvc2l0aW9uKClcbiAgICAgICAgQGNhbS5wb3NpdGlvbi5jb3B5IGNhbVBvc1xuICAgICAgICBAY2FtLnVwLmNvcHkgQGdldFlWZWN0b3IoKVxuXG4gICAgICAgIEBsb29rQXQgY2FtUG9zLnBsdXMgQGdldFpWZWN0b3IoKVxuXG4gICAgICAgIEBjYW0udXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpXG5cbiAgICAgICAgaWYgQGxpZ2h0P1xuICAgICAgICAgICAgcG9zID0gQGdldFBvc2l0aW9uKCkucGx1cyBAbGlnaHRfb2Zmc2V0XG4gICAgICAgICAgICBAbGlnaHQuc2V0RGlyZWN0aW9uIC1AZ2V0WlZlY3RvcigpXG4gICAgICAgICAgICBAbGlnaHQuc2V0UG9zaXRpb24gbmV3IFZlY3RvciBwb3NbWF0sIHBvc1tZXSwgcG9zW1pdLCAxLjAgIyBwb3NpdGlvbmFsIGxpZ2h0IHNvdXJjZVxuICAgIFxuICAgIGdldExvb2tBdFBvc2l0aW9uOiAtPiBAZ2V0WlZlY3RvcigpLm11bCgtQGV5ZV9kaXN0YW5jZSkucGx1cyBAZ2V0UG9zaXRpb24oKVxuICAgIFxuICAgIHNldE9yaWVudGF0aW9uOiAobykgLT5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNldFlWZWN0b3Igby5yb3RhdGUgVmVjdG9yLnVuaXRZXG4gICAgICAgIEBzZXRaVmVjdG9yIG8ucm90YXRlIFZlY3Rvci51bml0WlxuICAgICAgICBAc2V0WFZlY3RvciBvLnJvdGF0ZSBWZWN0b3IubWludXNYXG4gICAgICAgIEBjYW0udXAuY29weSBAZ2V0WVZlY3RvcigpXG4gICAgICAgIFxuICAgICAgICBAbG9va0F0IEBnZXRQb3NpdGlvbigpLnBsdXMgQGdldFpWZWN0b3IoKVxuICAgICAgICBcbiAgICBsb29rQXQ6ICh2KSAtPiBAY2FtLmxvb2tBdCB2LnRocmVlVmVjdG9yKClcbiAgICAgICAgICAgICAgICBcbiAgICBzZXRGb3Y6IChmb3YpIC0+IEBmb3YgPSBNYXRoLm1heCgyLjAsIE1hdGgubWluIGZvdiwgMTc1LjApXG4gICAgICAgICAgICBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgICAwMDAwMDAwICAgICAgICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAgICAwMDAgICAgICAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMFxuICAgICMgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgXG4gICAgaW5zaWRlUHJvamVjdGlvbjogKCkgLT5cbiAgICAgICAgXG4gICAgICAgIHBsYXllclBvcyA9IEBwbGF5ZXIuY3VycmVudFBvcygpXG4gICAgICAgIHBsYXllckRpciA9IEBwbGF5ZXIuY3VycmVudERpcigpXG4gICAgICAgIHBsYXllclVwICA9IEBwbGF5ZXIuY3VycmVudFVwKClcbiAgICAgICAgbG9va0FuZ2xlID0gQHBsYXllci5sb29rX2FuZ2xlXG4gICAgICAgIFxuICAgICAgICBwb3NEZWx0YSA9IHdvcmxkLmdldFNwZWVkKCkgLyAxMC4wICMgc21vb3RoIGNhbWVyYSBtb3ZlbWVudCBhIGxpdHRsZSBiaXRcbiAgICAgICAgY2FtUG9zID0gcGxheWVyUG9zXG4gICAgICAgIGlmIGxvb2tBbmdsZSA8IDBcbiAgICAgICAgICAgIGNhbVBvcy5hZGQgcGxheWVyVXAubXVsIC0yKmxvb2tBbmdsZS85MFxuICAgICAgICBAc2V0UG9zaXRpb24gQGdldFBvc2l0aW9uKCkubXVsKDEuMC1wb3NEZWx0YSkucGx1cyBjYW1Qb3MubXVsIHBvc0RlbHRhXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgbG9va0FuZ2xlICMgcGxheWVyIGlzIGxvb2tpbmcgdXAgb3IgZG93blxuICAgICAgICAgICAgQHNldFhWZWN0b3IgcGxheWVyRGlyLmNyb3NzKHBsYXllclVwKS5ub3JtYWwoKVxuICAgICAgICAgICAgcm90ID0gUXVhdGVybmlvbi5yb3RhdGlvbkFyb3VuZFZlY3RvciBsb29rQW5nbGUsIEBnZXRYVmVjdG9yKClcbiAgICAgICAgICAgIEBzZXRZVmVjdG9yIHJvdC5yb3RhdGUgcGxheWVyVXAgXG4gICAgICAgICAgICBAc2V0WlZlY3RvciByb3Qucm90YXRlIHBsYXllckRpciAjLm5lZygpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgICMgc21vb3RoIGNhbWVyYSByb3RhdGlvbiBhIGxpdHRsZSBiaXRcbiAgICAgICAgICAgIGxvb2tEZWx0YSA9ICgyLjAgLSBAZ2V0WlZlY3RvcigpLmRvdCBwbGF5ZXJEaXIpICogd29ybGQuZ2V0U3BlZWQoKSAvIDUwLjBcbiAgICAgICAgICAgIG5ld0xvb2tWZWN0b3IgPSBAZ2V0WlZlY3RvcigpLm11bCgxLjAgLSBsb29rRGVsdGEpLnBsdXMgcGxheWVyRGlyLm11bCBsb29rRGVsdGFcbiAgICAgICAgICAgIG5ld0xvb2tWZWN0b3Iubm9ybWFsaXplKClcbiAgICAgICAgICAgIEBzZXRYVmVjdG9yIHBsYXllclVwLmNyb3NzKG5ld0xvb2tWZWN0b3IpLm5vcm1hbCgpXG4gICAgICAgICAgICBAc2V0WVZlY3RvciBwbGF5ZXJVcFxuICAgICAgICAgICAgQHNldFpWZWN0b3IgbmV3TG9va1ZlY3RvclxuICAgICAgICAgICAgXG4gICAgICAgIEBwcm9qZWN0aW9uXG4gICAgXG4gICAgIyAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBiZWhpbmRQcm9qZWN0aW9uOiAtPlxuICAgICAgICBcbiAgICAgICAgcGxheWVyUG9zID0gQHBsYXllci5jdXJyZW50UG9zKClcbiAgICAgICAgcGxheWVyRGlyID0gQHBsYXllci5jdXJyZW50RGlyKClcbiAgICAgICAgcGxheWVyVXAgID0gQHBsYXllci5jdXJyZW50VXAoKVxuICAgICAgICBsb29rQW5nbGUgPSBAcGxheWVyLmxvb2tfYW5nbGVcbiAgICAgICAgXG4gICAgICAgICMgZmluZCBhIHZhbGlkIGNhbWVyYSBwb3NpdGlvblxuICAgICAgICBib3RUb0NhbWVyYSA9IHBsYXllclVwLm1pbnVzIHBsYXllckRpci5tdWwgMlxuICAgICAgICBtaW5fZiA9IGJvdFRvQ2FtZXJhLmxlbmd0aCgpXG4gICAgICAgIGJvdFRvQ2FtZXJhLm5vcm1hbGl6ZSgpXG4gICAgICAgIFxuICAgICAgICBtaW5fZiA9IE1hdGgubWluIHdvcmxkLmdldFdhbGxEaXN0YW5jZUZvclJheShwbGF5ZXJQb3MsIGJvdFRvQ2FtZXJhKSwgbWluX2ZcbiAgICAgICAgY2FtUG9zID0gcGxheWVyUG9zLnBsdXMgYm90VG9DYW1lcmEubXVsIE1hdGgubWF4KG1pbl9mLCAwLjcyKSAqICgxLU1hdGguYWJzKGxvb2tBbmdsZSkvOTApXG4gICAgICAgIGlmIGxvb2tBbmdsZSA8IDBcbiAgICAgICAgICAgIGNhbVBvcy5hZGQgcGxheWVyVXAubXVsIC0yKmxvb2tBbmdsZS85MFxuICAgICAgICBcbiAgICAgICAgY2FtUG9zID0gd29ybGQuZ2V0SW5zaWRlV2FsbFBvc1dpdGhEZWx0YSBjYW1Qb3MsIDAuMlxuICAgICAgICAgICAgXG4gICAgICAgICMgc21vb3RoIGNhbWVyYSBtb3ZlbWVudCBhIGxpdHRsZSBiaXRcbiAgICAgICAgcG9zRGVsdGEgPSAwLjJcbiAgICAgICAgXG4gICAgICAgIEBzZXRQb3NpdGlvbiBAZ2V0UG9zaXRpb24oKS5tdWwoMS4wIC0gcG9zRGVsdGEpLnBsdXMgY2FtUG9zLm11bCBwb3NEZWx0YVxuICAgICAgICAgICAgXG4gICAgICAgIGlmIGxvb2tBbmdsZVxuICAgICAgICAgICAgIyBrbG9nIFwibG9va19hbmdsZSAje2xvb2tBbmdsZX1cIlxuICAgICAgICAgICAgQHNldFhWZWN0b3IgcGxheWVyRGlyLmNyb3NzKHBsYXllclVwKS5ub3JtYWwoKSBcbiAgICAgICAgICAgIHJvdCA9IFF1YXRlcm5pb24ucm90YXRpb25Bcm91bmRWZWN0b3IgbG9va0FuZ2xlLCBAZ2V0WFZlY3RvcigpIFxuICAgICAgICAgICAgQHNldFlWZWN0b3Igcm90LnJvdGF0ZSBwbGF5ZXJVcCAgXG4gICAgICAgICAgICBAc2V0WlZlY3RvciByb3Qucm90YXRlIHBsYXllckRpciAjLm5lZygpICBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgIyBzbW9vdGggY2FtZXJhIHJvdGF0aW9uIGEgbGl0dGxlIGJpdFxuICAgICAgICAgICAgbG9va0RlbHRhID0gMC4zXG4gICAgICAgICAgICBuZXdMb29rVmVjdG9yID0gQGdldFpWZWN0b3IoKS5tdWwoMS4wIC0gbG9va0RlbHRhKS5wbHVzIChwbGF5ZXJEaXIubWludXMocGxheWVyVXAubXVsKDAuMikpLm5vcm1hbCgpKS5tdWwgbG9va0RlbHRhXG4gICAgICAgICAgICBuZXdMb29rVmVjdG9yLm5vcm1hbGl6ZSgpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBzZXRaVmVjdG9yIG5ld0xvb2tWZWN0b3IgIFxuICAgICAgICAgICAgQHNldFhWZWN0b3IgcGxheWVyVXAuY3Jvc3MobmV3TG9va1ZlY3Rvcikubm9ybWFsKCkgXG4gICAgICAgICAgICBAc2V0WVZlY3RvciBuZXdMb29rVmVjdG9yLmNyb3NzKEBnZXRYVmVjdG9yKCkpLm5vcm1hbCgpIFxuICAgICAgICBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMCAgICAgMDBcblxuICAgIGZvbGxvd1Byb2plY3Rpb246IC0+XG4gICAgICAgIFxuICAgICAgICBjYW1Qb3MgPSBAZ2V0UG9zaXRpb24oKVxuICAgICAgICBkZXNpcmVkRGlzdGFuY2UgPSAyLjAgIyBkZXNpcmVkIGRpc3RhbmNlIGZyb20gY2FtZXJhIHRvIGJvdFxuICAgIFxuICAgICAgICBwbGF5ZXJQb3MgICA9IEBwbGF5ZXIuY3VycmVudFBvcygpXG4gICAgICAgIHBsYXllckRpciAgID0gQHBsYXllci5jdXJyZW50RGlyKClcbiAgICAgICAgcGxheWVyVXAgICAgPSBAcGxheWVyLmN1cnJlbnRVcCgpXG4gICAgICAgIHBsYXllckxlZnQgID0gQHBsYXllci5jdXJyZW50TGVmdCgpXG4gICAgXG4gICAgICAgICMgZmlyc3QsIGFkanVzdCBkaXN0YW5jZSBmcm9tIGNhbWVyYSB0byBib3RcbiAgICAgICAgIFxuICAgICAgICBib3RUb0NhbWVyYSA9IGNhbVBvcy5taW51cyBwbGF5ZXJQb3MgICAgICMgdmVjdG9yIGZyb20gYm90IHRvIGN1cnJlbnQgcG9zXG4gICAgICAgIGNhbWVyYUJvdERpc3RhbmNlID0gYm90VG9DYW1lcmEubGVuZ3RoKCkgIyBkaXN0YW5jZSBmcm9tIGNhbWVyYSB0byBib3RcbiAgICAgICAgXG4gICAgICAgIGlmIGNhbWVyYUJvdERpc3RhbmNlID49IGRlc2lyZWREaXN0YW5jZVxuICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGNhbWVyYUJvdERpc3RhbmNlIC0gZGVzaXJlZERpc3RhbmNlXG4gICAgICAgICAgICBkZWx0YSA9IGRpZmZlcmVuY2UqZGlmZmVyZW5jZS80MDAuMCAgIyB3ZWlnaHQgZm9yIGZvbGxvd2luZyBzcGVlZFxuICAgICAgICAgICAgY2FtUG9zID0gY2FtUG9zLm11bCgxLjAtZGVsdGEpLnBsdXMgcGxheWVyUG9zLm11bCBkZWx0YVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBkaWZmZXJlbmNlID0gZGVzaXJlZERpc3RhbmNlIC0gY2FtZXJhQm90RGlzdGFuY2VcbiAgICAgICAgICAgIGRlbHRhID0gZGlmZmVyZW5jZS8yMC4wICMgd2VpZ2h0IGZvciBuZWdhdGl2ZSBmb2xsb3dpbmcgc3BlZWRcbiAgICAgICAgICAgIGNhbVBvcyA9IGNhbVBvcy5tdWwoMS4wLWRlbHRhKS5wbHVzIChwbGF5ZXJQb3MucGx1cyBib3RUb0NhbWVyYS5ub3JtYWwoKS5tdWwgZGVzaXJlZERpc3RhbmNlKS5tdWwgZGVsdGFcbiAgICBcbiAgICAgICAgIyBzZWNvbmQsIHJvdGF0ZSBhcm91bmQgYm90XG4gICAgXG4gICAgICAgIGJvdFRvQ2FtZXJhID0gY2FtUG9zLm1pbnVzIHBsYXllclBvc1xuICAgICAgICBib3RUb0NhbWVyYU5vcm1hbCA9IGJvdFRvQ2FtZXJhLm5vcm1hbCgpXG4gICAgIFxuICAgICAgICAjIHJvdGF0ZSBjYW1lcmEgdmVydGljYWxseVxuICAgICAgICB2ZXJ0aWNhbEFuZ2xlID0gVmVjdG9yLlJBRDJERUcgTWF0aC5hY29zKGNsYW1wKC0xLjAsIDEuMCwgYm90VG9DYW1lcmFOb3JtYWwuZG90IHBsYXllclVwKSlcbiAgICAgICAgaWYgdmVydGljYWxBbmdsZSA+IDQ1XG4gICAgICAgICAgICAjIGtsb2cgXCJ2ZXJ0aWNhbEFuZ2xlICN7dmVydGljYWxBbmdsZX1cIlxuICAgICAgICAgICAgcm90UXVhdCAgICAgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yKHZlcnRpY2FsQW5nbGUvNDAwLjAsIGJvdFRvQ2FtZXJhTm9ybWFsLmNyb3NzKHBsYXllclVwKSlcbiAgICAgICAgICAgIGJvdFRvQ2FtZXJhID0gcm90UXVhdC5yb3RhdGUgYm90VG9DYW1lcmEgXG4gICAgICAgICAgICBib3RUb0NhbWVyYU5vcm1hbCA9IGJvdFRvQ2FtZXJhLm5vcm1hbCgpXG4gICAgICAgICAgICBjYW1Qb3MgICAgICA9IHBsYXllclBvcy5wbHVzIGJvdFRvQ2FtZXJhXG5cbiAgICAgICAgcm90RmFjdG9yID0gMS4wXG5cbiAgICAgICAgd2FsbF9kaXN0YW5jZSA9IHdvcmxkLmdldFdhbGxEaXN0YW5jZUZvclBvcyBjYW1Qb3NcbiAgICAgICAgaWYgd2FsbF9kaXN0YW5jZSA8IDAuNSAjIHRyeSBhdm9pZCBwaWVyY2luZyB3YWxsc1xuICAgICAgICAgICAgaWYgd2FsbF9kaXN0YW5jZSA8IDAuMlxuICAgICAgICAgICAgICAgIGNhbVBvcyA9IHdvcmxkLmdldEluc2lkZVdhbGxQb3NXaXRoRGVsdGEgY2FtUG9zLCAwLjJcbiAgICAgICAgICAgICAgICBib3RUb0NhbWVyYSA9IGNhbVBvcy5taW51cyBwbGF5ZXJQb3NcbiAgICAgICAgICAgICAgICBib3RUb0NhbWVyYU5vcm1hbCA9IGJvdFRvQ2FtZXJhLm5vcm1hbCgpXG4gICAgICAgICAgICByb3RGYWN0b3IgPSAwLjUgLyAod2FsbF9kaXN0YW5jZS0wLjIpXG4gICAgIFxuICAgICAgICAjIHRyeSB2aWV3IGJvdCBmcm9tIGJlaGluZFxuICAgICAgICAjIGNhbGN1bGF0ZSBob3Jpem9udGFsIGFuZ2xlIGJldHdlZW4gYm90IG9yaWVudGF0aW9uIGFuZCB2ZWN0b3IgdG8gY2FtZXJhXG4gICAgICAgIG1hcHBlZFRvWFogPSAoYm90VG9DYW1lcmEubWludXMgcGxheWVyVXAubXVsKGJvdFRvQ2FtZXJhLmRvdCBwbGF5ZXJVcCkpLm5vcm1hbCgpXG4gICAgICAgIGhvcml6b250YWxBbmdsZSA9IFZlY3Rvci5SQUQyREVHIE1hdGguYWNvcyhjbGFtcCgtMS4wLCAxLjAsIC1wbGF5ZXJEaXIuZG90IG1hcHBlZFRvWFopKVxuICAgICAgICBpZiBib3RUb0NhbWVyYU5vcm1hbC5kb3QocGxheWVyTGVmdCkgPCAwXG4gICAgICAgICAgICBob3Jpem9udGFsQW5nbGUgPSAtaG9yaXpvbnRhbEFuZ2xlXG4gICAgICAgIHJvdFF1YXQgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yIGhvcml6b250YWxBbmdsZS8ocm90RmFjdG9yKjQwMC4wKSwgcGxheWVyVXAgXG4gICAgICAgIGNhbVBvcyA9IHBsYXllclBvcy5wbHVzIHJvdFF1YXQucm90YXRlIGJvdFRvQ2FtZXJhXG5cbiAgICAgICAgYm90VG9DYW1lcmEgPSBjYW1Qb3MubWludXMgcGxheWVyUG9zXG4gICAgICAgIGJvdFRvQ2FtZXJhTm9ybWFsID0gYm90VG9DYW1lcmEubm9ybWFsKClcbiAgICBcbiAgICAgICAgQHNldFBvc2l0aW9uIGNhbVBvcyAjIGZpbmFsbHksIHNldCB0aGUgcG9zaXRpb25cbiAgICAgICAgXG4gICAgICAgICMgc2xvd2x5IGFkanVzdCBsb29rIGRpcmVjdGlvbiBieSBpbnRlcnBvbGF0aW5nIGN1cnJlbnQgYW5kIGRlc2lyZWQgZGlyZWN0aW9uc1xuICAgICAgICBsb29rRGVsdGEgPSBAZ2V0WlZlY3RvcigpLmRvdCBib3RUb0NhbWVyYU5vcm1hbFxuICAgICAgICBsb29rRGVsdGEgKj0gbG9va0RlbHRhIC8gMzAuMCAgICBcbiAgICAgICAgbmV3TG9va1ZlY3RvciA9IEBnZXRaVmVjdG9yKCkubXVsKDEuMC1sb29rRGVsdGEpLnBsdXMgYm90VG9DYW1lcmFOb3JtYWwubmVnKCkubXVsKGxvb2tEZWx0YSlcbiAgICAgICAgbmV3TG9va1ZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICBcbiAgICAgICAgIyBzbG93bHkgYWRqdXN0IHVwIHZlY3RvciBieSBpbnRlcnBvbGF0aW5nIGN1cnJlbnQgYW5kIGRlc2lyZWQgdXAgdmVjdG9yc1xuICAgICAgICB1cERlbHRhID0gMS41LUBnZXRZVmVjdG9yKCkuZG90IHBsYXllclVwXG4gICAgICAgIHVwRGVsdGEgKj0gdXBEZWx0YSAvIDEwMC4wICAgIFxuICAgICAgICBuZXdVcFZlY3RvciA9IEBnZXRZVmVjdG9yKCkubXVsKDEuMC11cERlbHRhKS5wbHVzIHBsYXllclVwLm11bCh1cERlbHRhKVxuICAgICAgICBuZXdVcFZlY3Rvci5ub3JtYWxpemUoKVxuICAgICAgICBcbiAgICAgICAgbmV3TGVmdFZlY3RvciA9IG5ld1VwVmVjdG9yLmNyb3NzIG5ld0xvb2tWZWN0b3JcbiAgICBcbiAgICAgICAgIyBmaW5pc2hlZCBpbnRlcnBvbGF0aW9ucywgdXBkYXRlIGNhbWVyYSBtYXRyaXhcbiAgICAgICAgQHNldFhWZWN0b3IgbmV3TGVmdFZlY3RvclxuICAgICAgICBAc2V0WVZlY3RvciBuZXdVcFZlY3RvclxuICAgICAgICBAc2V0WlZlY3RvciBuZXdMb29rVmVjdG9yXG4gICAgICAgIEBwcm9qZWN0aW9uXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBDYW1lcmFcbiJdfQ==
//# sourceURL=../coffee/camera.coffee