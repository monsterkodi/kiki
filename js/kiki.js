// koffee 1.4.0
var Kiki, World, keyinfo,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

keyinfo = require('kxk').keyinfo;

World = require('./world');

Kiki = (function() {
    function Kiki(view) {
        this.view = view;
        this.resized = bind(this.resized, this);
        this.onKeyUp = bind(this.onKeyUp, this);
        this.onKeyDown = bind(this.onKeyDown, this);
        this.animate = bind(this.animate, this);
        this.paused = false;
        this.view.onkeydown = this.onKeyDown;
        this.view.onkeyup = this.onKeyUp;
        this.view.focus();
    }

    Kiki.prototype.start = function() {
        this.world = World.init(this.view);
        this.view.focus();
        this.animate();
        return this.interval = setInterval(this.animate, 16);
    };

    Kiki.prototype.animate = function() {
        if (!this.paused) {
            return this.world.step();
        }
    };

    Kiki.prototype.onKeyDown = function(event) {
        var combo, key, mod, ref;
        ref = keyinfo.forEvent(event), mod = ref.mod, key = ref.key, combo = ref.combo;
        if (!combo) {
            return;
        }
        if (key === 'right click') {
            return;
        }
        if (key === 'p') {
            this.paused = !this.paused;
            return;
        }
        return this.world.modKeyComboEventDown(mod, key, combo, event);
    };

    Kiki.prototype.onKeyUp = function(event) {
        var combo, key, mod, ref;
        ref = keyinfo.forEvent(event), mod = ref.mod, key = ref.key, combo = ref.combo;
        if (!combo) {
            return;
        }
        if (key === 'right click') {
            return;
        }
        return this.world.modKeyComboEventUp(mod, key, combo, event);
    };

    Kiki.prototype.resized = function() {
        return this.world.resized(this.view.clientWidth, this.view.clientHeight);
    };

    return Kiki;

})();

module.exports = Kiki;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2lraS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU9BLElBQUEsb0JBQUE7SUFBQTs7QUFBRSxVQUFZLE9BQUEsQ0FBUSxLQUFSOztBQUVkLEtBQUEsR0FBUSxPQUFBLENBQVEsU0FBUjs7QUFFRjtJQUVDLGNBQUMsSUFBRDtRQUFDLElBQUMsQ0FBQSxPQUFEOzs7OztRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVU7UUFFVixJQUFDLENBQUEsSUFBSSxDQUFDLFNBQU4sR0FBa0IsSUFBQyxDQUFBO1FBQ25CLElBQUMsQ0FBQSxJQUFJLENBQUMsT0FBTixHQUFrQixJQUFDLENBQUE7UUFFbkIsSUFBQyxDQUFBLElBQUksQ0FBQyxLQUFOLENBQUE7SUFQRDs7bUJBZUgsS0FBQSxHQUFPLFNBQUE7UUFFSCxJQUFDLENBQUEsS0FBRCxHQUFTLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBQyxDQUFBLElBQVo7UUFDVCxJQUFDLENBQUEsSUFBSSxDQUFDLEtBQU4sQ0FBQTtRQUNBLElBQUMsQ0FBQSxPQUFELENBQUE7ZUFDQSxJQUFDLENBQUEsUUFBRCxHQUFZLFdBQUEsQ0FBWSxJQUFDLENBQUEsT0FBYixFQUFzQixFQUF0QjtJQUxUOzttQkFhUCxPQUFBLEdBQVMsU0FBQTtRQUVMLElBQUcsQ0FBSSxJQUFDLENBQUEsTUFBUjttQkFDSSxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBQSxFQURKOztJQUZLOzttQkFXVCxTQUFBLEdBQVcsU0FBQyxLQUFEO0FBRVAsWUFBQTtRQUFBLE1BQW9CLE9BQU8sQ0FBQyxRQUFSLENBQWlCLEtBQWpCLENBQXBCLEVBQUMsYUFBRCxFQUFNLGFBQU4sRUFBVztRQUNYLElBQVUsQ0FBSSxLQUFkO0FBQUEsbUJBQUE7O1FBQ0EsSUFBVSxHQUFBLEtBQU8sYUFBakI7QUFBQSxtQkFBQTs7UUFDQSxJQUFHLEdBQUEsS0FBTyxHQUFWO1lBQ0ksSUFBQyxDQUFBLE1BQUQsR0FBVSxDQUFJLElBQUMsQ0FBQTtBQUNmLG1CQUZKOztlQUlBLElBQUMsQ0FBQSxLQUFLLENBQUMsb0JBQVAsQ0FBNEIsR0FBNUIsRUFBaUMsR0FBakMsRUFBc0MsS0FBdEMsRUFBNkMsS0FBN0M7SUFUTzs7bUJBV1gsT0FBQSxHQUFTLFNBQUMsS0FBRDtBQUVMLFlBQUE7UUFBQSxNQUFvQixPQUFPLENBQUMsUUFBUixDQUFpQixLQUFqQixDQUFwQixFQUFDLGFBQUQsRUFBTSxhQUFOLEVBQVc7UUFDWCxJQUFVLENBQUksS0FBZDtBQUFBLG1CQUFBOztRQUNBLElBQVUsR0FBQSxLQUFPLGFBQWpCO0FBQUEsbUJBQUE7O2VBQ0EsSUFBQyxDQUFBLEtBQUssQ0FBQyxrQkFBUCxDQUE0QixHQUE1QixFQUFpQyxHQUFqQyxFQUFzQyxLQUF0QyxFQUE2QyxLQUE3QztJQUxLOzttQkFPVCxPQUFBLEdBQVMsU0FBQTtlQUFHLElBQUMsQ0FBQSxLQUFLLENBQUMsT0FBUCxDQUFlLElBQUMsQ0FBQSxJQUFJLENBQUMsV0FBckIsRUFBa0MsSUFBQyxDQUFBLElBQUksQ0FBQyxZQUF4QztJQUFIOzs7Ozs7QUFFYixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIlxuIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiMgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwXG4jIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwICAgIDAwMFxuIyAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDBcbiMgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwXG5cbnsga2V5aW5mbyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5Xb3JsZCA9IHJlcXVpcmUgJy4vd29ybGQnXG5cbmNsYXNzIEtpa2lcbiAgICBcbiAgICBAOiAoQHZpZXcpIC0+XG4gICAgICAgIFxuICAgICAgICBAcGF1c2VkID0gZmFsc2VcbiAgICAgICAgXG4gICAgICAgIEB2aWV3Lm9ua2V5ZG93biA9IEBvbktleURvd25cbiAgICAgICAgQHZpZXcub25rZXl1cCAgID0gQG9uS2V5VXBcbiAgICAgICAgXG4gICAgICAgIEB2aWV3LmZvY3VzKClcbiAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgICAgMDAwICAgICBcbiAgICAjICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgc3RhcnQ6IC0+IFxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAd29ybGQgPSBXb3JsZC5pbml0IEB2aWV3XG4gICAgICAgIEB2aWV3LmZvY3VzKClcbiAgICAgICAgQGFuaW1hdGUoKVxuICAgICAgICBAaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCBAYW5pbWF0ZSwgMTZcblxuICAgICMgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgMDAgICAgIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGFuaW1hdGU6ID0+XG5cbiAgICAgICAgaWYgbm90IEBwYXVzZWRcbiAgICAgICAgICAgIEB3b3JsZC5zdGVwKClcblxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgb25LZXlEb3duOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICB7bW9kLCBrZXksIGNvbWJvfSA9IGtleWluZm8uZm9yRXZlbnQgZXZlbnRcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBjb21ib1xuICAgICAgICByZXR1cm4gaWYga2V5ID09ICdyaWdodCBjbGljaycgIyB3ZWlyZCByaWdodCBjb21tYW5kIGtleVxuICAgICAgICBpZiBrZXkgPT0gJ3AnIFxuICAgICAgICAgICAgQHBhdXNlZCA9IG5vdCBAcGF1c2VkXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIFxuICAgICAgICBAd29ybGQubW9kS2V5Q29tYm9FdmVudERvd24gbW9kLCBrZXksIGNvbWJvLCBldmVudFxuICAgXG4gICAgb25LZXlVcDogKGV2ZW50KSA9PlxuICAgICAgICBcbiAgICAgICAge21vZCwga2V5LCBjb21ib30gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50ICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBjb21ib1xuICAgICAgICByZXR1cm4gaWYga2V5ID09ICdyaWdodCBjbGljaycgIyB3ZWlyZCByaWdodCBjb21tYW5kIGtleVxuICAgICAgICBAd29ybGQubW9kS2V5Q29tYm9FdmVudFVwICAgbW9kLCBrZXksIGNvbWJvLCBldmVudFxuICAgIFxuICAgIHJlc2l6ZWQ6ID0+IEB3b3JsZC5yZXNpemVkIEB2aWV3LmNsaWVudFdpZHRoLCBAdmlldy5jbGllbnRIZWlnaHRcbiAgICBcbm1vZHVsZS5leHBvcnRzID0gS2lraVxuIl19
//# sourceURL=../coffee/kiki.coffee