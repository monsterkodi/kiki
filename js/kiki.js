// koffee 1.4.0
var Kiki, World, keyinfo, prefs, ref,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), keyinfo = ref.keyinfo, prefs = ref.prefs;

World = require('./world');

Kiki = (function() {
    function Kiki(view) {
        this.view = view;
        this.resized = bind(this.resized, this);
        this.onKeyUp = bind(this.onKeyUp, this);
        this.onKeyDown = bind(this.onKeyDown, this);
        this.animate = bind(this.animate, this);
        this.paused = false;
        this.view.onkeydown = this.onKeyDown;
        this.view.onkeyup = this.onKeyUp;
        this.view.focus();
    }

    Kiki.prototype.start = function() {
        this.world = World.init(this.view);
        this.world.fps = prefs.get('fps', 60);
        this.view.focus();
        this.animate();
        return this.interval = setInterval(this.animate, parseInt(1000 / global.world.fps));
    };

    Kiki.prototype.animate = function() {
        if (!this.paused) {
            return this.world.step();
        }
    };

    Kiki.prototype.onKeyDown = function(event) {
        var combo, key, mod, ref1;
        ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo;
        if (!combo) {
            return;
        }
        if (key === 'right click') {
            return;
        }
        if (key === 'p') {
            this.paused = !this.paused;
            return;
        }
        return this.world.modKeyComboEventDown(mod, key, combo, event);
    };

    Kiki.prototype.onKeyUp = function(event) {
        var combo, key, mod, ref1;
        ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo;
        if (!combo) {
            return;
        }
        if (key === 'right click') {
            return;
        }
        return this.world.modKeyComboEventUp(mod, key, combo, event);
    };

    Kiki.prototype.resized = function() {
        return this.world.resized(this.view.clientWidth, this.view.clientHeight);
    };

    return Kiki;

})();

module.exports = Kiki;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2lraS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU9BLElBQUEsZ0NBQUE7SUFBQTs7QUFBQSxNQUFxQixPQUFBLENBQVEsS0FBUixDQUFyQixFQUFFLHFCQUFGLEVBQVc7O0FBRVgsS0FBQSxHQUFRLE9BQUEsQ0FBUSxTQUFSOztBQUVGO0lBRUMsY0FBQyxJQUFEO1FBQUMsSUFBQyxDQUFBLE9BQUQ7Ozs7O1FBRUEsSUFBQyxDQUFBLE1BQUQsR0FBVTtRQUVWLElBQUMsQ0FBQSxJQUFJLENBQUMsU0FBTixHQUFrQixJQUFDLENBQUE7UUFDbkIsSUFBQyxDQUFBLElBQUksQ0FBQyxPQUFOLEdBQWtCLElBQUMsQ0FBQTtRQUVuQixJQUFDLENBQUEsSUFBSSxDQUFDLEtBQU4sQ0FBQTtJQVBEOzttQkFlSCxLQUFBLEdBQU8sU0FBQTtRQUVILElBQUMsQ0FBQSxLQUFELEdBQVMsS0FBSyxDQUFDLElBQU4sQ0FBVyxJQUFDLENBQUEsSUFBWjtRQUNULElBQUMsQ0FBQSxLQUFLLENBQUMsR0FBUCxHQUFhLEtBQUssQ0FBQyxHQUFOLENBQVUsS0FBVixFQUFnQixFQUFoQjtRQUNiLElBQUMsQ0FBQSxJQUFJLENBQUMsS0FBTixDQUFBO1FBQ0EsSUFBQyxDQUFBLE9BQUQsQ0FBQTtlQUNBLElBQUMsQ0FBQSxRQUFELEdBQVksV0FBQSxDQUFZLElBQUMsQ0FBQSxPQUFiLEVBQXNCLFFBQUEsQ0FBUyxJQUFBLEdBQUssTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUEzQixDQUF0QjtJQU5UOzttQkFjUCxPQUFBLEdBQVMsU0FBQTtRQUVMLElBQUcsQ0FBSSxJQUFDLENBQUEsTUFBUjttQkFDSSxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBQSxFQURKOztJQUZLOzttQkFXVCxTQUFBLEdBQVcsU0FBQyxLQUFEO0FBRVAsWUFBQTtRQUFBLE9BQW9CLE9BQU8sQ0FBQyxRQUFSLENBQWlCLEtBQWpCLENBQXBCLEVBQUMsY0FBRCxFQUFNLGNBQU4sRUFBVztRQUNYLElBQVUsQ0FBSSxLQUFkO0FBQUEsbUJBQUE7O1FBQ0EsSUFBVSxHQUFBLEtBQU8sYUFBakI7QUFBQSxtQkFBQTs7UUFDQSxJQUFHLEdBQUEsS0FBTyxHQUFWO1lBQ0ksSUFBQyxDQUFBLE1BQUQsR0FBVSxDQUFJLElBQUMsQ0FBQTtBQUNmLG1CQUZKOztlQUlBLElBQUMsQ0FBQSxLQUFLLENBQUMsb0JBQVAsQ0FBNEIsR0FBNUIsRUFBaUMsR0FBakMsRUFBc0MsS0FBdEMsRUFBNkMsS0FBN0M7SUFUTzs7bUJBV1gsT0FBQSxHQUFTLFNBQUMsS0FBRDtBQUVMLFlBQUE7UUFBQSxPQUFvQixPQUFPLENBQUMsUUFBUixDQUFpQixLQUFqQixDQUFwQixFQUFDLGNBQUQsRUFBTSxjQUFOLEVBQVc7UUFDWCxJQUFVLENBQUksS0FBZDtBQUFBLG1CQUFBOztRQUNBLElBQVUsR0FBQSxLQUFPLGFBQWpCO0FBQUEsbUJBQUE7O2VBQ0EsSUFBQyxDQUFBLEtBQUssQ0FBQyxrQkFBUCxDQUE0QixHQUE1QixFQUFpQyxHQUFqQyxFQUFzQyxLQUF0QyxFQUE2QyxLQUE3QztJQUxLOzttQkFPVCxPQUFBLEdBQVMsU0FBQTtlQUFHLElBQUMsQ0FBQSxLQUFLLENBQUMsT0FBUCxDQUFlLElBQUMsQ0FBQSxJQUFJLENBQUMsV0FBckIsRUFBa0MsSUFBQyxDQUFBLElBQUksQ0FBQyxZQUF4QztJQUFIOzs7Ozs7QUFFYixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIlxuIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiMgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwXG4jIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwICAgIDAwMFxuIyAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDBcbiMgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwXG5cbnsga2V5aW5mbywgcHJlZnMgfSA9IHJlcXVpcmUgJ2t4aydcblxuV29ybGQgPSByZXF1aXJlICcuL3dvcmxkJ1xuXG5jbGFzcyBLaWtpXG4gICAgXG4gICAgQDogKEB2aWV3KSAtPlxuICAgICAgICBcbiAgICAgICAgQHBhdXNlZCA9IGZhbHNlXG4gICAgICAgIFxuICAgICAgICBAdmlldy5vbmtleWRvd24gPSBAb25LZXlEb3duXG4gICAgICAgIEB2aWV3Lm9ua2V5dXAgICA9IEBvbktleVVwXG4gICAgICAgIFxuICAgICAgICBAdmlldy5mb2N1cygpXG4gICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDAwICAwMDAwMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIHN0YXJ0OiAtPiBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQHdvcmxkID0gV29ybGQuaW5pdCBAdmlld1xuICAgICAgICBAd29ybGQuZnBzID0gcHJlZnMuZ2V0ICdmcHMnIDYwXG4gICAgICAgIEB2aWV3LmZvY3VzKClcbiAgICAgICAgQGFuaW1hdGUoKVxuICAgICAgICBAaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCBAYW5pbWF0ZSwgcGFyc2VJbnQgMTAwMC9nbG9iYWwud29ybGQuZnBzXG5cbiAgICAjICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgIDAwICAgICAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBhbmltYXRlOiA9PlxuXG4gICAgICAgIGlmIG5vdCBAcGF1c2VkXG4gICAgICAgICAgICBAd29ybGQuc3RlcCgpXG5cbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwIDAwMCAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIG9uS2V5RG93bjogKGV2ZW50KSA9PlxuICAgICAgICBcbiAgICAgICAge21vZCwga2V5LCBjb21ib30gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgICAgIHJldHVybiBpZiBub3QgY29tYm9cbiAgICAgICAgcmV0dXJuIGlmIGtleSA9PSAncmlnaHQgY2xpY2snICMgd2VpcmQgcmlnaHQgY29tbWFuZCBrZXlcbiAgICAgICAgaWYga2V5ID09ICdwJyBcbiAgICAgICAgICAgIEBwYXVzZWQgPSBub3QgQHBhdXNlZFxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICBcbiAgICAgICAgQHdvcmxkLm1vZEtleUNvbWJvRXZlbnREb3duIG1vZCwga2V5LCBjb21ibywgZXZlbnRcbiAgIFxuICAgIG9uS2V5VXA6IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHttb2QsIGtleSwgY29tYm99ID0ga2V5aW5mby5mb3JFdmVudCBldmVudCAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBub3QgY29tYm9cbiAgICAgICAgcmV0dXJuIGlmIGtleSA9PSAncmlnaHQgY2xpY2snICMgd2VpcmQgcmlnaHQgY29tbWFuZCBrZXlcbiAgICAgICAgQHdvcmxkLm1vZEtleUNvbWJvRXZlbnRVcCAgIG1vZCwga2V5LCBjb21ibywgZXZlbnRcbiAgICBcbiAgICByZXNpemVkOiA9PiBAd29ybGQucmVzaXplZCBAdmlldy5jbGllbnRXaWR0aCwgQHZpZXcuY2xpZW50SGVpZ2h0XG4gICAgXG5tb2R1bGUuZXhwb3J0cyA9IEtpa2lcbiJdfQ==
//# sourceURL=../coffee/kiki.coffee