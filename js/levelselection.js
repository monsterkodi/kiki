// koffee 1.4.0

/*
000      00000000  000   000  00000000  000       0000000  00000000  000      
000      000       000   000  000       000      000       000       000      
000      0000000    000 000   0000000   000      0000000   0000000   000      
000      000          000     000       000           000  000       000      
0000000  00000000      0      00000000  0000000  0000000   00000000  0000000
 */
var LevelSelName, LevelSelection, clamp, elem, prefs, ref,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), prefs = ref.prefs, clamp = ref.clamp, elem = ref.elem;

LevelSelName = require('./levelselname');

LevelSelection = (function() {
    function LevelSelection(gameWorld) {
        var World, ref1, view;
        this.gameWorld = gameWorld;
        this.resized = bind(this.resized, this);
        this.modKeyComboEvent = bind(this.modKeyComboEvent, this);
        World = require('./world');
        this.levels = World.levels.list;
        this.index = (((ref1 = this.gameWorld.level_index) != null ? ref1 : 0) + 1) % this.levels.length;
        this.gameWorld.menu.del();
        view = elem({
            "class": 'preview'
        });
        view.style.position = 'absolute';
        view.style.left = '0';
        view.style.right = '0';
        view.style.top = '0';
        view.style.bottom = '0';
        this.gameWorld.view.appendChild(view);
        this.world = new World(view, true);
        this.world.create(this.levels[this.index]);
        this.addName();
        this.resized(this.gameWorld.screenSize.w, this.gameWorld.screenSize.h);
    }

    LevelSelection.prototype.addName = function() {
        this.world.text = new LevelSelName(this.levels[this.index]);
        this.world.text.addText("");
        return this.world.text.addText("" + (prefs.get("solvedâ–¸" + this.levels[this.index], false) && 'solved' || this.index + 1), 0.8);
    };

    LevelSelection.prototype.navigate = function(action) {
        var oldIndex;
        oldIndex = this.index;
        switch (action) {
            case 'right':
            case 'down':
                this.index += 1;
                break;
            case 'left':
            case 'up':
                this.index -= 1;
                break;
            case 'page up':
                this.index -= 10;
                break;
            case 'page down':
                this.index += 10;
                break;
            case 'home':
                this.index = 0;
                break;
            case 'end':
                this.index = this.levels.length - 1;
        }
        this.index = clamp(0, this.levels.length - 1, this.index);
        if (oldIndex !== this.index) {
            this.world.playSound('MENU_ITEM');
            this.world.create(this.levels[this.index]);
            this.addName();
            return this.resized(this.gameWorld.screenSize.w, this.gameWorld.screenSize.h);
        }
    };

    LevelSelection.prototype.del = function() {
        delete this.gameWorld.levelSelection;
        return this.world.del();
    };

    LevelSelection.prototype.load = function() {
        this.world.playSound('MENU_SELECT');
        global.world = this.gameWorld;
        this.gameWorld.create(this.levels[this.index], false);
        return this.del();
    };

    LevelSelection.prototype.close = function() {
        var ref1;
        this.world.playSound('MENU_ABORT');
        global.world = this.gameWorld;
        this.del();
        return this.gameWorld.applyScheme((ref1 = this.gameWorld.dict.scheme) != null ? ref1 : 'default');
    };

    LevelSelection.prototype.modKeyComboEvent = function(mod, key, combo, event) {
        switch (combo) {
            case 'esc':
                return this.close();
            case 'enter':
            case 'space':
                return this.load();
            case 'left':
            case 'right':
            case 'up':
            case 'down':
            case 'page up':
            case 'page down':
            case 'home':
            case 'end':
                return this.navigate(combo);
        }
    };

    LevelSelection.prototype.resized = function(w, h) {
        return this.world.resized(w, h);
    };

    LevelSelection.prototype.step = function() {
        return this.world.step();
    };

    return LevelSelection;

})();

module.exports = LevelSelection;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGV2ZWxzZWxlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLHFEQUFBO0lBQUE7O0FBUUEsTUFBeUIsT0FBQSxDQUFRLEtBQVIsQ0FBekIsRUFBRSxpQkFBRixFQUFTLGlCQUFULEVBQWdCOztBQUVoQixZQUFBLEdBQWUsT0FBQSxDQUFRLGdCQUFSOztBQUVUO0lBRUMsd0JBQUMsU0FBRDtBQUVDLFlBQUE7UUFGQSxJQUFDLENBQUEsWUFBRDs7O1FBRUEsS0FBQSxHQUFRLE9BQUEsQ0FBUSxTQUFSO1FBRVIsSUFBQyxDQUFBLE1BQUQsR0FBVSxLQUFLLENBQUMsTUFBTSxDQUFDO1FBRXZCLElBQUMsQ0FBQSxLQUFELEdBQVMsQ0FBQyxzREFBMEIsQ0FBMUIsQ0FBQSxHQUErQixDQUFoQyxDQUFBLEdBQXFDLElBQUMsQ0FBQSxNQUFNLENBQUM7UUFFdEQsSUFBQyxDQUFBLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBaEIsQ0FBQTtRQUVBLElBQUEsR0FBTyxJQUFBLENBQUs7WUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFNLFNBQU47U0FBTDtRQUNQLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBWCxHQUFzQjtRQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQVgsR0FBc0I7UUFDdEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFYLEdBQXNCO1FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBWCxHQUFzQjtRQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQVgsR0FBc0I7UUFDdEIsSUFBQyxDQUFBLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBaEIsQ0FBNEIsSUFBNUI7UUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTLElBQUksS0FBSixDQUFVLElBQVYsRUFBZ0IsSUFBaEI7UUFDVCxJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVAsQ0FBYyxJQUFDLENBQUEsTUFBTyxDQUFBLElBQUMsQ0FBQSxLQUFELENBQXRCO1FBQ0EsSUFBQyxDQUFBLE9BQUQsQ0FBQTtRQUNBLElBQUMsQ0FBQSxPQUFELENBQVMsSUFBQyxDQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBL0IsRUFBa0MsSUFBQyxDQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBeEQ7SUFwQkQ7OzZCQXNCSCxPQUFBLEdBQVMsU0FBQTtRQUVMLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxHQUFjLElBQUksWUFBSixDQUFpQixJQUFDLENBQUEsTUFBTyxDQUFBLElBQUMsQ0FBQSxLQUFELENBQXpCO1FBQ2QsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBWixDQUFvQixFQUFwQjtlQUNBLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQVosQ0FBb0IsRUFBQSxHQUFFLENBQUMsS0FBSyxDQUFDLEdBQU4sQ0FBVSxTQUFBLEdBQVUsSUFBQyxDQUFBLE1BQU8sQ0FBQSxJQUFDLENBQUEsS0FBRCxDQUE1QixFQUFzQyxLQUF0QyxDQUFBLElBQWlELFFBQWpELElBQTZELElBQUMsQ0FBQSxLQUFELEdBQU8sQ0FBckUsQ0FBdEIsRUFBK0YsR0FBL0Y7SUFKSzs7NkJBTVQsUUFBQSxHQUFVLFNBQUMsTUFBRDtBQUVOLFlBQUE7UUFBQSxRQUFBLEdBQVcsSUFBQyxDQUFBO0FBRVosZ0JBQU8sTUFBUDtBQUFBLGlCQUNTLE9BRFQ7QUFBQSxpQkFDaUIsTUFEakI7Z0JBQzZCLElBQUMsQ0FBQSxLQUFELElBQVU7QUFBdEI7QUFEakIsaUJBRVMsTUFGVDtBQUFBLGlCQUVnQixJQUZoQjtnQkFFNkIsSUFBQyxDQUFBLEtBQUQsSUFBVTtBQUF2QjtBQUZoQixpQkFHUyxTQUhUO2dCQUc2QixJQUFDLENBQUEsS0FBRCxJQUFVO0FBQTlCO0FBSFQsaUJBSVMsV0FKVDtnQkFJNkIsSUFBQyxDQUFBLEtBQUQsSUFBVTtBQUE5QjtBQUpULGlCQUtTLE1BTFQ7Z0JBSzZCLElBQUMsQ0FBQSxLQUFELEdBQVM7QUFBN0I7QUFMVCxpQkFNUyxLQU5UO2dCQU02QixJQUFDLENBQUEsS0FBRCxHQUFTLElBQUMsQ0FBQSxNQUFNLENBQUMsTUFBUixHQUFlO0FBTnJEO1FBUUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxLQUFBLENBQU0sQ0FBTixFQUFTLElBQUMsQ0FBQSxNQUFNLENBQUMsTUFBUixHQUFlLENBQXhCLEVBQTJCLElBQUMsQ0FBQSxLQUE1QjtRQUVULElBQUcsUUFBQSxLQUFZLElBQUMsQ0FBQSxLQUFoQjtZQUNJLElBQUMsQ0FBQSxLQUFLLENBQUMsU0FBUCxDQUFpQixXQUFqQjtZQUNBLElBQUMsQ0FBQSxLQUFLLENBQUMsTUFBUCxDQUFjLElBQUMsQ0FBQSxNQUFPLENBQUEsSUFBQyxDQUFBLEtBQUQsQ0FBdEI7WUFDQSxJQUFDLENBQUEsT0FBRCxDQUFBO21CQUNBLElBQUMsQ0FBQSxPQUFELENBQVMsSUFBQyxDQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBL0IsRUFBa0MsSUFBQyxDQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBeEQsRUFKSjs7SUFkTTs7NkJBb0JWLEdBQUEsR0FBSyxTQUFBO1FBRUQsT0FBTyxJQUFDLENBQUEsU0FBUyxDQUFDO2VBQ2xCLElBQUMsQ0FBQSxLQUFLLENBQUMsR0FBUCxDQUFBO0lBSEM7OzZCQUtMLElBQUEsR0FBTSxTQUFBO1FBRUYsSUFBQyxDQUFBLEtBQUssQ0FBQyxTQUFQLENBQWlCLGFBQWpCO1FBQ0EsTUFBTSxDQUFDLEtBQVAsR0FBZSxJQUFDLENBQUE7UUFDaEIsSUFBQyxDQUFBLFNBQVMsQ0FBQyxNQUFYLENBQWtCLElBQUMsQ0FBQSxNQUFPLENBQUEsSUFBQyxDQUFBLEtBQUQsQ0FBMUIsRUFBbUMsS0FBbkM7ZUFDQSxJQUFDLENBQUEsR0FBRCxDQUFBO0lBTEU7OzZCQU9OLEtBQUEsR0FBTyxTQUFBO0FBRUgsWUFBQTtRQUFBLElBQUMsQ0FBQSxLQUFLLENBQUMsU0FBUCxDQUFpQixZQUFqQjtRQUNBLE1BQU0sQ0FBQyxLQUFQLEdBQWUsSUFBQyxDQUFBO1FBQ2hCLElBQUMsQ0FBQSxHQUFELENBQUE7ZUFDQSxJQUFDLENBQUEsU0FBUyxDQUFDLFdBQVgsc0RBQWdELFNBQWhEO0lBTEc7OzZCQU9QLGdCQUFBLEdBQWtCLFNBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxLQUFYLEVBQWtCLEtBQWxCO0FBRWQsZ0JBQU8sS0FBUDtBQUFBLGlCQUNTLEtBRFQ7dUJBQzhCLElBQUMsQ0FBQSxLQUFELENBQUE7QUFEOUIsaUJBRVMsT0FGVDtBQUFBLGlCQUVpQixPQUZqQjt1QkFFOEIsSUFBQyxDQUFBLElBQUQsQ0FBQTtBQUY5QixpQkFHUyxNQUhUO0FBQUEsaUJBR2dCLE9BSGhCO0FBQUEsaUJBR3dCLElBSHhCO0FBQUEsaUJBRzZCLE1BSDdCO0FBQUEsaUJBR29DLFNBSHBDO0FBQUEsaUJBRzhDLFdBSDlDO0FBQUEsaUJBRzBELE1BSDFEO0FBQUEsaUJBR2lFLEtBSGpFO3VCQUc0RSxJQUFDLENBQUEsUUFBRCxDQUFVLEtBQVY7QUFINUU7SUFGYzs7NkJBT2xCLE9BQUEsR0FBUyxTQUFDLENBQUQsRUFBSSxDQUFKO2VBQVUsSUFBQyxDQUFBLEtBQUssQ0FBQyxPQUFQLENBQWUsQ0FBZixFQUFrQixDQUFsQjtJQUFWOzs2QkFFVCxJQUFBLEdBQU0sU0FBQTtlQUVGLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFBO0lBRkU7Ozs7OztBQUlWLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAgICBcbjAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgIFxuMDAwICAgICAgMDAwMDAwMCAgICAwMDAgMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgICAgXG4wMDAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgICAgICAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICBcbjAwMDAwMDAgIDAwMDAwMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuIyMjXG5cbnsgcHJlZnMsIGNsYW1wLCBlbGVtIH0gPSByZXF1aXJlICdreGsnXG5cbkxldmVsU2VsTmFtZSA9IHJlcXVpcmUgJy4vbGV2ZWxzZWxuYW1lJ1xuXG5jbGFzcyBMZXZlbFNlbGVjdGlvblxuICAgIFxuICAgIEA6IChAZ2FtZVdvcmxkKSAtPlxuICAgICAgICBcbiAgICAgICAgV29ybGQgPSByZXF1aXJlICcuL3dvcmxkJ1xuICAgICAgICBcbiAgICAgICAgQGxldmVscyA9IFdvcmxkLmxldmVscy5saXN0XG4gICAgICAgIFxuICAgICAgICBAaW5kZXggPSAoKEBnYW1lV29ybGQubGV2ZWxfaW5kZXggPyAwKSArIDEpICUgQGxldmVscy5sZW5ndGhcbiAgICAgICAgXG4gICAgICAgIEBnYW1lV29ybGQubWVudS5kZWwoKVxuXG4gICAgICAgIHZpZXcgPSBlbGVtIGNsYXNzOidwcmV2aWV3J1xuICAgICAgICB2aWV3LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJ1xuICAgICAgICB2aWV3LnN0eWxlLmxlZnQgICAgID0gJzAnXG4gICAgICAgIHZpZXcuc3R5bGUucmlnaHQgICAgPSAnMCdcbiAgICAgICAgdmlldy5zdHlsZS50b3AgICAgICA9ICcwJ1xuICAgICAgICB2aWV3LnN0eWxlLmJvdHRvbSAgID0gJzAnXG4gICAgICAgIEBnYW1lV29ybGQudmlldy5hcHBlbmRDaGlsZCB2aWV3XG4gICAgICAgIEB3b3JsZCA9IG5ldyBXb3JsZCB2aWV3LCB0cnVlXG4gICAgICAgIEB3b3JsZC5jcmVhdGUgQGxldmVsc1tAaW5kZXhdXG4gICAgICAgIEBhZGROYW1lKClcbiAgICAgICAgQHJlc2l6ZWQgQGdhbWVXb3JsZC5zY3JlZW5TaXplLncsIEBnYW1lV29ybGQuc2NyZWVuU2l6ZS5oXG5cbiAgICBhZGROYW1lOiAtPiBcbiAgICAgICAgXG4gICAgICAgIEB3b3JsZC50ZXh0ID0gbmV3IExldmVsU2VsTmFtZSBAbGV2ZWxzW0BpbmRleF1cbiAgICAgICAgQHdvcmxkLnRleHQuYWRkVGV4dCBcIlwiXG4gICAgICAgIEB3b3JsZC50ZXh0LmFkZFRleHQgXCIje3ByZWZzLmdldChcInNvbHZlZOKWuCN7QGxldmVsc1tAaW5kZXhdfVwiIGZhbHNlKSBhbmQgJ3NvbHZlZCcgb3IgQGluZGV4KzF9XCIgMC44XG4gICAgICAgIFxuICAgIG5hdmlnYXRlOiAoYWN0aW9uKSAtPlxuICAgICAgICBcbiAgICAgICAgb2xkSW5kZXggPSBAaW5kZXhcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBhY3Rpb25cbiAgICAgICAgICAgIHdoZW4gJ3JpZ2h0JyAnZG93bicgdGhlbiBAaW5kZXggKz0gMVxuICAgICAgICAgICAgd2hlbiAnbGVmdCcgJ3VwJyAgICB0aGVuIEBpbmRleCAtPSAxXG4gICAgICAgICAgICB3aGVuICdwYWdlIHVwJyAgICAgIHRoZW4gQGluZGV4IC09IDEwXG4gICAgICAgICAgICB3aGVuICdwYWdlIGRvd24nICAgIHRoZW4gQGluZGV4ICs9IDEwXG4gICAgICAgICAgICB3aGVuICdob21lJyAgICAgICAgIHRoZW4gQGluZGV4ID0gMFxuICAgICAgICAgICAgd2hlbiAnZW5kJyAgICAgICAgICB0aGVuIEBpbmRleCA9IEBsZXZlbHMubGVuZ3RoLTFcbiAgICAgICAgXG4gICAgICAgIEBpbmRleCA9IGNsYW1wIDAsIEBsZXZlbHMubGVuZ3RoLTEsIEBpbmRleFxuICAgICAgICAjIGtsb2cgQGluZGV4LCBAbGV2ZWxzW0BpbmRleF1cbiAgICAgICAgaWYgb2xkSW5kZXggIT0gQGluZGV4XG4gICAgICAgICAgICBAd29ybGQucGxheVNvdW5kICdNRU5VX0lURU0nXG4gICAgICAgICAgICBAd29ybGQuY3JlYXRlIEBsZXZlbHNbQGluZGV4XVxuICAgICAgICAgICAgQGFkZE5hbWUoKVxuICAgICAgICAgICAgQHJlc2l6ZWQgQGdhbWVXb3JsZC5zY3JlZW5TaXplLncsIEBnYW1lV29ybGQuc2NyZWVuU2l6ZS5oXG4gICAgICAgIFxuICAgIGRlbDogLT5cbiAgICAgICAgXG4gICAgICAgIGRlbGV0ZSBAZ2FtZVdvcmxkLmxldmVsU2VsZWN0aW9uXG4gICAgICAgIEB3b3JsZC5kZWwoKVxuICAgICAgICBcbiAgICBsb2FkOiAtPlxuICAgICAgICAgICAgICBcbiAgICAgICAgQHdvcmxkLnBsYXlTb3VuZCAnTUVOVV9TRUxFQ1QnXG4gICAgICAgIGdsb2JhbC53b3JsZCA9IEBnYW1lV29ybGRcbiAgICAgICAgQGdhbWVXb3JsZC5jcmVhdGUgQGxldmVsc1tAaW5kZXhdLCBmYWxzZVxuICAgICAgICBAZGVsKClcbiAgICAgICAgXG4gICAgY2xvc2U6IC0+IFxuICAgICAgICBcbiAgICAgICAgQHdvcmxkLnBsYXlTb3VuZCAnTUVOVV9BQk9SVCdcbiAgICAgICAgZ2xvYmFsLndvcmxkID0gQGdhbWVXb3JsZFxuICAgICAgICBAZGVsKClcbiAgICAgICAgQGdhbWVXb3JsZC5hcHBseVNjaGVtZSBAZ2FtZVdvcmxkLmRpY3Quc2NoZW1lID8gJ2RlZmF1bHQnXG4gICAgICAgIFxuICAgIG1vZEtleUNvbWJvRXZlbnQ6IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSA9PlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIGNvbWJvXG4gICAgICAgICAgICB3aGVuICdlc2MnICAgICAgICAgICB0aGVuIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdlbnRlcicgJ3NwYWNlJyB0aGVuIEBsb2FkKClcbiAgICAgICAgICAgIHdoZW4gJ2xlZnQnICdyaWdodCcgJ3VwJyAnZG93bicgJ3BhZ2UgdXAnICdwYWdlIGRvd24nICdob21lJyAnZW5kJyB0aGVuIEBuYXZpZ2F0ZSBjb21ib1xuICAgICAgICBcbiAgICByZXNpemVkOiAodywgaCkgPT4gQHdvcmxkLnJlc2l6ZWQgdywgaFxuICAgICAgICBcbiAgICBzdGVwOiAtPiBcbiAgICBcbiAgICAgICAgQHdvcmxkLnN0ZXAoKVxuICAgIFxubW9kdWxlLmV4cG9ydHMgPSBMZXZlbFNlbGVjdGlvblxuIl19
//# sourceURL=../coffee/levelselection.coffee