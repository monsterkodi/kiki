// koffee 1.4.0
var Action, Face, Gear, Geom, Material, MotorCylinder, MotorGear, Quaternion,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

Gear = require('./gear');

Geom = require('./geom');

Face = require('./face');

Action = require('./action');

Material = require('./material');

Quaternion = require('./lib/quaternion');

MotorCylinder = require('./motorcylinder');

MotorGear = (function(superClass) {
    extend(MotorGear, superClass);

    function MotorGear(face) {
        this.face = face;
        MotorGear.__super__.constructor.call(this, this.face);
    }

    MotorGear.prototype.setPosition = function(pos) {
        MotorGear.__super__.setPosition.call(this, pos);
        return this.updateActive();
    };

    MotorGear.prototype.createMesh = function() {
        this.mesh = new THREE.Mesh(Geom.motor(), Material.plate);
        this.gear = new THREE.Mesh(Geom.gear(), Material.gear);
        this.gear.receiveShadow = true;
        this.gear.castShadow = true;
        this.mesh.add(this.gear);
        this.mesh.receiveShadow = true;
        return this.mesh.castShadow = true;
    };

    MotorGear.prototype.initAction = function(action) {
        var isCylinder, occupant, pos, ref;
        if ((ref = action.id) === Action.PUSH || ref === Action.FALL) {
            pos = this.position.plus(Face.normal(this.face));
            occupant = world.getOccupantAtPos(pos);
            isCylinder = occupant instanceof MotorCylinder && occupant.face === this.face;
            if (isCylinder) {
                occupant.setActive(false);
            }
        }
        return MotorGear.__super__.initAction.call(this, action);
    };

    MotorGear.prototype.updateMesh = function() {
        var rot;
        rot = Quaternion.rotationAroundVector((this.clockwise && 1 || -1) * this.angle, 0, 0, 1);
        this.gear.quaternion.copy(rot);
        return this.mesh.quaternion.copy(Face.orientation(this.face));
    };

    MotorGear.prototype.updateActive = function() {
        var isCylinder, occupant, pos;
        pos = this.position.plus(Face.normal(this.face));
        occupant = world.getOccupantAtPos(pos);
        isCylinder = occupant instanceof MotorCylinder && occupant.face === this.face && !occupant.move_action;
        this.setActive(isCylinder);
        if (isCylinder) {
            return occupant.setActive(true);
        }
    };

    return MotorGear;

})(Gear);

module.exports = MotorGear;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW90b3JnZWFyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQSx3RUFBQTtJQUFBOzs7QUFBQSxJQUFBLEdBQWdCLE9BQUEsQ0FBUSxRQUFSOztBQUNoQixJQUFBLEdBQWdCLE9BQUEsQ0FBUSxRQUFSOztBQUNoQixJQUFBLEdBQWdCLE9BQUEsQ0FBUSxRQUFSOztBQUNoQixNQUFBLEdBQWdCLE9BQUEsQ0FBUSxVQUFSOztBQUNoQixRQUFBLEdBQWdCLE9BQUEsQ0FBUSxZQUFSOztBQUNoQixVQUFBLEdBQWdCLE9BQUEsQ0FBUSxrQkFBUjs7QUFDaEIsYUFBQSxHQUFnQixPQUFBLENBQVEsaUJBQVI7O0FBRVY7OztJQUVXLG1CQUFDLElBQUQ7UUFBQyxJQUFDLENBQUEsT0FBRDtRQUNWLDJDQUFNLElBQUMsQ0FBQSxJQUFQO0lBRFM7O3dCQUdiLFdBQUEsR0FBYSxTQUFDLEdBQUQ7UUFDVCwyQ0FBTSxHQUFOO2VBQ0EsSUFBQyxDQUFBLFlBQUQsQ0FBQTtJQUZTOzt3QkFJYixVQUFBLEdBQVksU0FBQTtRQUNSLElBQUMsQ0FBQSxJQUFELEdBQVEsSUFBSSxLQUFLLENBQUMsSUFBVixDQUFlLElBQUksQ0FBQyxLQUFMLENBQUEsQ0FBZixFQUE2QixRQUFRLENBQUMsS0FBdEM7UUFDUixJQUFDLENBQUEsSUFBRCxHQUFRLElBQUksS0FBSyxDQUFDLElBQVYsQ0FBZSxJQUFJLENBQUMsSUFBTCxDQUFBLENBQWYsRUFBNkIsUUFBUSxDQUFDLElBQXRDO1FBQ1IsSUFBQyxDQUFBLElBQUksQ0FBQyxhQUFOLEdBQXNCO1FBQ3RCLElBQUMsQ0FBQSxJQUFJLENBQUMsVUFBTixHQUFtQjtRQUNuQixJQUFDLENBQUEsSUFBSSxDQUFDLEdBQU4sQ0FBVSxJQUFDLENBQUEsSUFBWDtRQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsYUFBTixHQUFzQjtlQUN0QixJQUFDLENBQUEsSUFBSSxDQUFDLFVBQU4sR0FBbUI7SUFQWDs7d0JBU1osVUFBQSxHQUFZLFNBQUMsTUFBRDtBQUVSLFlBQUE7UUFBQSxXQUFHLE1BQU0sQ0FBQyxHQUFQLEtBQWMsTUFBTSxDQUFDLElBQXJCLElBQUEsR0FBQSxLQUEyQixNQUFNLENBQUMsSUFBckM7WUFDSSxHQUFBLEdBQU0sSUFBQyxDQUFBLFFBQVEsQ0FBQyxJQUFWLENBQWUsSUFBSSxDQUFDLE1BQUwsQ0FBWSxJQUFDLENBQUEsSUFBYixDQUFmO1lBQ04sUUFBQSxHQUFXLEtBQUssQ0FBQyxnQkFBTixDQUF1QixHQUF2QjtZQUNYLFVBQUEsR0FBYSxRQUFBLFlBQW9CLGFBQXBCLElBQXNDLFFBQVEsQ0FBQyxJQUFULEtBQWlCLElBQUMsQ0FBQTtZQUNyRSxJQUE0QixVQUE1QjtnQkFBQSxRQUFRLENBQUMsU0FBVCxDQUFtQixLQUFuQixFQUFBO2FBSko7O2VBS0EsMENBQU0sTUFBTjtJQVBROzt3QkFTWixVQUFBLEdBQVksU0FBQTtBQUVSLFlBQUE7UUFBQSxHQUFBLEdBQU0sVUFBVSxDQUFDLG9CQUFYLENBQWdDLENBQUMsSUFBQyxDQUFBLFNBQUQsSUFBZSxDQUFmLElBQW9CLENBQUMsQ0FBdEIsQ0FBQSxHQUEyQixJQUFDLENBQUEsS0FBNUQsRUFBbUUsQ0FBbkUsRUFBcUUsQ0FBckUsRUFBdUUsQ0FBdkU7UUFDTixJQUFDLENBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFqQixDQUFzQixHQUF0QjtlQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQWpCLENBQXNCLElBQUksQ0FBQyxXQUFMLENBQWlCLElBQUMsQ0FBQSxJQUFsQixDQUF0QjtJQUpROzt3QkFNWixZQUFBLEdBQWMsU0FBQTtBQUNWLFlBQUE7UUFBQSxHQUFBLEdBQU0sSUFBQyxDQUFBLFFBQVEsQ0FBQyxJQUFWLENBQWUsSUFBSSxDQUFDLE1BQUwsQ0FBWSxJQUFDLENBQUEsSUFBYixDQUFmO1FBRU4sUUFBQSxHQUFXLEtBQUssQ0FBQyxnQkFBTixDQUF1QixHQUF2QjtRQUNYLFVBQUEsR0FBYSxRQUFBLFlBQW9CLGFBQXBCLElBQXNDLFFBQVEsQ0FBQyxJQUFULEtBQWlCLElBQUMsQ0FBQSxJQUF4RCxJQUFpRSxDQUFJLFFBQVEsQ0FBQztRQUMzRixJQUFDLENBQUEsU0FBRCxDQUFXLFVBQVg7UUFDQSxJQUEyQixVQUEzQjttQkFBQSxRQUFRLENBQUMsU0FBVCxDQUFtQixJQUFuQixFQUFBOztJQU5VOzs7O0dBakNNOztBQXlDeEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIDAwICAgICAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwIFxuIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiMgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMCAgMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgXG4jIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuIyAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcblxuR2VhciAgICAgICAgICA9IHJlcXVpcmUgJy4vZ2Vhcidcbkdlb20gICAgICAgICAgPSByZXF1aXJlICcuL2dlb20nXG5GYWNlICAgICAgICAgID0gcmVxdWlyZSAnLi9mYWNlJ1xuQWN0aW9uICAgICAgICA9IHJlcXVpcmUgJy4vYWN0aW9uJ1xuTWF0ZXJpYWwgICAgICA9IHJlcXVpcmUgJy4vbWF0ZXJpYWwnXG5RdWF0ZXJuaW9uICAgID0gcmVxdWlyZSAnLi9saWIvcXVhdGVybmlvbidcbk1vdG9yQ3lsaW5kZXIgPSByZXF1aXJlICcuL21vdG9yY3lsaW5kZXInXG5cbmNsYXNzIE1vdG9yR2VhciBleHRlbmRzIEdlYXJcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKEBmYWNlKSAtPiBcbiAgICAgICAgc3VwZXIgQGZhY2VcbiAgICAgICAgXG4gICAgc2V0UG9zaXRpb246IChwb3MpIC0+XG4gICAgICAgIHN1cGVyIHBvc1xuICAgICAgICBAdXBkYXRlQWN0aXZlKClcblxuICAgIGNyZWF0ZU1lc2g6IC0+XG4gICAgICAgIEBtZXNoID0gbmV3IFRIUkVFLk1lc2ggR2VvbS5tb3RvcigpLCBNYXRlcmlhbC5wbGF0ZVxuICAgICAgICBAZ2VhciA9IG5ldyBUSFJFRS5NZXNoIEdlb20uZ2VhcigpLCAgTWF0ZXJpYWwuZ2VhclxuICAgICAgICBAZ2Vhci5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgICAgICBAZ2Vhci5jYXN0U2hhZG93ID0gdHJ1ZVxuICAgICAgICBAbWVzaC5hZGQgQGdlYXJcbiAgICAgICAgQG1lc2gucmVjZWl2ZVNoYWRvdyA9IHRydWVcbiAgICAgICAgQG1lc2guY2FzdFNoYWRvdyA9IHRydWVcblxuICAgIGluaXRBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgICAgICMgbG9nIFwiTW90b3JHZWFyLmluaXRBY3Rpb24gYWN0aW9uICN7YWN0aW9uLm5hbWV9XCJcbiAgICAgICAgaWYgYWN0aW9uLmlkIGluIFtBY3Rpb24uUFVTSCwgQWN0aW9uLkZBTExdXG4gICAgICAgICAgICBwb3MgPSBAcG9zaXRpb24ucGx1cyBGYWNlLm5vcm1hbCBAZmFjZVxuICAgICAgICAgICAgb2NjdXBhbnQgPSB3b3JsZC5nZXRPY2N1cGFudEF0UG9zIHBvcyBcbiAgICAgICAgICAgIGlzQ3lsaW5kZXIgPSBvY2N1cGFudCBpbnN0YW5jZW9mIE1vdG9yQ3lsaW5kZXIgYW5kIG9jY3VwYW50LmZhY2UgPT0gQGZhY2VcbiAgICAgICAgICAgIG9jY3VwYW50LnNldEFjdGl2ZSBmYWxzZSBpZiBpc0N5bGluZGVyXG4gICAgICAgIHN1cGVyIGFjdGlvblxuICAgICAgICBcbiAgICB1cGRhdGVNZXNoOiAtPlxuICAgICAgICAjIGxvZyBcIlZhbHZlLnVwZGF0ZU1lc2ggI3tAYW5nbGV9ICN7QGZhY2V9XCJcbiAgICAgICAgcm90ID0gUXVhdGVybmlvbi5yb3RhdGlvbkFyb3VuZFZlY3RvciAoQGNsb2Nrd2lzZSBhbmQgMSBvciAtMSkgKiBAYW5nbGUsIDAsMCwxXG4gICAgICAgIEBnZWFyLnF1YXRlcm5pb24uY29weSByb3QgI0ZhY2Uub3JpZW50YXRpb25Gb3JGYWNlKEBmYWNlKS5tdWwgcm90XG4gICAgICAgIEBtZXNoLnF1YXRlcm5pb24uY29weSBGYWNlLm9yaWVudGF0aW9uIEBmYWNlXG4gICAgICAgIFxuICAgIHVwZGF0ZUFjdGl2ZTogLT5cbiAgICAgICAgcG9zID0gQHBvc2l0aW9uLnBsdXMgRmFjZS5ub3JtYWwgQGZhY2VcbiAgICAgICAgIyBsb2cgXCJNb3RvckdlYXIudXBkYXRlQWN0aXZlICN7QGFjdGl2ZX1cIiwgcG9zLCB3b3JsZC5nZXRPY2N1cGFudEF0UG9zKHBvcykgaW5zdGFuY2VvZiBNb3RvckN5bGluZGVyXG4gICAgICAgIG9jY3VwYW50ID0gd29ybGQuZ2V0T2NjdXBhbnRBdFBvcyBwb3MgXG4gICAgICAgIGlzQ3lsaW5kZXIgPSBvY2N1cGFudCBpbnN0YW5jZW9mIE1vdG9yQ3lsaW5kZXIgYW5kIG9jY3VwYW50LmZhY2UgPT0gQGZhY2UgYW5kIG5vdCBvY2N1cGFudC5tb3ZlX2FjdGlvblxuICAgICAgICBAc2V0QWN0aXZlIGlzQ3lsaW5kZXJcbiAgICAgICAgb2NjdXBhbnQuc2V0QWN0aXZlIHRydWUgaWYgaXNDeWxpbmRlclxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gTW90b3JHZWFyXG4iXX0=
//# sourceURL=../coffee/motorgear.coffee