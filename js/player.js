// koffee 1.4.0
var Action, Bot, Camera, Player, Timer, prefs, ref, valid,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), valid = ref.valid, prefs = ref.prefs;

Bot = require('./bot');

Action = require('./action');

Timer = require('./timer');

Camera = require('./camera');

Player = (function(superClass) {
    extend(Player, superClass);

    function Player() {
        var pkey;
        Player.__super__.constructor.apply(this, arguments);
        this.name = 'player';
        if (valid(pkey = prefs.get('keys', {}))) {
            this.key = pkey;
        } else {
            this.key = {
                forward: 'w',
                backward: 's',
                left: 'a',
                right: 'd',
                lookUp: 'e',
                lookDown: 'q',
                shoot: 'enter',
                jump: 'space',
                view: 'c',
                push: 'shift'
            };
            prefs.set('keys', this.key);
        }
        this.camera = new Camera(this, {
            aspect: world.view.offsetWidth / world.view.offsetHeight
        });
        this.look_action = null;
        this.look_angle = 0.0;
        this.new_dir_sgn = 1.0;
        this.rotate = 0;
        this.recorder = null;
        this.playback = null;
        this.addAction(new Action(this, Action.LOOK_UP, 'look up', 220));
        this.addAction(new Action(this, Action.LOOK_DOWN, 'look down', 220));
        this.addAction(new Action(this, Action.LOOK_RESET, 'look reset', 60));
        this.addEventWithName("landed");
    }

    Player.prototype.bulletHitSound = function() {
        return 'BULLET_HIT_PLAYER';
    };

    Player.prototype.initAction = function(action) {
        switch (action.id) {
            case Action.CLIMB_DOWN:
                world.playSound('BOT_CLIMB');
                break;
            case Action.FORWARD:
                world.playSound('BOT_MOVE');
                break;
            case Action.TURN_LEFT:
            case Action.TURN_RIGHT:
                world.playSound('BOT_TURN');
                break;
            case Action.JUMP:
                world.playSound('BOT_JUMP');
        }
        return Player.__super__.initAction.call(this, action);
    };

    Player.prototype.performAction = function(action) {
        var correct, relTime;
        relTime = action.getRelativeTime();
        switch (action.id) {
            case Action.NOOP:
                break;
            case Action.LOOK_UP:
                return this.look_angle = relTime * 90.0;
            case Action.LOOK_DOWN:
                return this.look_angle = relTime * -90.0;
            case Action.LOOK_RESET:
                if (this.look_angle > 0) {
                    return this.look_angle = Math.min(this.look_angle, (1.0 - relTime) * 90.0);
                } else {
                    return this.look_angle = Math.max(this.look_angle, (1.0 - relTime) * -90.0);
                }
                break;
            default:
                Player.__super__.performAction.call(this, action);
                if (this.takenOffset) {
                    correct = this.takenOrig.mul(action.getRelativeDelta());
                    if (this.takenOffset.length() < correct.length()) {
                        delete this.takenOffset;
                        return delete this.takenOrig;
                    } else {
                        this.takenOffset.sub(correct);
                        return this.current_position.add(this.takenOffset);
                    }
                }
        }
    };

    Player.prototype.finishAction = function(action) {
        var ref1;
        if (action.id === Action.LOOK_RESET) {
            this.look_action = null;
            return this.look_angle = 0.0;
        } else {
            if (action.id === ((ref1 = this.move_action) != null ? ref1.id : void 0)) {
                this.dir_sgn = this.new_dir_sgn;
            }
            if (action.id !== Action.LOOK_UP && action.id !== Action.LOOK_DOWN) {
                Player.__super__.finishAction.call(this, action);
            }
            if (action.id === Action.TURN_LEFT || action.id === Action.TURN_RIGHT) {
                if (this.rotate) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    this.rotate_action.reset();
                    return Timer.addAction(this.rotate_action);
                }
            }
        }
    };

    Player.prototype.die = function() {};

    Player.prototype.modKeyComboEventDown = function(mod, key, combo, event) {
        var action, dir, ref1;
        switch (key) {
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.push = (mod === 'ctrl' || mod === this.key.push);
                this.move = true;
                if (this.move_action == null) {
                    this.new_dir_sgn = this.dir_sgn = (key === 'down' || key === this.key.backward) && -1 || 1;
                    this.moveBot();
                } else {
                    this.new_dir_sgn = (key === 'down' || key === this.key.backward) && -1 || 1;
                    if (this.move_action.id === Action.JUMP && this.move_action.getRelativeTime() < 1) {
                        dir = (key === 'down' || key === this.key.backward) && -1 || 1;
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()).plus(this.getDir(dir))) && world.isUnoccupiedPos(this.position.plus(this.getDir(dir)))) {
                            action = this.getActionWithId(Action.JUMP_FORWARD);
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.dir_sgn = dir;
                            Timer.addAction(this.move_action);
                        }
                    }
                }
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = (key === 'left' || key === this.key.left) && Action.TURN_LEFT || Action.TURN_RIGHT;
                if (this.rotate_action == null) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    Timer.addAction(this.rotate_action);
                }
                return true;
            case this.key.jump:
                this.jump = true;
                this.jump_once = true;
                if (this.move_action == null) {
                    this.moveBot();
                    this.jump_once = false;
                } else {
                    if (this.move_action.id === Action.FORWARD && this.move_action.getRelativeTime() < 0.6 || this.move_action.id === Action.CLIMB_DOWN && this.move_action.getRelativeTime() < 0.2) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()))) {
                            if (world.isUnoccupiedPos(this.position.plus(this.getUp().plus(this.getDir())))) {
                                action = this.getActionWithId(Action.JUMP_FORWARD);
                                world.playSound('BOT_JUMP');
                            } else {
                                action = this.getActionWithId(Action.JUMP);
                            }
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.jump_once = false;
                            Timer.addAction(this.move_action);
                        }
                    } else if ((ref1 = this.move_action.id) === Action.JUMP || ref1 === Action.JUMP_FORWARD) {
                        this.jump_once = false;
                    }
                }
                return true;
            case 'ctrl':
            case this.key.push:
                this.push = true;
                return true;
            case 'f':
            case this.key.shoot:
                if (!this.shoot) {
                    this.shoot = true;
                    Timer.addAction(this.getActionWithId(Action.SHOOT));
                }
                return true;
            case this.key.lookUp:
            case this.key.lookDown:
                if (!this.look_action) {
                    this.look_action = this.getActionWithId((key === this.key.lookUp) && Action.LOOK_UP || Action.LOOK_DOWN);
                    this.look_action.reset();
                    Timer.addAction(this.look_action);
                }
                return true;
            case this.key.view:
                world.changeCameraMode();
                return true;
        }
        return false;
    };

    Player.prototype.modKeyComboEventUp = function(mod, key, combo, event) {
        switch (key) {
            case 'f':
            case this.key.shoot:
                Timer.removeAction(this.getActionWithId(Action.SHOOT));
                this.shoot = false;
                return true;
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.move = false;
                return true;
            case this.key.jump:
                this.jump = false;
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = 0;
                return true;
            case 'ctrl':
            case this.key.push:
                this.push = false;
                return true;
            case this.key.lookDown:
            case this.key.lookUp:
                if (this.look_action && this.look_action.id !== Action.LOOK_RESET) {
                    Timer.removeAction(this.look_action);
                }
                this.look_action = this.getActionWithId(Action.LOOK_RESET);
                Timer.addAction(this.look_action);
                return true;
            case this.key.view:
                return true;
        }
        return false;
    };

    return Player;

})(Bot);

module.exports = Player;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSxxREFBQTtJQUFBOzs7QUFBQSxNQUFtQixPQUFBLENBQVEsS0FBUixDQUFuQixFQUFFLGlCQUFGLEVBQVM7O0FBRVQsR0FBQSxHQUFTLE9BQUEsQ0FBUSxPQUFSOztBQUNULE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjs7QUFDVCxLQUFBLEdBQVMsT0FBQSxDQUFRLFNBQVI7O0FBQ1QsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSOztBQUVIOzs7SUFFQyxnQkFBQTtBQUVDLFlBQUE7UUFBQSx5Q0FBQSxTQUFBO1FBQ0EsSUFBQyxDQUFBLElBQUQsR0FBUTtRQUVSLElBQUcsS0FBQSxDQUFNLElBQUEsR0FBTyxLQUFLLENBQUMsR0FBTixDQUFVLE1BQVYsRUFBaUIsRUFBakIsQ0FBYixDQUFIO1lBQ0ksSUFBQyxDQUFBLEdBQUQsR0FBTyxLQURYO1NBQUEsTUFBQTtZQUdJLElBQUMsQ0FBQSxHQUFELEdBQ0k7Z0JBQUEsT0FBQSxFQUFVLEdBQVY7Z0JBQ0EsUUFBQSxFQUFVLEdBRFY7Z0JBRUEsSUFBQSxFQUFVLEdBRlY7Z0JBR0EsS0FBQSxFQUFVLEdBSFY7Z0JBSUEsTUFBQSxFQUFVLEdBSlY7Z0JBS0EsUUFBQSxFQUFVLEdBTFY7Z0JBTUEsS0FBQSxFQUFVLE9BTlY7Z0JBT0EsSUFBQSxFQUFVLE9BUFY7Z0JBUUEsSUFBQSxFQUFVLEdBUlY7Z0JBU0EsSUFBQSxFQUFVLE9BVFY7O1lBVUosS0FBSyxDQUFDLEdBQU4sQ0FBVSxNQUFWLEVBQWlCLElBQUMsQ0FBQSxHQUFsQixFQWRKOztRQWdCQSxJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksTUFBSixDQUFXLElBQVgsRUFBYztZQUFBLE1BQUEsRUFBUSxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVgsR0FBeUIsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUE1QztTQUFkO1FBRVYsSUFB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ckIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJcbiMgICAwMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgXG4jICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMFxuIyAgIDAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMDAwICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICBcbiMgICAwMDAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwXG4jICAgMDAwICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuXG57IHZhbGlkLCBwcmVmcyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5Cb3QgICAgPSByZXF1aXJlICcuL2JvdCdcbkFjdGlvbiA9IHJlcXVpcmUgJy4vYWN0aW9uJ1xuVGltZXIgID0gcmVxdWlyZSAnLi90aW1lcidcbkNhbWVyYSA9IHJlcXVpcmUgJy4vY2FtZXJhJ1xuIFxuY2xhc3MgUGxheWVyIGV4dGVuZHMgQm90XG4gICAgXG4gICAgQDogLT5cbiAgICAgICAgXG4gICAgICAgIHN1cGVyXG4gICAgICAgIEBuYW1lID0gJ3BsYXllcidcbiAgICAgICAgXG4gICAgICAgIGlmIHZhbGlkIHBrZXkgPSBwcmVmcy5nZXQgJ2tleXMnIHt9XG4gICAgICAgICAgICBAa2V5ID0gcGtleVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAa2V5ID1cbiAgICAgICAgICAgICAgICBmb3J3YXJkOiAgJ3cnXG4gICAgICAgICAgICAgICAgYmFja3dhcmQ6ICdzJ1xuICAgICAgICAgICAgICAgIGxlZnQ6ICAgICAnYSdcbiAgICAgICAgICAgICAgICByaWdodDogICAgJ2QnXG4gICAgICAgICAgICAgICAgbG9va1VwOiAgICdlJ1xuICAgICAgICAgICAgICAgIGxvb2tEb3duOiAncSdcbiAgICAgICAgICAgICAgICBzaG9vdDogICAgJ2VudGVyJ1xuICAgICAgICAgICAgICAgIGp1bXA6ICAgICAnc3BhY2UnXG4gICAgICAgICAgICAgICAgdmlldzogICAgICdjJ1xuICAgICAgICAgICAgICAgIHB1c2g6ICAgICAnc2hpZnQnXG4gICAgICAgICAgICBwcmVmcy5zZXQgJ2tleXMnIEBrZXlcblxuICAgICAgICBAY2FtZXJhID0gbmV3IENhbWVyYSBALCBhc3BlY3Q6IHdvcmxkLnZpZXcub2Zmc2V0V2lkdGggLyB3b3JsZC52aWV3Lm9mZnNldEhlaWdodFxuXG4gICAgICAgIEBsb29rX2FjdGlvbiA9IG51bGxcbiAgICAgICAgQGxvb2tfYW5nbGUgID0gMC4wXG4gICAgICAgIEBuZXdfZGlyX3NnbiA9IDEuMFxuICAgICAgICBAcm90YXRlICAgICAgPSAwXG4gICAgICAgIFxuICAgICAgICBAcmVjb3JkZXIgICAgPSBudWxsXG4gICAgICAgIEBwbGF5YmFjayAgICA9IG51bGxcbiAgICAgICAgXG4gICAgICAgIEBhZGRBY3Rpb24gbmV3IEFjdGlvbiBALCBBY3Rpb24uTE9PS19VUCwgICAgJ2xvb2sgdXAnICAgIDIyMFxuICAgICAgICBAYWRkQWN0aW9uIG5ldyBBY3Rpb24gQCwgQWN0aW9uLkxPT0tfRE9XTiwgICdsb29rIGRvd24nICAyMjBcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5MT09LX1JFU0VULCAnbG9vayByZXNldCcgNjBcbiAgICBcbiAgICAgICAgQGFkZEV2ZW50V2l0aE5hbWUgXCJsYW5kZWRcIlxuICAgIFxuICAgIGJ1bGxldEhpdFNvdW5kOiAtPiAnQlVMTEVUX0hJVF9QTEFZRVInXG4gICAgICAgICAgICBcbiAgICAjICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMFxuICAgICMgICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgIFxuICAgIGluaXRBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgICAgICMga2xvZyBcImluaXRBY3Rpb24gI3thY3Rpb24uaWR9ICN7YWN0aW9uLm5hbWV9XCJcbiAgICAgICAgc3dpdGNoIGFjdGlvbi5pZFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uQ0xJTUJfRE9XTlxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0NMSU1CJ1xuICAgICAgICAgICAgd2hlbiBBY3Rpb24uRk9SV0FSRFxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX01PVkUnXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5UVVJOX0xFRlQsIEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfVFVSTidcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkpVTVBcbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9KVU1QJ1xuICAgICAgICBcbiAgICAgICAgc3VwZXIgYWN0aW9uXG4gICAgICAgIFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAgICAgIDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwMFxuICAgICMgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDBcblxuICAgIHBlcmZvcm1BY3Rpb246IChhY3Rpb24pIC0+XG4gICAgICAgIFxuICAgICAgICByZWxUaW1lID0gYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpXG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5OT09QICAgICAgdGhlbiByZXR1cm5cbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfVVAgICB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIDkwLjBcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfRE9XTiB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIC05MC4wXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICAgICAgaWYgQGxvb2tfYW5nbGUgPiAwIHRoZW4gQGxvb2tfYW5nbGUgPSBNYXRoLm1pbiBAbG9va19hbmdsZSwgKDEuMC1yZWxUaW1lKSAqIDkwLjBcbiAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICBAbG9va19hbmdsZSA9IE1hdGgubWF4IEBsb29rX2FuZ2xlLCAoMS4wLXJlbFRpbWUpICogLTkwLjBcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzdXBlciBhY3Rpb24gXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgQHRha2VuT2Zmc2V0XG4gICAgICAgICAgICAgICAgICAgIGNvcnJlY3QgPSBAdGFrZW5PcmlnLm11bCBhY3Rpb24uZ2V0UmVsYXRpdmVEZWx0YSgpXG4gICAgICAgICAgICAgICAgICAgIGlmIEB0YWtlbk9mZnNldC5sZW5ndGgoKSA8IGNvcnJlY3QubGVuZ3RoKClcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBAdGFrZW5PZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBAdGFrZW5PcmlnXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIEB0YWtlbk9mZnNldC5zdWIgY29ycmVjdFxuICAgICAgICAgICAgICAgICAgICAgICAgQGN1cnJlbnRfcG9zaXRpb24uYWRkIEB0YWtlbk9mZnNldFxuICAgIFxuICAgICMgICAwMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAgICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMFxuICAgICMgICAwMDAgICAgICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgICAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgIFxuICAgIGZpbmlzaEFjdGlvbjogKGFjdGlvbikgLT5cbiAgICBcbiAgICAgICAgaWYgYWN0aW9uLmlkID09IEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICBAbG9va19hY3Rpb24gPSBudWxsXG4gICAgICAgICAgICBAbG9va19hbmdsZSAgPSAwLjBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaWYgYWN0aW9uLmlkID09IEBtb3ZlX2FjdGlvbj8uaWQgIyBtb3ZlIGZpbmlzaGVkLCB1cGRhdGUgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgQGRpcl9zZ24gPSBAbmV3X2Rpcl9zZ25cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgYWN0aW9uLmlkICE9IEFjdGlvbi5MT09LX1VQIGFuZCBhY3Rpb24uaWQgIT0gQWN0aW9uLkxPT0tfRE9XTlxuICAgICAgICAgICAgICAgIHN1cGVyIGFjdGlvblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBhY3Rpb24uaWQgPT0gQWN0aW9uLlRVUk5fTEVGVCBvciBhY3Rpb24uaWQgPT0gQWN0aW9uLlRVUk5fUklHSFRcbiAgICAgICAgICAgICAgICBpZiBAcm90YXRlXG4gICAgICAgICAgICAgICAgICAgIEByb3RhdGVfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBAcm90YXRlXG4gICAgICAgICAgICAgICAgICAgIEByb3RhdGVfYWN0aW9uLnJlc2V0KClcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEByb3RhdGVfYWN0aW9uXG4gICAgXG4gICAgZGllOiAtPlxuICAgICAgICAgICAgICAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgXG4gICAgIyAgIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgIFxuICAgICMgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgXG4gICAgICAgIFxuICAgIG1vZEtleUNvbWJvRXZlbnREb3duOiAobW9kLCBrZXksIGNvbWJvLCBldmVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICMga2xvZyBcInBsYXllci5tb2RLZXlDb21ib0V2ZW50RG93biBtb2Q6I3ttb2R9IGtleToje2tleX0gY29tYm86I3tjb21ib31cIlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIGtleVxuICAgICAgICAgICAgd2hlbiAndXAnICdkb3duJyBAa2V5LmZvcndhcmQsIEBrZXkuYmFja3dhcmRcbiAgICAgICAgICAgICAgICBAcHVzaCA9IChtb2QgaW4gWydjdHJsJyBAa2V5LnB1c2hdKVxuICAgICAgICAgICAgICAgIEBtb3ZlID0gdHJ1ZSAjIHRyeSB0byBtb3ZlIGFzIGxvbmcgYXMgdGhlIGtleSBpcyBub3QgcmVsZWFzZWRcbiAgICAgICAgICAgICAgICBpZiBub3QgQG1vdmVfYWN0aW9uP1xuICAgICAgICAgICAgICAgICAgICBAbmV3X2Rpcl9zZ24gPSBAZGlyX3NnbiA9IChrZXkgaW4gWydkb3duJyBAa2V5LmJhY2t3YXJkXSkgYW5kIC0xIG9yIDEgXG4gICAgICAgICAgICAgICAgICAgIEBtb3ZlQm90KCkgIyBwZXJmb3JtIG5ldyBtb3ZlIGFjdGlvbiAoZGVwZW5kaW5nIG9uIGVudmlyb25tZW50KVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgQG5ld19kaXJfc2duID0gKGtleSBpbiBbJ2Rvd24nIEBrZXkuYmFja3dhcmRdKSBhbmQgLTEgb3IgMVxuICAgICAgICAgICAgICAgICAgICBpZiBAbW92ZV9hY3Rpb24uaWQgPT0gQWN0aW9uLkpVTVAgYW5kIEBtb3ZlX2FjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKSA8IDEgXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSAoa2V5IGluIFsnZG93bicgQGtleS5iYWNrd2FyZF0pIGFuZCAtMSBvciAxIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ybGQuaXNVbm9jY3VwaWVkUG9zKEBwb3NpdGlvbi5wbHVzKEBnZXRVcCgpKS5wbHVzKEBnZXREaXIoZGlyKSkpIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLmlzVW5vY2N1cGllZFBvcyhAcG9zaXRpb24ucGx1cyhAZ2V0RGlyKGRpcikpKSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUF9GT1JXQVJEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi50YWtlT3ZlciBAbW92ZV9hY3Rpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQG1vdmVfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbiA9IGFjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAZGlyX3NnbiA9IGRpciAjIG5lZWRlZD9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnbGVmdCcgJ3JpZ2h0JyBAa2V5LmxlZnQsIEBrZXkucmlnaHRcbiAgICAgICAgICAgICAgICBAcm90YXRlID0gKGtleSBpbiBbJ2xlZnQnIEBrZXkubGVmdF0pIGFuZCBBY3Rpb24uVFVSTl9MRUZUIG9yIEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgaWYgbm90IEByb3RhdGVfYWN0aW9uPyAjIHBsYXllciBpcyBub3QgcGVyZm9ybWluZyBhIHJvdGF0aW9uXG4gICAgICAgICAgICAgICAgICAgIEByb3RhdGVfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBAcm90YXRlXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAcm90YXRlX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5qdW1wXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgQGp1bXAgPSB0cnVlICMgc3dpdGNoIHRvIGp1bXAgbW9kZSB1bnRpbCBqdW1wX2tleSByZWxlYXNlZFxuICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSB0cnVlXG4gICAgICAgICAgICAgICAgaWYgbm90IEBtb3ZlX2FjdGlvbj8gXG4gICAgICAgICAgICAgICAgICAgIEBtb3ZlQm90KCkgIyBwZXJmb3JtIGp1bXAgYWN0aW9uIChkZXBlbmRpbmcgb24gZW52aXJvbm1lbnQpXG4gICAgICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSBmYWxzZVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgIyBrbG9nICdqdW1wOm1vdmluZydcbiAgICAgICAgICAgICAgICAgICAgaWYgQG1vdmVfYWN0aW9uLmlkID09IEFjdGlvbi5GT1JXQVJEIGFuZCBAbW92ZV9hY3Rpb24uZ2V0UmVsYXRpdmVUaW1lKCkgPCAwLjYgb3IgXG4gICAgICAgICAgICAgICAgICAgICAgICBAbW92ZV9hY3Rpb24uaWQgPT0gQWN0aW9uLkNMSU1CX0RPV04gYW5kIEBtb3ZlX2FjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKSA8IDAuMlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgYWJvcnQgY3VycmVudCBtb3ZlIGFuZCBqdW1wIGluc3RlYWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGtsb2cgJ2p1bXA6bW92ZSBvciBjbGltYiBkb3duJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdvcmxkLmlzVW5vY2N1cGllZFBvcyBAcG9zaXRpb24ucGx1cyBAZ2V0VXAoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGtsb2cgJ2p1bXA6Y2FuIGRvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3JsZC5pc1Vub2NjdXBpZWRQb3MgQHBvc2l0aW9uLnBsdXMgQGdldFVwKCkucGx1cyBAZ2V0RGlyKCkgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUF9GT1JXQVJEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9KVU1QJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi50YWtlT3ZlciBAbW92ZV9hY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAbW92ZV9hY3Rpb24gPSBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbW92ZV9hY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiBAbW92ZV9hY3Rpb24uaWQgaW4gW0FjdGlvbi5KVU1QLCBBY3Rpb24uSlVNUF9GT1JXQVJEXVxuICAgICAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnY3RybCcgQGtleS5wdXNoXG4gICAgICAgICAgICAgICAgQHB1c2ggPSB0cnVlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnZicgQGtleS5zaG9vdFxuICAgICAgICAgICAgICAgIGlmIG5vdCBAc2hvb3RcbiAgICAgICAgICAgICAgICAgICAgQHNob290ID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uU0hPT1RcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkubG9va1VwLCBAa2V5Lmxvb2tEb3duXG4gICAgICAgICAgICAgICAgaWYgbm90IEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICBAbG9va19hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIChrZXkgPT0gQGtleS5sb29rVXApIGFuZCBBY3Rpb24uTE9PS19VUCBvciBBY3Rpb24uTE9PS19ET1dOXG4gICAgICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbi5yZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkudmlld1xuICAgICAgICAgICAgICAgIHdvcmxkLmNoYW5nZUNhbWVyYU1vZGUoKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICAgICBmYWxzZVxuICAgIFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwIFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICBcbiAgICAjICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwXG4gICAgXG4gICAgbW9kS2V5Q29tYm9FdmVudFVwOiAobW9kLCBrZXksIGNvbWJvLCBldmVudCkgLT5cbiAgICAgICAgIyBAcHVzaCA9IGZhbHNlIGlmIEBrZXkucHVzaCA9PSAnc2hpZnQnXG4gICAgICAgICMga2xvZyBcInBsYXllci5tb2RLZXlDb21ib0V2ZW50VXAgbW9kOiN7bW9kfSBrZXk6I3trZXl9IGNvbWJvOiN7Y29tYm99XCJcbiAgICAgICAgc3dpdGNoIGtleSAgICBcbiAgICAgICAgICAgIHdoZW4gJ2YnIEBrZXkuc2hvb3RcbiAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uU0hPT1RcbiAgICAgICAgICAgICAgICBAc2hvb3QgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gJ3VwJyAnZG93bicgQGtleS5mb3J3YXJkLCBAa2V5LmJhY2t3YXJkXG4gICAgICAgICAgICAgICAgQG1vdmUgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5qdW1wXG4gICAgICAgICAgICAgICAgQGp1bXAgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gJ2xlZnQnICdyaWdodCcgQGtleS5sZWZ0LCBAa2V5LnJpZ2h0XG4gICAgICAgICAgICAgICAgQHJvdGF0ZSA9IDBcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdjdHJsJyBAa2V5LnB1c2hcbiAgICAgICAgICAgICAgICBAcHVzaCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmxvb2tEb3duLCBAa2V5Lmxvb2tVcFxuICAgICAgICAgICAgICAgIGlmIEBsb29rX2FjdGlvbiBhbmQgQGxvb2tfYWN0aW9uLmlkICE9IEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICBAbG9va19hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS52aWV3IFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgZmFsc2VcbiAgICBcbm1vZHVsZS5leHBvcnRzID0gUGxheWVyXG4iXX0=
//# sourceURL=../coffee/player.coffee