// koffee 1.4.0
var Action, Bot, Camera, Player, Quaternion, Timer, Vector, _, clamp, ref,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), clamp = ref.clamp, _ = ref._;

Bot = require('./bot');

Action = require('./action');

Timer = require('./timer');

Vector = require('./lib/vector');

Camera = require('./camera');

Quaternion = require('./lib/quaternion');

Player = (function(superClass) {
    extend(Player, superClass);

    function Player() {
        Player.__super__.constructor.apply(this, arguments);
        this.name = 'player';
        this.key = {
            forward: 'w',
            backward: 's',
            left: 'a',
            right: 'd',
            lookUp: 'q',
            lookDown: 'e',
            shoot: 'enter',
            jump: 'space',
            view: 'c',
            push: 'shift'
        };
        this.camera = new Camera(this, {
            aspect: world.view.offsetWidth / world.view.offsetHeight
        });
        this.look_action = null;
        this.look_angle = 0.0;
        this.new_dir_sgn = 1.0;
        this.rotate = 0;
        this.recorder = null;
        this.playback = null;
        this.addAction(new Action(this, Action.LOOK_UP, "look up", 220));
        this.addAction(new Action(this, Action.LOOK_DOWN, "look down", 220));
        this.addAction(new Action(this, Action.LOOK_RESET, "look reset", 60));
        this.addEventWithName("landed");
    }

    Player.prototype.bulletHitSound = function() {
        return 'BULLET_HIT_PLAYER';
    };

    Player.prototype.initAction = function(action) {
        switch (action.id) {
            case Action.CLIMB_DOWN:
                world.playSound('BOT_CLIMB');
                break;
            case Action.FORWARD:
                world.playSound('BOT_MOVE');
                break;
            case Action.TURN_LEFT:
            case Action.TURN_RIGHT:
                world.playSound('BOT_TURN');
                break;
            case Action.JUMP:
                world.playSound('BOT_JUMP');
        }
        return Player.__super__.initAction.call(this, action);
    };

    Player.prototype.performAction = function(action) {
        var relTime;
        relTime = action.getRelativeTime();
        switch (action.id) {
            case Action.NOOP:
                break;
            case Action.LOOK_UP:
                return this.look_angle = relTime * 90.0;
            case Action.LOOK_DOWN:
                return this.look_angle = relTime * -90.0;
            case Action.LOOK_RESET:
                if (this.look_angle > 0) {
                    return this.look_angle = Math.min(this.look_angle, (1.0 - relTime) * 90.0);
                } else {
                    return this.look_angle = Math.max(this.look_angle, (1.0 - relTime) * -90.0);
                }
                break;
            default:
                return Player.__super__.performAction.call(this, action);
        }
    };

    Player.prototype.finishAction = function(action) {
        var ref1;
        if (action.id === Action.LOOK_RESET) {
            this.look_action = null;
            return this.look_angle = 0.0;
        } else {
            if (action.id === ((ref1 = this.move_action) != null ? ref1.id : void 0)) {
                this.dir_sgn = this.new_dir_sgn;
            }
            if (action.id !== Action.LOOK_UP && action.id !== Action.LOOK_DOWN) {
                Player.__super__.finishAction.call(this, action);
            }
            if (action.id === Action.TURN_LEFT || action.id === Action.TURN_RIGHT) {
                if (this.rotate) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    this.rotate_action.reset();
                    return Timer.addAction(this.rotate_action);
                }
            }
        }
    };

    Player.prototype.die = function() {};

    Player.prototype.modKeyComboEventDown = function(mod, key, combo, event) {
        var action, ref1;
        switch (key) {
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.push = mod === this.key.push;
                this.move = true;
                if (this.move_action == null) {
                    this.new_dir_sgn = this.dir_sgn = (key === 'down' || key === this.key.backward) && -1 || 1;
                    this.moveBot();
                } else {
                    if (this.move_action.id === Action.JUMP && this.move_action.getRelativeTime() < 1) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()).plus(this.getDir())) && world.isUnoccupiedPos(this.position.plus(this.getDir()))) {
                            action = this.getActionWithId(Action.JUMP_FORWARD);
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            Timer.addAction(this.move_action);
                        }
                    }
                    this.new_dir_sgn = (key === this.key.backward) && -1 || 1;
                }
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = (key === 'left' || key === this.key.left) && Action.TURN_LEFT || Action.TURN_RIGHT;
                if (this.rotate_action == null) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    Timer.addAction(this.rotate_action);
                }
                return true;
            case this.key.jump:
                this.jump = true;
                this.jump_once = true;
                if (this.move_action == null) {
                    this.moveBot();
                    this.jump_once = false;
                } else {
                    if (this.move_action.id === Action.FORWARD && this.move_action.getRelativeTime() < 0.6 || this.move_action.id === Action.CLIMB_DOWN && this.move_action.getRelativeTime() < 0.4) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()))) {
                            if (world.isUnoccupiedPos(this.position.plus(this.getUp().plus(this.getDir())))) {
                                action = this.getActionWithId(Action.JUMP_FORWARD);
                            } else {
                                action = this.getActionWithId(Action.JUMP);
                            }
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.jump_once = false;
                            Timer.addAction(this.move_action);
                        }
                    } else if ((ref1 = this.move_action.id) === Action.JUMP || ref1 === Action.JUMP_FORWARD) {
                        this.jump_once = false;
                    }
                }
                return true;
            case this.key.push:
                this.push = true;
                return true;
            case this.key.shoot:
                if (!this.shoot) {
                    this.shoot = true;
                    Timer.addAction(this.getActionWithId(Action.SHOOT));
                }
                return true;
            case this.key.lookUp:
            case this.key.lookDown:
                if (!this.look_action) {
                    this.look_action = this.getActionWithId((key === this.key.lookUp) && Action.LOOK_UP || Action.LOOK_DOWN);
                    this.look_action.reset();
                    Timer.addAction(this.look_action);
                }
                return true;
            case this.key.view:
                world.changeCameraMode();
                return true;
        }
        return false;
    };

    Player.prototype.modKeyComboEventUp = function(mod, key, combo, event) {
        if (this.key.push === 'shift') {
            this.push = false;
        }
        switch (key) {
            case this.key.shoot:
                Timer.removeAction(this.getActionWithId(Action.SHOOT));
                this.shoot = false;
                return true;
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.move = false;
                return true;
            case this.key.jump:
                this.jump = false;
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = 0;
                return true;
            case this.key.push:
                this.push = false;
                return true;
            case this.key.lookDown:
            case this.key.lookUp:
                if (this.look_action && this.look_action.id !== Action.LOOK_RESET) {
                    Timer.removeAction(this.look_action);
                }
                this.look_action = this.getActionWithId(Action.LOOK_RESET);
                Timer.addAction(this.look_action);
                return true;
            case this.key.view:
                return true;
        }
        return false;
    };

    return Player;

})(Bot);

module.exports = Player;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSxxRUFBQTtJQUFBOzs7QUFBQSxNQUFpQixPQUFBLENBQVEsS0FBUixDQUFqQixFQUFFLGlCQUFGLEVBQVM7O0FBQ1QsR0FBQSxHQUFjLE9BQUEsQ0FBUSxPQUFSOztBQUNkLE1BQUEsR0FBYyxPQUFBLENBQVEsVUFBUjs7QUFDZCxLQUFBLEdBQWMsT0FBQSxDQUFRLFNBQVI7O0FBQ2QsTUFBQSxHQUFjLE9BQUEsQ0FBUSxjQUFSOztBQUNkLE1BQUEsR0FBYyxPQUFBLENBQVEsVUFBUjs7QUFDZCxVQUFBLEdBQWMsT0FBQSxDQUFRLGtCQUFSOztBQUVSOzs7SUFFQyxnQkFBQTtRQUVDLHlDQUFBLFNBQUE7UUFDQSxJQUFDLENBQUEsSUFBRCxHQUFRO1FBQ1IsSUFBQyxDQUFBLEdBQUQsR0FDSTtZQUFBLE9BQUEsRUFBVSxHQUFWO1lBQ0EsUUFBQSxFQUFVLEdBRFY7WUFFQSxJQUFBLEVBQVUsR0FGVjtZQUdBLEtBQUEsRUFBVSxHQUhWO1lBSUEsTUFBQSxFQUFVLEdBSlY7WUFLQSxRQUFBLEVBQVUsR0FMVjtZQU1BLEtBQUEsRUFBVSxPQU5WO1lBT0EsSUFBQSxFQUFVLE9BUFY7WUFRQSxJQUFBLEVBQVUsR0FSVjtZQVNBLElBQUEsRUFBVSxPQVRWOztRQVdKLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBSSxNQUFKLENBQVcsSUFBWCxFQUFjO1lBQUEsTUFBQSxFQUFRLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBWCxHQUF5QixLQUFLLENBQUMsSUFBSSxDQUFDLFlBQTVDO1NBQWQ7UUFFVixJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFVBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxXQUFELEdBQWU7UUFDZixJQUFDLENBQUEsTUFBRCxHQUFlO1FBRWYsSUFBQyxDQUFBLFFBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxR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QSxJQUFDLENBQUEsV0FBRCxHQUFlLElBQUMsQ0FBQSxlQUFELENBQWlCLE1BQU0sQ0FBQyxVQUF4QjtnQkFDZixLQUFLLENBQUMsU0FBTixDQUFnQixJQUFDLENBQUEsV0FBakI7QUFDQSx1QkFBTztBQTNCZixpQkE2QlMsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQTdCZDtBQThCUSx1QkFBTztBQTlCZjtlQWdDQTtJQW5DZ0I7Ozs7R0FuTUg7O0FBd09yQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIlxuIyAgIDAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCBcbiMgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwXG4jICAgMDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwMDAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIFxuIyAgIDAwMCAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbiMgICAwMDAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwXG5cbnsgY2xhbXAsIF8gfSAgID0gcmVxdWlyZSAna3hrJ1xuQm90ICAgICAgICAgPSByZXF1aXJlICcuL2JvdCdcbkFjdGlvbiAgICAgID0gcmVxdWlyZSAnLi9hY3Rpb24nXG5UaW1lciAgICAgICA9IHJlcXVpcmUgJy4vdGltZXInXG5WZWN0b3IgICAgICA9IHJlcXVpcmUgJy4vbGliL3ZlY3RvcidcbkNhbWVyYSAgICAgID0gcmVxdWlyZSAnLi9jYW1lcmEnXG5RdWF0ZXJuaW9uICA9IHJlcXVpcmUgJy4vbGliL3F1YXRlcm5pb24nXG4gXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBCb3RcbiAgICBcbiAgICBAOiAtPlxuICAgICAgICBcbiAgICAgICAgc3VwZXJcbiAgICAgICAgQG5hbWUgPSAncGxheWVyJ1xuICAgICAgICBAa2V5ID1cbiAgICAgICAgICAgIGZvcndhcmQ6ICAndydcbiAgICAgICAgICAgIGJhY2t3YXJkOiAncydcbiAgICAgICAgICAgIGxlZnQ6ICAgICAnYSdcbiAgICAgICAgICAgIHJpZ2h0OiAgICAnZCdcbiAgICAgICAgICAgIGxvb2tVcDogICAncSdcbiAgICAgICAgICAgIGxvb2tEb3duOiAnZSdcbiAgICAgICAgICAgIHNob290OiAgICAnZW50ZXInXG4gICAgICAgICAgICBqdW1wOiAgICAgJ3NwYWNlJ1xuICAgICAgICAgICAgdmlldzogICAgICdjJ1xuICAgICAgICAgICAgcHVzaDogICAgICdzaGlmdCdcblxuICAgICAgICBAY2FtZXJhID0gbmV3IENhbWVyYSBALCBhc3BlY3Q6IHdvcmxkLnZpZXcub2Zmc2V0V2lkdGggLyB3b3JsZC52aWV3Lm9mZnNldEhlaWdodFxuXG4gICAgICAgIEBsb29rX2FjdGlvbiA9IG51bGxcbiAgICAgICAgQGxvb2tfYW5nbGUgID0gMC4wXG4gICAgICAgIEBuZXdfZGlyX3NnbiA9IDEuMFxuICAgICAgICBAcm90YXRlICAgICAgPSAwXG4gICAgICAgIFxuICAgICAgICBAcmVjb3JkZXIgICAgPSBudWxsXG4gICAgICAgIEBwbGF5YmFjayAgICA9IG51bGxcbiAgICAgICAgXG4gICAgICAgIEBhZGRBY3Rpb24gbmV3IEFjdGlvbiBALCBBY3Rpb24uTE9PS19VUCwgICAgXCJsb29rIHVwXCIsICAgIDIyMFxuICAgICAgICBAYWRkQWN0aW9uIG5ldyBBY3Rpb24gQCwgQWN0aW9uLkxPT0tfRE9XTiwgIFwibG9vayBkb3duXCIsICAyMjBcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5MT09LX1JFU0VULCBcImxvb2sgcmVzZXRcIiwgNjBcbiAgICBcbiAgICAgICAgQGFkZEV2ZW50V2l0aE5hbWUgXCJsYW5kZWRcIlxuICAgIFxuICAgIGJ1bGxldEhpdFNvdW5kOiAtPiAnQlVMTEVUX0hJVF9QTEFZRVInXG4gICAgICAgICAgICBcbiAgICAjICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMFxuICAgICMgICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgIFxuICAgIGluaXRBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgICAgICMga2xvZyBcImluaXRBY3Rpb24gI3thY3Rpb24uaWR9ICN7YWN0aW9uLm5hbWV9XCJcbiAgICAgICAgc3dpdGNoIGFjdGlvbi5pZFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uQ0xJTUJfRE9XTlxuICAgICAgICAgICAgICAgICMgQGFkZE1vdmVzIDEgXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfQ0xJTUInXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5GT1JXQVJEXG4gICAgICAgICAgICAgICAgIyBAYWRkTW92ZXMgMSBcbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9NT1ZFJ1xuICAgICAgICAgICAgd2hlbiBBY3Rpb24uVFVSTl9MRUZULCBBY3Rpb24uVFVSTl9SSUdIVFxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX1RVUk4nXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5KVU1QXG4gICAgICAgICAgICAgICAgIyBAYWRkTW92ZXMgYWN0aW9uSWQgPT0gQWN0aW9uLkpVTVAgYW5kIDEgb3IgMlxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgIFxuICAgICAgICBzdXBlciBhY3Rpb25cbiAgICAgICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMCAgICAgMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgcGVyZm9ybUFjdGlvbjogKGFjdGlvbikgLT5cbiAgICAgICAgcmVsVGltZSA9IGFjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKVxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5OT09QICAgICAgdGhlbiByZXR1cm5cbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfVVAgICB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIDkwLjBcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfRE9XTiB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIC05MC4wXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICAgICAgaWYgQGxvb2tfYW5nbGUgPiAwIHRoZW4gQGxvb2tfYW5nbGUgPSBNYXRoLm1pbiBAbG9va19hbmdsZSwgKDEuMC1yZWxUaW1lKSAqIDkwLjBcbiAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICBAbG9va19hbmdsZSA9IE1hdGgubWF4IEBsb29rX2FuZ2xlLCAoMS4wLXJlbFRpbWUpICogLTkwLjBcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzdXBlciBhY3Rpb24gXG4gICAgXG4gICAgIyAgIDAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMDAwMCAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgXG4gICAgZmluaXNoQWN0aW9uOiAoYWN0aW9uKSAtPlxuICAgIFxuICAgICAgICBpZiBhY3Rpb24uaWQgPT0gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IG51bGxcbiAgICAgICAgICAgIEBsb29rX2FuZ2xlICA9IDAuMFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBhY3Rpb24uaWQgPT0gQG1vdmVfYWN0aW9uPy5pZCAjIG1vdmUgZmluaXNoZWQsIHVwZGF0ZSBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICBAZGlyX3NnbiA9IEBuZXdfZGlyX3NnblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBhY3Rpb24uaWQgIT0gQWN0aW9uLkxPT0tfVVAgYW5kIGFjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19ET1dOXG4gICAgICAgICAgICAgICAgc3VwZXIgYWN0aW9uXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCA9PSBBY3Rpb24uVFVSTl9MRUZUIG9yIGFjdGlvbi5pZCA9PSBBY3Rpb24uVFVSTl9SSUdIVFxuICAgICAgICAgICAgICAgIGlmIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24ucmVzZXQoKVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQHJvdGF0ZV9hY3Rpb25cbiAgICBcbiAgICBkaWU6ICgpIC0+XG4gICAgICAgICAgICAgICAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwIDAwMCBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgXG4gICAgIyAgIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMCAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICBcbiAgICAgICAgXG4gICAgbW9kS2V5Q29tYm9FdmVudERvd246IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgIyBrbG9nIFwicGxheWVyLm1vZEtleUNvbWJvRXZlbnREb3duIG1vZDoje21vZH0ga2V5OiN7a2V5fSBjb21ibzoje2NvbWJvfVwiXG4gICAgICAgIFxuICAgICAgICBzd2l0Y2gga2V5XG4gICAgICAgICAgICB3aGVuICd1cCcgJ2Rvd24nIEBrZXkuZm9yd2FyZCwgQGtleS5iYWNrd2FyZFxuICAgICAgICAgICAgICAgIEBwdXNoID0gbW9kID09IEBrZXkucHVzaFxuICAgICAgICAgICAgICAgIEBtb3ZlID0gdHJ1ZSAjIHRyeSB0byBtb3ZlIGFzIGxvbmcgYXMgdGhlIGtleSBpcyBub3QgcmVsZWFzZWRcbiAgICAgICAgICAgICAgICBpZiBub3QgQG1vdmVfYWN0aW9uP1xuICAgICAgICAgICAgICAgICAgICBAbmV3X2Rpcl9zZ24gPSBAZGlyX3NnbiA9IChrZXkgaW4gWydkb3duJyBAa2V5LmJhY2t3YXJkXSkgYW5kIC0xIG9yIDEgXG4gICAgICAgICAgICAgICAgICAgIEBtb3ZlQm90KCkgIyBwZXJmb3JtIG5ldyBtb3ZlIGFjdGlvbiAoZGVwZW5kaW5nIG9uIGVudmlyb25tZW50KVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgaWYgQG1vdmVfYWN0aW9uLmlkID09IEFjdGlvbi5KVU1QIGFuZCBAbW92ZV9hY3Rpb24uZ2V0UmVsYXRpdmVUaW1lKCkgPCAxICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3JsZC5pc1Vub2NjdXBpZWRQb3MoQHBvc2l0aW9uLnBsdXMoQGdldFVwKCkpLnBsdXMoQGdldERpcigpKSkgYW5kXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ybGQuaXNVbm9jY3VwaWVkUG9zKEBwb3NpdGlvbi5wbHVzKEBnZXREaXIoKSkpICMgZm9yd2FyZCBhbmQgYWJvdmUgZm9yd2FyZCBhbHNvIGVtcHR5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLkpVTVBfRk9SV0FSRFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24udGFrZU92ZXIgQG1vdmVfYWN0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAbW92ZV9hY3Rpb24gPSBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBtb3ZlX2FjdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIEBuZXdfZGlyX3NnbiA9IChrZXkgPT0gQGtleS5iYWNrd2FyZCkgYW5kIC0xIG9yIDFcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gJ2xlZnQnICdyaWdodCcgQGtleS5sZWZ0LCBAa2V5LnJpZ2h0XG4gICAgICAgICAgICAgICAgQHJvdGF0ZSA9IChrZXkgaW4gWydsZWZ0JyBAa2V5LmxlZnRdKSBhbmQgQWN0aW9uLlRVUk5fTEVGVCBvciBBY3Rpb24uVFVSTl9SSUdIVFxuICAgICAgICAgICAgICAgIGlmIG5vdCBAcm90YXRlX2FjdGlvbj8gIyBwbGF5ZXIgaXMgbm90IHBlcmZvcm1pbmcgYSByb3RhdGlvblxuICAgICAgICAgICAgICAgICAgICBAcm90YXRlX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQHJvdGF0ZVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQHJvdGF0ZV9hY3Rpb25cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkuanVtcFxuICAgICAgICAgICAgICAgIEBqdW1wID0gdHJ1ZSAjIHN3aXRjaCB0byBqdW1wIG1vZGUgdW50aWwganVtcF9rZXkgcmVsZWFzZWRcbiAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGlmIG5vdCBAbW92ZV9hY3Rpb24/IFxuICAgICAgICAgICAgICAgICAgICBAbW92ZUJvdCgpICMgcGVyZm9ybSBqdW1wIGFjdGlvbiAoZGVwZW5kaW5nIG9uIGVudmlyb25tZW50KVxuICAgICAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gZmFsc2VcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICMga2xvZyAnanVtcDptb3ZpbmcnXG4gICAgICAgICAgICAgICAgICAgIGlmIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uRk9SV0FSRCBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMC42IG9yIFxuICAgICAgICAgICAgICAgICAgICAgICAgQG1vdmVfYWN0aW9uLmlkID09IEFjdGlvbi5DTElNQl9ET1dOIGFuZCBAbW92ZV9hY3Rpb24uZ2V0UmVsYXRpdmVUaW1lKCkgPCAwLjRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGFib3J0IGN1cnJlbnQgbW92ZSBhbmQganVtcCBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBrbG9nICdqdW1wOm1vdmUgb3IgY2xpbWIgZG93bidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3JsZC5pc1Vub2NjdXBpZWRQb3MgQHBvc2l0aW9uLnBsdXMgQGdldFVwKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBrbG9nICdqdW1wOmNhbiBkbydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ybGQuaXNVbm9jY3VwaWVkUG9zIEBwb3NpdGlvbi5wbHVzIEBnZXRVcCgpLnBsdXMgQGdldERpcigpICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLkpVTVBfRk9SV0FSRFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24udGFrZU92ZXIgQG1vdmVfYWN0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAbW92ZV9hY3Rpb24gPSBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbW92ZV9hY3Rpb24gXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgQG1vdmVfYWN0aW9uLmlkIGluIFtBY3Rpb24uSlVNUCwgQWN0aW9uLkpVTVBfRk9SV0FSRF1cbiAgICAgICAgICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5wdXNoXG4gICAgICAgICAgICAgICAgQHB1c2ggPSB0cnVlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LnNob290XG4gICAgICAgICAgICAgICAgaWYgbm90IEBzaG9vdFxuICAgICAgICAgICAgICAgICAgICBAc2hvb3QgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5TSE9PVFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5sb29rVXAsIEBrZXkubG9va0Rvd25cbiAgICAgICAgICAgICAgICBpZiBub3QgQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgKGtleSA9PSBAa2V5Lmxvb2tVcCkgYW5kIEFjdGlvbi5MT09LX1VQIG9yIEFjdGlvbi5MT09LX0RPV05cbiAgICAgICAgICAgICAgICAgICAgQGxvb2tfYWN0aW9uLnJlc2V0KClcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS52aWV3XG4gICAgICAgICAgICAgICAgd29ybGQuY2hhbmdlQ2FtZXJhTW9kZSgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgIGZhbHNlXG4gICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDBcbiAgICBcbiAgICBtb2RLZXlDb21ib0V2ZW50VXA6IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPlxuICAgICAgICBAcHVzaCA9IGZhbHNlIGlmIEBrZXkucHVzaCA9PSAnc2hpZnQnXG4gICAgICAgICMga2xvZyBcInBsYXllci5tb2RLZXlDb21ib0V2ZW50VXAgbW9kOiN7bW9kfSBrZXk6I3trZXl9IGNvbWJvOiN7Y29tYm99XCJcbiAgICAgICAgc3dpdGNoIGtleSAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5zaG9vdFxuICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5TSE9PVFxuICAgICAgICAgICAgICAgIEBzaG9vdCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAndXAnICdkb3duJyBAa2V5LmZvcndhcmQsIEBrZXkuYmFja3dhcmRcbiAgICAgICAgICAgICAgICBAbW92ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmp1bXBcbiAgICAgICAgICAgICAgICBAanVtcCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnbGVmdCcgJ3JpZ2h0JyBAa2V5LmxlZnQsIEBrZXkucmlnaHRcbiAgICAgICAgICAgICAgICBAcm90YXRlID0gMFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5wdXNoXG4gICAgICAgICAgICAgICAgQHB1c2ggPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5sb29rRG93biwgQGtleS5sb29rVXBcbiAgICAgICAgICAgICAgICBpZiBAbG9va19hY3Rpb24gYW5kIEBsb29rX2FjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgQGxvb2tfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkudmlldyBcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgIGZhbHNlXG4gICAgXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllclxuIl19
//# sourceURL=../coffee/player.coffee