// koffee 1.4.0
var Action, Bot, Camera, Player, Quaternion, Timer, Vector, clamp,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

clamp = require('kxk').clamp;

Bot = require('./bot');

Action = require('./action');

Timer = require('./timer');

Vector = require('./lib/vector');

Camera = require('./camera');

Quaternion = require('./lib/quaternion');

Player = (function(superClass) {
    extend(Player, superClass);

    function Player() {
        Player.__super__.constructor.apply(this, arguments);
        this.name = 'player';
        this.key = {
            forward: 'w',
            backward: 's',
            left: 'a',
            right: 'd',
            lookUp: 'up',
            lookDown: 'down',
            shoot: 'enter',
            jump: 'space',
            view: 'c',
            push: 'shift'
        };
        this.camera = new Camera(this, {
            aspect: world.view.offsetWidth / world.view.offsetHeight
        });
        this.look_action = null;
        this.look_angle = 0.0;
        this.new_dir_sgn = 1.0;
        this.rotate = 0;
        this.recorder = null;
        this.playback = null;
        this.addAction(new Action(this, Action.LOOK_UP, "look up", 220));
        this.addAction(new Action(this, Action.LOOK_DOWN, "look down", 220));
        this.addAction(new Action(this, Action.LOOK_RESET, "look reset", 60));
        this.addEventWithName("landed");
    }

    Player.prototype.bulletHitSound = function() {
        return 'BULLET_HIT_PLAYER';
    };

    Player.prototype.initAction = function(action) {
        switch (action.id) {
            case Action.CLIMB_DOWN:
                world.playSound('BOT_CLIMB');
                break;
            case Action.FORWARD:
                world.playSound('BOT_MOVE');
                break;
            case Action.TURN_LEFT:
            case Action.TURN_RIGHT:
                world.playSound('BOT_TURN');
                break;
            case Action.JUMP:
                world.playSound('BOT_JUMP');
        }
        return Player.__super__.initAction.call(this, action);
    };

    Player.prototype.performAction = function(action) {
        var relTime;
        relTime = action.getRelativeTime();
        switch (action.id) {
            case Action.NOOP:
                break;
            case Action.LOOK_UP:
                return this.look_angle = relTime * 90.0;
            case Action.LOOK_DOWN:
                return this.look_angle = relTime * -90.0;
            case Action.LOOK_RESET:
                if (this.look_angle > 0) {
                    return this.look_angle = Math.min(this.look_angle, (1.0 - relTime) * 90.0);
                } else {
                    return this.look_angle = Math.max(this.look_angle, (1.0 - relTime) * -90.0);
                }
                break;
            default:
                return Player.__super__.performAction.call(this, action);
        }
    };

    Player.prototype.finishAction = function(action) {
        var ref;
        if (action.id === Action.LOOK_RESET) {
            this.look_action = null;
            return this.look_angle = 0.0;
        } else {
            if (action.id === ((ref = this.move_action) != null ? ref.id : void 0)) {
                this.dir_sgn = this.new_dir_sgn;
            }
            if (action.id !== Action.LOOK_UP && action.id !== Action.LOOK_DOWN) {
                Player.__super__.finishAction.call(this, action);
            }
            if (action.id === Action.TURN_LEFT || action.id === Action.TURN_RIGHT) {
                if (this.rotate) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    this.rotate_action.reset();
                    return Timer.addAction(this.rotate_action);
                }
            }
        }
    };

    Player.prototype.die = function() {};

    Player.prototype.modKeyComboEventDown = function(mod, key, combo, event) {
        var action, ref;
        switch (key) {
            case this.key.forward:
            case this.key.backward:
                this.push = mod === this.key.push;
                this.move = true;
                if (this.move_action == null) {
                    this.new_dir_sgn = this.dir_sgn = (key === this.key.backward) && -1 || 1;
                    this.moveBot();
                } else {
                    if (this.move_action.id === Action.JUMP && this.move_action.getRelativeTime() < 1) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()).plus(this.getDir())) && world.isUnoccupiedPos(this.position.plus(this.getDir()))) {
                            action = this.getActionWithId(Action.JUMP_FORWARD);
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            Timer.addAction(this.move_action);
                        }
                    }
                    this.new_dir_sgn = (key === this.key.backward) && -1 || 1;
                }
                return true;
            case this.key.left:
            case this.key.right:
                this.rotate = (key === this.key.left) && Action.TURN_LEFT || Action.TURN_RIGHT;
                if (this.rotate_action == null) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    Timer.addAction(this.rotate_action);
                }
                return true;
            case this.key.jump:
                this.jump = true;
                this.jump_once = true;
                if (this.move_action == null) {
                    this.moveBot();
                    this.jump_once = false;
                } else {
                    if (this.move_action.id === Action.FORWARD && this.move_action.getRelativeTime() < 0.6 || this.move_action.id === Action.CLIMB_DOWN && this.move_action.getRelativeTime() < 0.4) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()))) {
                            if (world.isUnoccupiedPos(this.position.plus(this.getUp().plus(this.getDir())))) {
                                action = this.getActionWithId(Action.JUMP_FORWARD);
                            } else {
                                action = this.getActionWithId(Action.JUMP);
                            }
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.jump_once = false;
                            Timer.addAction(this.move_action);
                        }
                    } else if ((ref = this.move_action.id) === Action.JUMP || ref === Action.JUMP_FORWARD) {
                        this.jump_once = false;
                    }
                }
                return true;
            case this.key.push:
                this.push = true;
                return true;
            case this.key.shoot:
                if (!this.shoot) {
                    this.shoot = true;
                    Timer.addAction(this.getActionWithId(Action.SHOOT));
                }
                return true;
            case this.key.lookUp:
            case this.key.lookDown:
                if (!this.look_action) {
                    this.look_action = this.getActionWithId((key === this.key.lookUp) && Action.LOOK_UP || Action.LOOK_DOWN);
                    this.look_action.reset();
                    Timer.addAction(this.look_action);
                }
                return true;
            case this.key.view:
                world.changeCameraMode();
                return true;
        }
        return false;
    };

    Player.prototype.modKeyComboEventUp = function(mod, key, combo, event) {
        if (this.key.push === 'shift') {
            this.push = false;
        }
        switch (key) {
            case this.key.shoot:
                Timer.removeAction(this.getActionWithId(Action.SHOOT));
                this.shoot = false;
                return true;
            case this.key.forward:
            case this.key.backward:
                this.move = false;
                return true;
            case this.key.jump:
                this.jump = false;
                return true;
            case this.key.left:
            case this.key.right:
                this.rotate = 0;
                return true;
            case this.key.push:
                this.push = false;
                return true;
            case this.key.lookDown:
            case this.key.lookUp:
                if (this.look_action && this.look_action.id !== Action.LOOK_RESET) {
                    Timer.removeAction(this.look_action);
                }
                this.look_action = this.getActionWithId(Action.LOOK_RESET);
                Timer.addAction(this.look_action);
                return true;
            case this.key.view:
                return true;
        }
        return false;
    };

    return Player;

})(Bot);

module.exports = Player;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSw2REFBQTtJQUFBOzs7QUFBRSxRQUFZLE9BQUEsQ0FBUSxLQUFSOztBQUNkLEdBQUEsR0FBYyxPQUFBLENBQVEsT0FBUjs7QUFDZCxNQUFBLEdBQWMsT0FBQSxDQUFRLFVBQVI7O0FBQ2QsS0FBQSxHQUFjLE9BQUEsQ0FBUSxTQUFSOztBQUNkLE1BQUEsR0FBYyxPQUFBLENBQVEsY0FBUjs7QUFDZCxNQUFBLEdBQWMsT0FBQSxDQUFRLFVBQVI7O0FBQ2QsVUFBQSxHQUFjLE9BQUEsQ0FBUSxrQkFBUjs7QUFFUjs7O0lBRVcsZ0JBQUE7UUFFVCx5Q0FBQSxTQUFBO1FBQ0EsSUFBQyxDQUFBLElBQUQsR0FBUTtRQUNSLElBQUMsQ0FBQSxHQUFELEdBQ0k7WUFBQSxPQUFBLEVBQVUsR0FBVjtZQUNBLFFBQUEsRUFBVSxHQURWO1lBRUEsSUFBQSxFQUFVLEdBRlY7WUFHQSxLQUFBLEVBQVUsR0FIVjtZQUlBLE1BQUEsRUFBVSxJQUpWO1lBS0EsUUFBQSxFQUFVLE1BTFY7WUFNQSxLQUFBLEVBQVUsT0FOVjtZQU9BLElBQUEsRUFBVSxPQVBWO1lBUUEsSUFBQSxFQUFVLEdBUlY7WUFTQSxJQUFBLEVBQVUsT0FUVjs7UUFXSixJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksTUFBSixDQUFXLElBQVgsRUFDTjtZQUFBLE1BQUEsRUFBUSxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVgsR0FBeUIsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUE1QztTQURNO1FBR1YsSUFBQyxDQUFBLFdBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxVQUFELEdBQWU7UUFDZixJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLE1BQUQsR0FBZTtRQUVmLElBQUMsQ0FBQSxRQUFELEdBQWU7UUFDZixJQUFDLENBQUEsUUFBRCxHQUFlO1FBRWYsSUFBQyxDQUFB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LE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJcbiMgICAwMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgXG4jICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMFxuIyAgIDAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMDAwICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICBcbiMgICAwMDAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwXG4jICAgMDAwICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuXG57IGNsYW1wIH0gICA9IHJlcXVpcmUgJ2t4aydcbkJvdCAgICAgICAgID0gcmVxdWlyZSAnLi9ib3QnXG5BY3Rpb24gICAgICA9IHJlcXVpcmUgJy4vYWN0aW9uJ1xuVGltZXIgICAgICAgPSByZXF1aXJlICcuL3RpbWVyJ1xuVmVjdG9yICAgICAgPSByZXF1aXJlICcuL2xpYi92ZWN0b3InXG5DYW1lcmEgICAgICA9IHJlcXVpcmUgJy4vY2FtZXJhJ1xuUXVhdGVybmlvbiAgPSByZXF1aXJlICcuL2xpYi9xdWF0ZXJuaW9uJ1xuIFxuY2xhc3MgUGxheWVyIGV4dGVuZHMgQm90XG4gICAgXG4gICAgY29uc3RydWN0b3I6IC0+XG4gICAgICAgIFxuICAgICAgICBzdXBlclxuICAgICAgICBAbmFtZSA9ICdwbGF5ZXInXG4gICAgICAgIEBrZXkgPVxuICAgICAgICAgICAgZm9yd2FyZDogICd3J1xuICAgICAgICAgICAgYmFja3dhcmQ6ICdzJ1xuICAgICAgICAgICAgbGVmdDogICAgICdhJ1xuICAgICAgICAgICAgcmlnaHQ6ICAgICdkJ1xuICAgICAgICAgICAgbG9va1VwOiAgICd1cCdcbiAgICAgICAgICAgIGxvb2tEb3duOiAnZG93bidcbiAgICAgICAgICAgIHNob290OiAgICAnZW50ZXInXG4gICAgICAgICAgICBqdW1wOiAgICAgJ3NwYWNlJ1xuICAgICAgICAgICAgdmlldzogICAgICdjJ1xuICAgICAgICAgICAgcHVzaDogICAgICdzaGlmdCdcblxuICAgICAgICBAY2FtZXJhID0gbmV3IENhbWVyYSBALFxuICAgICAgICAgICAgYXNwZWN0OiB3b3JsZC52aWV3Lm9mZnNldFdpZHRoIC8gd29ybGQudmlldy5vZmZzZXRIZWlnaHRcblxuICAgICAgICBAbG9va19hY3Rpb24gPSBudWxsXG4gICAgICAgIEBsb29rX2FuZ2xlICA9IDAuMFxuICAgICAgICBAbmV3X2Rpcl9zZ24gPSAxLjBcbiAgICAgICAgQHJvdGF0ZSAgICAgID0gMFxuICAgICAgICBcbiAgICAgICAgQHJlY29yZGVyICAgID0gbnVsbFxuICAgICAgICBAcGxheWJhY2sgICAgPSBudWxsXG4gICAgICAgIFxuICAgICAgICBAYWRkQWN0aW9uIG5ldyBBY3Rpb24gQCwgQWN0aW9uLkxPT0tfVVAsICAgIFwibG9vayB1cFwiLCAgICAyMjBcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5MT09LX0RPV04sICBcImxvb2sgZG93blwiLCAgMjIwXG4gICAgICAgIEBhZGRBY3Rpb24gbmV3IEFjdGlvbiBALCBBY3Rpb24uTE9PS19SRVNFVCwgXCJsb29rIHJlc2V0XCIsIDYwXG4gICAgXG4gICAgICAgIEBhZGRFdmVudFdpdGhOYW1lIFwibGFuZGVkXCJcbiAgICBcbiAgICBidWxsZXRIaXRTb3VuZDogLT4gJ0JVTExFVF9ISVRfUExBWUVSJ1xuICAgICAgICAgICAgXG4gICAgIyAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAjICAgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMFxuICAgICMgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICBcbiAgICBpbml0QWN0aW9uOiAoYWN0aW9uKSAtPlxuICAgICAgICAjIGxvZyBcImluaXRBY3Rpb24gI3thY3Rpb24uaWR9ICN7YWN0aW9uLm5hbWV9XCJcbiAgICAgICAgc3dpdGNoIGFjdGlvbi5pZFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uQ0xJTUJfRE9XTlxuICAgICAgICAgICAgICAgICMgQGFkZE1vdmVzIDEgXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfQ0xJTUInXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5GT1JXQVJEXG4gICAgICAgICAgICAgICAgIyBAYWRkTW92ZXMgMSBcbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9NT1ZFJ1xuICAgICAgICAgICAgd2hlbiBBY3Rpb24uVFVSTl9MRUZULCBBY3Rpb24uVFVSTl9SSUdIVFxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX1RVUk4nXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5KVU1QXG4gICAgICAgICAgICAgICAgIyBAYWRkTW92ZXMgYWN0aW9uSWQgPT0gQWN0aW9uLkpVTVAgYW5kIDEgb3IgMlxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgIFxuICAgICAgICBzdXBlciBhY3Rpb25cbiAgICAgICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMCAgICAgMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgcGVyZm9ybUFjdGlvbjogKGFjdGlvbikgLT5cbiAgICAgICAgcmVsVGltZSA9IGFjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKVxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5OT09QICAgICAgdGhlbiByZXR1cm5cbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfVVAgICB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIDkwLjBcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfRE9XTiB0aGVuIEBsb29rX2FuZ2xlID0gcmVsVGltZSAqIC05MC4wXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5MT09LX1JFU0VUXG4gICAgICAgICAgICAgICAgaWYgQGxvb2tfYW5nbGUgPiAwIHRoZW4gQGxvb2tfYW5nbGUgPSBNYXRoLm1pbiBAbG9va19hbmdsZSwgKDEuMC1yZWxUaW1lKSAqIDkwLjBcbiAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICBAbG9va19hbmdsZSA9IE1hdGgubWF4IEBsb29rX2FuZ2xlLCAoMS4wLXJlbFRpbWUpICogLTkwLjBcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzdXBlciBhY3Rpb24gXG4gICAgXG4gICAgIyAgIDAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMDAwMCAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgXG4gICAgZmluaXNoQWN0aW9uOiAoYWN0aW9uKSAtPlxuICAgIFxuICAgICAgICBpZiBhY3Rpb24uaWQgPT0gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IG51bGxcbiAgICAgICAgICAgIEBsb29rX2FuZ2xlICA9IDAuMFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBhY3Rpb24uaWQgPT0gQG1vdmVfYWN0aW9uPy5pZCAjIG1vdmUgZmluaXNoZWQsIHVwZGF0ZSBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICBAZGlyX3NnbiA9IEBuZXdfZGlyX3NnblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBhY3Rpb24uaWQgIT0gQWN0aW9uLkxPT0tfVVAgYW5kIGFjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19ET1dOXG4gICAgICAgICAgICAgICAgc3VwZXIgYWN0aW9uXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCA9PSBBY3Rpb24uVFVSTl9MRUZUIG9yIGFjdGlvbi5pZCA9PSBBY3Rpb24uVFVSTl9SSUdIVFxuICAgICAgICAgICAgICAgIGlmIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24ucmVzZXQoKVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQHJvdGF0ZV9hY3Rpb25cbiAgICBcbiAgICBkaWU6ICgpIC0+XG4gICAgICAgICAgICAgICAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwIDAwMCBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgXG4gICAgIyAgIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMCAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICBcbiAgICAgICAgXG4gICAgbW9kS2V5Q29tYm9FdmVudERvd246IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgIyBsb2cgXCJwbGF5ZXIubW9kS2V5Q29tYm9FdmVudERvd24gbW9kOiN7bW9kfSBrZXk6I3trZXl9IGNvbWJvOiN7Y29tYm99XCJcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBrZXlcbiAgICAgICAgICAgIHdoZW4gQGtleS5mb3J3YXJkLCBAa2V5LmJhY2t3YXJkXG4gICAgICAgICAgICAgICAgQHB1c2ggPSBtb2QgPT0gQGtleS5wdXNoXG4gICAgICAgICAgICAgICAgQG1vdmUgPSB0cnVlICMgdHJ5IHRvIG1vdmUgYXMgbG9uZyBhcyB0aGUga2V5IGlzIG5vdCByZWxlYXNlZFxuICAgICAgICAgICAgICAgIGlmIG5vdCBAbW92ZV9hY3Rpb24/XG4gICAgICAgICAgICAgICAgICAgIEBuZXdfZGlyX3NnbiA9IEBkaXJfc2duID0gKGtleSA9PSBAa2V5LmJhY2t3YXJkKSBhbmQgLTEgb3IgMSBcbiAgICAgICAgICAgICAgICAgICAgQG1vdmVCb3QoKSAjIHBlcmZvcm0gbmV3IG1vdmUgYWN0aW9uIChkZXBlbmRpbmcgb24gZW52aXJvbm1lbnQpXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiBAbW92ZV9hY3Rpb24uaWQgPT0gQWN0aW9uLkpVTVAgYW5kIEBtb3ZlX2FjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKSA8IDEgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdvcmxkLmlzVW5vY2N1cGllZFBvcyhAcG9zaXRpb24ucGx1cyhAZ2V0VXAoKSkucGx1cyhAZ2V0RGlyKCkpKSBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JsZC5pc1Vub2NjdXBpZWRQb3MoQHBvc2l0aW9uLnBsdXMoQGdldERpcigpKSkgIyBmb3J3YXJkIGFuZCBhYm92ZSBmb3J3YXJkIGFsc28gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUF9GT1JXQVJEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi50YWtlT3ZlciBAbW92ZV9hY3Rpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQG1vdmVfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbiA9IGFjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQG1vdmVfYWN0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgQG5ld19kaXJfc2duID0gKGtleSA9PSBAa2V5LmJhY2t3YXJkKSBhbmQgLTEgb3IgMVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LmxlZnQsIEBrZXkucmlnaHRcbiAgICAgICAgICAgICAgICBAcm90YXRlID0gKGtleSA9PSBAa2V5LmxlZnQpIGFuZCBBY3Rpb24uVFVSTl9MRUZUIG9yIEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgaWYgbm90IEByb3RhdGVfYWN0aW9uPyAjIHBsYXllciBpcyBub3QgcGVyZm9ybWluZyBhIHJvdGF0aW9uXG4gICAgICAgICAgICAgICAgICAgIEByb3RhdGVfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBAcm90YXRlXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAcm90YXRlX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5qdW1wXG4gICAgICAgICAgICAgICAgQGp1bXAgPSB0cnVlICMgc3dpdGNoIHRvIGp1bXAgbW9kZSB1bnRpbCBqdW1wX2tleSByZWxlYXNlZFxuICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSB0cnVlXG4gICAgICAgICAgICAgICAgaWYgbm90IEBtb3ZlX2FjdGlvbj8gXG4gICAgICAgICAgICAgICAgICAgIEBtb3ZlQm90KCkgIyBwZXJmb3JtIGp1bXAgYWN0aW9uIChkZXBlbmRpbmcgb24gZW52aXJvbm1lbnQpXG4gICAgICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSBmYWxzZVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgIyBsb2cgJ2p1bXA6bW92aW5nJ1xuICAgICAgICAgICAgICAgICAgICBpZiBAbW92ZV9hY3Rpb24uaWQgPT0gQWN0aW9uLkZPUldBUkQgYW5kIEBtb3ZlX2FjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKSA8IDAuNiBvciBcbiAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uQ0xJTUJfRE9XTiBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMC40XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBhYm9ydCBjdXJyZW50IG1vdmUgYW5kIGp1bXAgaW5zdGVhZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbG9nICdqdW1wOm1vdmUgb3IgY2xpbWIgZG93bidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3JsZC5pc1Vub2NjdXBpZWRQb3MgQHBvc2l0aW9uLnBsdXMgQGdldFVwKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBsb2cgJ2p1bXA6Y2FuIGRvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3JsZC5pc1Vub2NjdXBpZWRQb3MgQHBvc2l0aW9uLnBsdXMgQGdldFVwKCkucGx1cyBAZ2V0RGlyKCkgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uSlVNUF9GT1JXQVJEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi50YWtlT3ZlciBAbW92ZV9hY3Rpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQG1vdmVfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbiA9IGFjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBtb3ZlX2FjdGlvbiBcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiBAbW92ZV9hY3Rpb24uaWQgaW4gW0FjdGlvbi5KVU1QLCBBY3Rpb24uSlVNUF9GT1JXQVJEXVxuICAgICAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LnB1c2hcbiAgICAgICAgICAgICAgICBAcHVzaCA9IHRydWVcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkuc2hvb3RcbiAgICAgICAgICAgICAgICBpZiBub3QgQHNob290XG4gICAgICAgICAgICAgICAgICAgIEBzaG9vdCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLlNIT09UXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmxvb2tVcCwgQGtleS5sb29rRG93blxuICAgICAgICAgICAgICAgIGlmIG5vdCBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgQGxvb2tfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCAoa2V5ID09IEBrZXkubG9va1VwKSBhbmQgQWN0aW9uLkxPT0tfVVAgb3IgQWN0aW9uLkxPT0tfRE9XTlxuICAgICAgICAgICAgICAgICAgICBAbG9va19hY3Rpb24ucmVzZXQoKVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LnZpZXdcbiAgICAgICAgICAgICAgICB3b3JsZC5jaGFuZ2VDYW1lcmFNb2RlKClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgZmFsc2VcbiAgICBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgIFxuICAgICMgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMFxuICAgIFxuICAgIG1vZEtleUNvbWJvRXZlbnRVcDogKG1vZCwga2V5LCBjb21ibywgZXZlbnQpIC0+XG4gICAgICAgIEBwdXNoID0gZmFsc2UgaWYgQGtleS5wdXNoID09ICdzaGlmdCdcbiAgICAgICAgIyBsb2cgXCJwbGF5ZXIubW9kS2V5Q29tYm9FdmVudFVwIG1vZDoje21vZH0ga2V5OiN7a2V5fSBjb21ibzoje2NvbWJvfVwiXG4gICAgICAgIHN3aXRjaCBrZXkgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkuc2hvb3RcbiAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uU0hPT1RcbiAgICAgICAgICAgICAgICBAc2hvb3QgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5mb3J3YXJkLCBAa2V5LmJhY2t3YXJkXG4gICAgICAgICAgICAgICAgQG1vdmUgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5qdW1wXG4gICAgICAgICAgICAgICAgQGp1bXAgPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5sZWZ0LCBAa2V5LnJpZ2h0XG4gICAgICAgICAgICAgICAgQHJvdGF0ZSA9IDBcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkucHVzaFxuICAgICAgICAgICAgICAgIEBwdXNoID0gZmFsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkubG9va0Rvd24sIEBrZXkubG9va1VwXG4gICAgICAgICAgICAgICAgaWYgQGxvb2tfYWN0aW9uIGFuZCBAbG9va19hY3Rpb24uaWQgIT0gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LnZpZXcgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICBmYWxzZVxuICAgIFxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJcbiJdfQ==
//# sourceURL=../coffee/player.coffee