// koffee 1.4.0
var Action, Bot, Camera, Player, Quaternion, Timer, Vector, clamp, log,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

clamp = require('./tools/tools').clamp;

log = require('./tools/log');

Bot = require('./bot');

Action = require('./action');

Timer = require('./timer');

Vector = require('./lib/vector');

Camera = require('./camera');

Quaternion = require('./lib/quaternion');

Player = (function(superClass) {
    extend(Player, superClass);

    function Player() {
        Player.__super__.constructor.apply(this, arguments);
        this.name = 'player';
        this.key = {
            forward: 'w',
            backward: 's',
            left: 'a',
            right: 'd',
            lookUp: 'up',
            lookDown: 'down',
            shoot: 'enter',
            jump: 'space',
            view: 'c',
            push: 'shift'
        };
        this.camera = new Camera(this, {
            aspect: world.view.offsetWidth / world.view.offsetHeight
        });
        this.look_action = null;
        this.look_angle = 0.0;
        this.new_dir_sgn = 1.0;
        this.rotate = 0;
        this.recorder = null;
        this.playback = null;
        this.addAction(new Action(this, Action.LOOK_UP, "look up", 220));
        this.addAction(new Action(this, Action.LOOK_DOWN, "look down", 220));
        this.addAction(new Action(this, Action.LOOK_RESET, "look reset", 60));
        this.addEventWithName("landed");
    }

    Player.prototype.bulletHitSound = function() {
        return 'BULLET_HIT_PLAYER';
    };

    Player.prototype.initAction = function(action) {
        switch (action.id) {
            case Action.CLIMB_DOWN:
                world.playSound('BOT_CLIMB');
                break;
            case Action.FORWARD:
                world.playSound('BOT_MOVE');
                break;
            case Action.TURN_LEFT:
            case Action.TURN_RIGHT:
                world.playSound('BOT_TURN');
                break;
            case Action.JUMP:
                world.playSound('BOT_JUMP');
        }
        return Player.__super__.initAction.call(this, action);
    };

    Player.prototype.performAction = function(action) {
        var relTime;
        relTime = action.getRelativeTime();
        switch (action.id) {
            case Action.NOOP:
                break;
            case Action.LOOK_UP:
                return this.look_angle = relTime * 90.0;
            case Action.LOOK_DOWN:
                return this.look_angle = relTime * -90.0;
            case Action.LOOK_RESET:
                if (this.look_angle > 0) {
                    return this.look_angle = Math.min(this.look_angle, (1.0 - relTime) * 90.0);
                } else {
                    return this.look_angle = Math.max(this.look_angle, (1.0 - relTime) * -90.0);
                }
                break;
            default:
                return Player.__super__.performAction.call(this, action);
        }
    };

    Player.prototype.finishAction = function(action) {
        var ref;
        if (action.id === Action.LOOK_RESET) {
            this.look_action = null;
            return this.look_angle = 0.0;
        } else {
            if (action.id === ((ref = this.move_action) != null ? ref.id : void 0)) {
                this.dir_sgn = this.new_dir_sgn;
            }
            if (action.id !== Action.LOOK_UP && action.id !== Action.LOOK_DOWN) {
                Player.__super__.finishAction.call(this, action);
            }
            if (action.id === Action.TURN_LEFT || action.id === Action.TURN_RIGHT) {
                if (this.rotate) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    this.rotate_action.reset();
                    return Timer.addAction(this.rotate_action);
                }
            }
        }
    };

    Player.prototype.die = function() {};

    Player.prototype.modKeyComboEventDown = function(mod, key, combo, event) {
        var action, ref;
        switch (key) {
            case this.key.forward:
            case this.key.backward:
                this.push = mod === this.key.push;
                this.move = true;
                if (this.move_action == null) {
                    this.new_dir_sgn = this.dir_sgn = (key === this.key.backward) && -1 || 1;
                    this.moveBot();
                } else {
                    if (this.move_action.id === Action.JUMP && this.move_action.getRelativeTime() < 1) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()).plus(this.getDir())) && world.isUnoccupiedPos(this.position.plus(this.getDir()))) {
                            action = this.getActionWithId(Action.JUMP_FORWARD);
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            Timer.addAction(this.move_action);
                        }
                    }
                    this.new_dir_sgn = (key === this.key.backward) && -1 || 1;
                }
                return true;
            case this.key.left:
            case this.key.right:
                this.rotate = (key === this.key.left) && Action.TURN_LEFT || Action.TURN_RIGHT;
                if (this.rotate_action == null) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    Timer.addAction(this.rotate_action);
                }
                return true;
            case this.key.jump:
                this.jump = true;
                this.jump_once = true;
                if (this.move_action == null) {
                    this.moveBot();
                    this.jump_once = false;
                } else {
                    if (this.move_action.id === Action.FORWARD && this.move_action.getRelativeTime() < 0.6 || this.move_action.id === Action.CLIMB_DOWN && this.move_action.getRelativeTime() < 0.4) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()))) {
                            if (world.isUnoccupiedPos(this.position.plus(this.getUp().plus(this.getDir())))) {
                                action = this.getActionWithId(Action.JUMP_FORWARD);
                            } else {
                                action = this.getActionWithId(Action.JUMP);
                            }
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.jump_once = false;
                            Timer.addAction(this.move_action);
                        }
                    } else if ((ref = this.move_action.id) === Action.JUMP || ref === Action.JUMP_FORWARD) {
                        this.jump_once = false;
                    }
                }
                return true;
            case this.key.push:
                this.push = true;
                return true;
            case this.key.shoot:
                if (!this.shoot) {
                    this.shoot = true;
                    Timer.addAction(this.getActionWithId(Action.SHOOT));
                }
                return true;
            case this.key.lookUp:
            case this.key.lookDown:
                if (!this.look_action) {
                    this.look_action = this.getActionWithId((key === this.key.lookUp) && Action.LOOK_UP || Action.LOOK_DOWN);
                    this.look_action.reset();
                    Timer.addAction(this.look_action);
                }
                return true;
            case this.key.view:
                world.changeCameraMode();
                return true;
        }
        return false;
    };

    Player.prototype.modKeyComboEventUp = function(mod, key, combo, event) {
        if (this.key.push === 'shift') {
            this.push = false;
        }
        switch (key) {
            case this.key.shoot:
                Timer.removeAction(this.getActionWithId(Action.SHOOT));
                this.shoot = false;
                return true;
            case this.key.forward:
            case this.key.backward:
                this.move = false;
                return true;
            case this.key.jump:
                this.jump = false;
                return true;
            case this.key.left:
            case this.key.right:
                this.rotate = 0;
                return true;
            case this.key.push:
                this.push = false;
                return true;
            case this.key.lookDown:
            case this.key.lookUp:
                if (this.look_action && this.look_action.id !== Action.LOOK_RESET) {
                    Timer.removeAction(this.look_action);
                }
                this.look_action = this.getActionWithId(Action.LOOK_RESET);
                Timer.addAction(this.look_action);
                return true;
            case this.key.view:
                return true;
        }
        return false;
    };

    return Player;

})(Bot);

module.exports = Player;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQSxrRUFBQTtJQUFBOzs7QUFDQSxRQUNjLE9BQUEsQ0FBUSxlQUFSOztBQUNkLEdBQUEsR0FBYyxPQUFBLENBQVEsYUFBUjs7QUFDZCxHQUFBLEdBQWMsT0FBQSxDQUFRLE9BQVI7O0FBQ2QsTUFBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSOztBQUNkLEtBQUEsR0FBYyxPQUFBLENBQVEsU0FBUjs7QUFDZCxNQUFBLEdBQWMsT0FBQSxDQUFRLGNBQVI7O0FBQ2QsTUFBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSOztBQUNkLFVBQUEsR0FBYyxPQUFBLENBQVEsa0JBQVI7O0FBRVI7OztJQUVXLGdCQUFBO1FBRVQseUNBQUEsU0FBQTtRQUNBLElBQUMsQ0FBQSxJQUFELEdBQVE7UUFDUixJQUFDLENBQUEsR0FBRCxHQUNJO1lBQUEsT0FBQSxFQUFVLEdBQVY7WUFDQSxRQUFBLEVBQVUsR0FEVjtZQUVBLElBQUEsRUFBVSxHQUZWO1lBR0EsS0FBQSxFQUFVLEdBSFY7WUFJQSxNQUFBLEVBQVUsSUFKVjtZQUtBLFFBQUEsRUFBVSxNQUxWO1lBTUEsS0FBQSxFQUFVLE9BTlY7WUFPQSxJQUFBLEVBQVUsT0FQVjtZQVFBLElBQUEsRUFBVSxHQVJWO1lBU0EsSUFBQSxFQUFVLE9BVFY7O1FBV0osSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFJLE1BQUosQ0FBVyxJQUFYLEVBQ047WUFBQSxNQUFBLEVBQVEsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFYLEdBQXlCLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBNUM7U0FETTtRQUdWLElBQUMsQ0FBQSxXQUFELEdBQWU7UUFDZixJQUFDLENBQUEsVUFBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFdBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxNQUFELEdBQWU7UUFFZixJQUFDLENBQUEsUUFBRCxHQUFlO1FBQ2YsSUFB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bkNnQjs7OztHQXBNSDs7QUF5T3JCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiXG4jICAgMDAwMDAwMDAgICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwIFxuIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDBcbiMgICAwMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwMCAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgXG4jICAgMDAwICAgICAgICAwMDAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuIyAgIDAwMCAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDBcbntcbmNsYW1wXG59ICAgICAgICAgICA9IHJlcXVpcmUgJy4vdG9vbHMvdG9vbHMnXG5sb2cgICAgICAgICA9IHJlcXVpcmUgJy4vdG9vbHMvbG9nJ1xuQm90ICAgICAgICAgPSByZXF1aXJlICcuL2JvdCdcbkFjdGlvbiAgICAgID0gcmVxdWlyZSAnLi9hY3Rpb24nXG5UaW1lciAgICAgICA9IHJlcXVpcmUgJy4vdGltZXInXG5WZWN0b3IgICAgICA9IHJlcXVpcmUgJy4vbGliL3ZlY3RvcidcbkNhbWVyYSAgICAgID0gcmVxdWlyZSAnLi9jYW1lcmEnXG5RdWF0ZXJuaW9uICA9IHJlcXVpcmUgJy4vbGliL3F1YXRlcm5pb24nXG4gXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBCb3RcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogLT5cbiAgICAgICAgXG4gICAgICAgIHN1cGVyXG4gICAgICAgIEBuYW1lID0gJ3BsYXllcidcbiAgICAgICAgQGtleSA9XG4gICAgICAgICAgICBmb3J3YXJkOiAgJ3cnXG4gICAgICAgICAgICBiYWNrd2FyZDogJ3MnXG4gICAgICAgICAgICBsZWZ0OiAgICAgJ2EnXG4gICAgICAgICAgICByaWdodDogICAgJ2QnXG4gICAgICAgICAgICBsb29rVXA6ICAgJ3VwJ1xuICAgICAgICAgICAgbG9va0Rvd246ICdkb3duJ1xuICAgICAgICAgICAgc2hvb3Q6ICAgICdlbnRlcidcbiAgICAgICAgICAgIGp1bXA6ICAgICAnc3BhY2UnXG4gICAgICAgICAgICB2aWV3OiAgICAgJ2MnXG4gICAgICAgICAgICBwdXNoOiAgICAgJ3NoaWZ0J1xuXG4gICAgICAgIEBjYW1lcmEgPSBuZXcgQ2FtZXJhIEAsXG4gICAgICAgICAgICBhc3BlY3Q6IHdvcmxkLnZpZXcub2Zmc2V0V2lkdGggLyB3b3JsZC52aWV3Lm9mZnNldEhlaWdodFxuXG4gICAgICAgIEBsb29rX2FjdGlvbiA9IG51bGxcbiAgICAgICAgQGxvb2tfYW5nbGUgID0gMC4wXG4gICAgICAgIEBuZXdfZGlyX3NnbiA9IDEuMFxuICAgICAgICBAcm90YXRlICAgICAgPSAwXG4gICAgICAgIFxuICAgICAgICBAcmVjb3JkZXIgICAgPSBudWxsXG4gICAgICAgIEBwbGF5YmFjayAgICA9IG51bGxcbiAgICAgICAgXG4gICAgICAgIEBhZGRBY3Rpb24gbmV3IEFjdGlvbiBALCBBY3Rpb24uTE9PS19VUCwgICAgXCJsb29rIHVwXCIsICAgIDIyMFxuICAgICAgICBAYWRkQWN0aW9uIG5ldyBBY3Rpb24gQCwgQWN0aW9uLkxPT0tfRE9XTiwgIFwibG9vayBkb3duXCIsICAyMjBcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5MT09LX1JFU0VULCBcImxvb2sgcmVzZXRcIiwgNjBcbiAgICBcbiAgICAgICAgQGFkZEV2ZW50V2l0aE5hbWUgXCJsYW5kZWRcIlxuICAgIFxuICAgIGJ1bGxldEhpdFNvdW5kOiAtPiAnQlVMTEVUX0hJVF9QTEFZRVInXG4gICAgICAgICAgICBcbiAgICAjICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMFxuICAgICMgICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgIyAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgIFxuICAgIGluaXRBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgICAgICMgbG9nIFwiaW5pdEFjdGlvbiAje2FjdGlvbi5pZH0gI3thY3Rpb24ubmFtZX1cIlxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5DTElNQl9ET1dOXG4gICAgICAgICAgICAgICAgIyBAYWRkTW92ZXMgMSBcbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9DTElNQidcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkZPUldBUkRcbiAgICAgICAgICAgICAgICAjIEBhZGRNb3ZlcyAxIFxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX01PVkUnXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5UVVJOX0xFRlQsIEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfVFVSTidcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkpVTVBcbiAgICAgICAgICAgICAgICAjIEBhZGRNb3ZlcyBhY3Rpb25JZCA9PSBBY3Rpb24uSlVNUCBhbmQgMSBvciAyXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfSlVNUCdcbiAgICAgICAgXG4gICAgICAgIHN1cGVyIGFjdGlvblxuICAgICAgICBcbiAgICAjICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwICAgICAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMFxuICAgICMgICAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG5cbiAgICBwZXJmb3JtQWN0aW9uOiAoYWN0aW9uKSAtPlxuICAgICAgICByZWxUaW1lID0gYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpXG4gICAgICAgIHN3aXRjaCBhY3Rpb24uaWRcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLk5PT1AgICAgICB0aGVuIHJldHVyblxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uTE9PS19VUCAgIHRoZW4gQGxvb2tfYW5nbGUgPSByZWxUaW1lICogOTAuMFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uTE9PS19ET1dOIHRoZW4gQGxvb2tfYW5nbGUgPSByZWxUaW1lICogLTkwLjBcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICBpZiBAbG9va19hbmdsZSA+IDAgdGhlbiBAbG9va19hbmdsZSA9IE1hdGgubWluIEBsb29rX2FuZ2xlLCAoMS4wLXJlbFRpbWUpICogOTAuMFxuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgIEBsb29rX2FuZ2xlID0gTWF0aC5tYXggQGxvb2tfYW5nbGUsICgxLjAtcmVsVGltZSkgKiAtOTAuMFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHN1cGVyIGFjdGlvbiBcbiAgICBcbiAgICAjICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjICAgMDAwMDAwICAgIDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICBcbiAgICBmaW5pc2hBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgXG4gICAgICAgIGlmIGFjdGlvbi5pZCA9PSBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgQGxvb2tfYWN0aW9uID0gbnVsbFxuICAgICAgICAgICAgQGxvb2tfYW5nbGUgID0gMC4wXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCA9PSBAbW92ZV9hY3Rpb24/LmlkICMgbW92ZSBmaW5pc2hlZCwgdXBkYXRlIGRpcmVjdGlvblxuICAgICAgICAgICAgICAgIEBkaXJfc2duID0gQG5ld19kaXJfc2duXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19VUCBhbmQgYWN0aW9uLmlkICE9IEFjdGlvbi5MT09LX0RPV05cbiAgICAgICAgICAgICAgICBzdXBlciBhY3Rpb25cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgYWN0aW9uLmlkID09IEFjdGlvbi5UVVJOX0xFRlQgb3IgYWN0aW9uLmlkID09IEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgaWYgQHJvdGF0ZVxuICAgICAgICAgICAgICAgICAgICBAcm90YXRlX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQHJvdGF0ZVxuICAgICAgICAgICAgICAgICAgICBAcm90YXRlX2FjdGlvbi5yZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAcm90YXRlX2FjdGlvblxuICAgIFxuICAgIGRpZTogKCkgLT5cbiAgICAgICAgICAgICAgICBcbiAgICAjICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwIFxuICAgICMgICAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICBcbiAgICAjICAgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgIFxuICAgICAgICBcbiAgICBtb2RLZXlDb21ib0V2ZW50RG93bjogKG1vZCwga2V5LCBjb21ibywgZXZlbnQpIC0+XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAjIGxvZyBcInBsYXllci5tb2RLZXlDb21ib0V2ZW50RG93biBtb2Q6I3ttb2R9IGtleToje2tleX0gY29tYm86I3tjb21ib31cIlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIGtleVxuICAgICAgICAgICAgd2hlbiBAa2V5LmZvcndhcmQsIEBrZXkuYmFja3dhcmRcbiAgICAgICAgICAgICAgICBAcHVzaCA9IG1vZCA9PSBAa2V5LnB1c2hcbiAgICAgICAgICAgICAgICBAbW92ZSA9IHRydWUgIyB0cnkgdG8gbW92ZSBhcyBsb25nIGFzIHRoZSBrZXkgaXMgbm90IHJlbGVhc2VkXG4gICAgICAgICAgICAgICAgaWYgbm90IEBtb3ZlX2FjdGlvbj9cbiAgICAgICAgICAgICAgICAgICAgQG5ld19kaXJfc2duID0gQGRpcl9zZ24gPSAoa2V5ID09IEBrZXkuYmFja3dhcmQpIGFuZCAtMSBvciAxIFxuICAgICAgICAgICAgICAgICAgICBAbW92ZUJvdCgpICMgcGVyZm9ybSBuZXcgbW92ZSBhY3Rpb24gKGRlcGVuZGluZyBvbiBlbnZpcm9ubWVudClcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uSlVNUCBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMSAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ybGQuaXNVbm9jY3VwaWVkUG9zKEBwb3NpdGlvbi5wbHVzKEBnZXRVcCgpKS5wbHVzKEBnZXREaXIoKSkpIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLmlzVW5vY2N1cGllZFBvcyhAcG9zaXRpb24ucGx1cyhAZ2V0RGlyKCkpKSAjIGZvcndhcmQgYW5kIGFib3ZlIGZvcndhcmQgYWxzbyBlbXB0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QX0ZPUldBUkRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLnRha2VPdmVyIEBtb3ZlX2FjdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAbW92ZV9hY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQG1vdmVfYWN0aW9uID0gYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbW92ZV9hY3Rpb24gICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBAbmV3X2Rpcl9zZ24gPSAoa2V5ID09IEBrZXkuYmFja3dhcmQpIGFuZCAtMSBvciAxXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkubGVmdCwgQGtleS5yaWdodFxuICAgICAgICAgICAgICAgIEByb3RhdGUgPSAoa2V5ID09IEBrZXkubGVmdCkgYW5kIEFjdGlvbi5UVVJOX0xFRlQgb3IgQWN0aW9uLlRVUk5fUklHSFRcbiAgICAgICAgICAgICAgICBpZiBub3QgQHJvdGF0ZV9hY3Rpb24/ICMgcGxheWVyIGlzIG5vdCBwZXJmb3JtaW5nIGEgcm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEByb3RhdGVfYWN0aW9uXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmp1bXBcbiAgICAgICAgICAgICAgICBAanVtcCA9IHRydWUgIyBzd2l0Y2ggdG8ganVtcCBtb2RlIHVudGlsIGp1bXBfa2V5IHJlbGVhc2VkXG4gICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IHRydWVcbiAgICAgICAgICAgICAgICBpZiBub3QgQG1vdmVfYWN0aW9uPyBcbiAgICAgICAgICAgICAgICAgICAgQG1vdmVCb3QoKSAjIHBlcmZvcm0ganVtcCBhY3Rpb24gKGRlcGVuZGluZyBvbiBlbnZpcm9ubWVudClcbiAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAjIGxvZyAnanVtcDptb3ZpbmcnXG4gICAgICAgICAgICAgICAgICAgIGlmIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uRk9SV0FSRCBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMC42IG9yIFxuICAgICAgICAgICAgICAgICAgICAgICAgQG1vdmVfYWN0aW9uLmlkID09IEFjdGlvbi5DTElNQl9ET1dOIGFuZCBAbW92ZV9hY3Rpb24uZ2V0UmVsYXRpdmVUaW1lKCkgPCAwLjRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGFib3J0IGN1cnJlbnQgbW92ZSBhbmQganVtcCBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBsb2cgJ2p1bXA6bW92ZSBvciBjbGltYiBkb3duJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdvcmxkLmlzVW5vY2N1cGllZFBvcyBAcG9zaXRpb24ucGx1cyBAZ2V0VXAoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGxvZyAnanVtcDpjYW4gZG8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdvcmxkLmlzVW5vY2N1cGllZFBvcyBAcG9zaXRpb24ucGx1cyBAZ2V0VXAoKS5wbHVzIEBnZXREaXIoKSAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QX0ZPUldBUkRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLkpVTVBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLnRha2VPdmVyIEBtb3ZlX2FjdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAbW92ZV9hY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQG1vdmVfYWN0aW9uID0gYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBqdW1wX29uY2UgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQG1vdmVfYWN0aW9uIFxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIEBtb3ZlX2FjdGlvbi5pZCBpbiBbQWN0aW9uLkpVTVAsIEFjdGlvbi5KVU1QX0ZPUldBUkRdXG4gICAgICAgICAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gZmFsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkucHVzaFxuICAgICAgICAgICAgICAgIEBwdXNoID0gdHJ1ZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5zaG9vdFxuICAgICAgICAgICAgICAgIGlmIG5vdCBAc2hvb3RcbiAgICAgICAgICAgICAgICAgICAgQHNob290ID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uU0hPT1RcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkubG9va1VwLCBAa2V5Lmxvb2tEb3duXG4gICAgICAgICAgICAgICAgaWYgbm90IEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICBAbG9va19hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIChrZXkgPT0gQGtleS5sb29rVXApIGFuZCBBY3Rpb24uTE9PS19VUCBvciBBY3Rpb24uTE9PS19ET1dOXG4gICAgICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbi5yZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkudmlld1xuICAgICAgICAgICAgICAgIHdvcmxkLmNoYW5nZUNhbWVyYU1vZGUoKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICAgICBmYWxzZVxuICAgIFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwIFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICBcbiAgICAjICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwXG4gICAgXG4gICAgbW9kS2V5Q29tYm9FdmVudFVwOiAobW9kLCBrZXksIGNvbWJvLCBldmVudCkgLT5cbiAgICAgICAgQHB1c2ggPSBmYWxzZSBpZiBAa2V5LnB1c2ggPT0gJ3NoaWZ0J1xuICAgICAgICAjIGxvZyBcInBsYXllci5tb2RLZXlDb21ib0V2ZW50VXAgbW9kOiN7bW9kfSBrZXk6I3trZXl9IGNvbWJvOiN7Y29tYm99XCJcbiAgICAgICAgc3dpdGNoIGtleSAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5zaG9vdFxuICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5TSE9PVFxuICAgICAgICAgICAgICAgIEBzaG9vdCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LmZvcndhcmQsIEBrZXkuYmFja3dhcmRcbiAgICAgICAgICAgICAgICBAbW92ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmp1bXBcbiAgICAgICAgICAgICAgICBAanVtcCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LmxlZnQsIEBrZXkucmlnaHRcbiAgICAgICAgICAgICAgICBAcm90YXRlID0gMFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5wdXNoXG4gICAgICAgICAgICAgICAgQHB1c2ggPSBmYWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5sb29rRG93biwgQGtleS5sb29rVXBcbiAgICAgICAgICAgICAgICBpZiBAbG9va19hY3Rpb24gYW5kIEBsb29rX2FjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgQGxvb2tfYWN0aW9uID0gQGdldEFjdGlvbldpdGhJZCBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAbG9va19hY3Rpb25cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkudmlldyBcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgIGZhbHNlXG4gICAgXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllclxuIl19
//# sourceURL=../coffee/player.coffee