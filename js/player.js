// koffee 1.4.0
var Action, Bot, Camera, Player, Timer, prefs, ref, valid,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), valid = ref.valid, prefs = ref.prefs;

Bot = require('./bot');

Action = require('./action');

Timer = require('./timer');

Camera = require('./camera');

Player = (function(superClass) {
    extend(Player, superClass);

    function Player() {
        var pkey;
        Player.__super__.constructor.apply(this, arguments);
        this.name = 'player';
        if (valid(pkey = prefs.get('keys', {}))) {
            this.key = pkey;
        } else {
            this.key = {
                forward: 'w',
                backward: 's',
                left: 'a',
                right: 'd',
                lookUp: 'e',
                lookDown: 'q',
                shoot: 'enter',
                jump: 'space',
                view: 'c',
                push: 'shift'
            };
            prefs.set('keys', this.key);
        }
        this.camera = new Camera(this, {
            aspect: world.view.offsetWidth / world.view.offsetHeight
        });
        this.look_action = null;
        this.look_angle = 0.0;
        this.new_dir_sgn = 1.0;
        this.rotate = 0;
        this.recorder = null;
        this.playback = null;
        this.addAction(new Action(this, Action.LOOK_UP, 'look up', 220));
        this.addAction(new Action(this, Action.LOOK_DOWN, 'look down', 220));
        this.addAction(new Action(this, Action.LOOK_RESET, 'look reset', 60));
        this.addEventWithName("landed");
    }

    Player.prototype.bulletHitSound = function() {
        return 'BULLET_HIT_PLAYER';
    };

    Player.prototype.initAction = function(action) {
        switch (action.id) {
            case Action.CLIMB_DOWN:
                world.playSound('BOT_CLIMB');
                break;
            case Action.FORWARD:
                world.playSound('BOT_MOVE');
                break;
            case Action.TURN_LEFT:
            case Action.TURN_RIGHT:
                world.playSound('BOT_TURN');
                break;
            case Action.JUMP:
                world.playSound('BOT_JUMP');
        }
        return Player.__super__.initAction.call(this, action);
    };

    Player.prototype.performAction = function(action) {
        var relTime;
        relTime = action.getRelativeTime();
        switch (action.id) {
            case Action.NOOP:
                break;
            case Action.LOOK_UP:
                return this.look_angle = relTime * 90.0;
            case Action.LOOK_DOWN:
                return this.look_angle = relTime * -90.0;
            case Action.LOOK_RESET:
                if (this.look_angle > 0) {
                    return this.look_angle = Math.min(this.look_angle, (1.0 - relTime) * 90.0);
                } else {
                    return this.look_angle = Math.max(this.look_angle, (1.0 - relTime) * -90.0);
                }
                break;
            default:
                return Player.__super__.performAction.call(this, action);
        }
    };

    Player.prototype.finishAction = function(action) {
        var ref1;
        if (action.id === Action.LOOK_RESET) {
            this.look_action = null;
            return this.look_angle = 0.0;
        } else {
            if (action.id === ((ref1 = this.move_action) != null ? ref1.id : void 0)) {
                this.dir_sgn = this.new_dir_sgn;
            }
            if (action.id !== Action.LOOK_UP && action.id !== Action.LOOK_DOWN) {
                Player.__super__.finishAction.call(this, action);
            }
            if (action.id === Action.TURN_LEFT || action.id === Action.TURN_RIGHT) {
                if (this.rotate) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    this.rotate_action.reset();
                    return Timer.addAction(this.rotate_action);
                }
            }
        }
    };

    Player.prototype.die = function() {};

    Player.prototype.modKeyComboEventDown = function(mod, key, combo, event) {
        var action, ref1;
        switch (key) {
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.push = (mod === 'ctrl' || mod === this.key.push);
                this.move = true;
                if (this.move_action == null) {
                    this.new_dir_sgn = this.dir_sgn = (key === 'down' || key === this.key.backward) && -1 || 1;
                    this.moveBot();
                } else {
                    if (this.move_action.id === Action.JUMP && this.move_action.getRelativeTime() < 1) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()).plus(this.getDir())) && world.isUnoccupiedPos(this.position.plus(this.getDir()))) {
                            action = this.getActionWithId(Action.JUMP_FORWARD);
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            Timer.addAction(this.move_action);
                        }
                    }
                    this.new_dir_sgn = (key === 'down' || key === this.key.backward) && -1 || 1;
                }
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = (key === 'left' || key === this.key.left) && Action.TURN_LEFT || Action.TURN_RIGHT;
                if (this.rotate_action == null) {
                    this.rotate_action = this.getActionWithId(this.rotate);
                    Timer.addAction(this.rotate_action);
                }
                return true;
            case this.key.jump:
                this.jump = true;
                this.jump_once = true;
                if (this.move_action == null) {
                    this.moveBot();
                    this.jump_once = false;
                } else {
                    if (this.move_action.id === Action.FORWARD && this.move_action.getRelativeTime() < 0.6 || this.move_action.id === Action.CLIMB_DOWN && this.move_action.getRelativeTime() < 0.4) {
                        if (world.isUnoccupiedPos(this.position.plus(this.getUp()))) {
                            if (world.isUnoccupiedPos(this.position.plus(this.getUp().plus(this.getDir())))) {
                                action = this.getActionWithId(Action.JUMP_FORWARD);
                                world.playSound('BOT_JUMP');
                            } else {
                                action = this.getActionWithId(Action.JUMP);
                            }
                            world.playSound('BOT_JUMP');
                            action.takeOver(this.move_action);
                            Timer.removeAction(this.move_action);
                            this.move_action = action;
                            this.jump_once = false;
                            Timer.addAction(this.move_action);
                        }
                    } else if ((ref1 = this.move_action.id) === Action.JUMP || ref1 === Action.JUMP_FORWARD) {
                        this.jump_once = false;
                    }
                }
                return true;
            case 'ctrl':
            case this.key.push:
                this.push = true;
                return true;
            case 'f':
            case this.key.shoot:
                if (!this.shoot) {
                    this.shoot = true;
                    Timer.addAction(this.getActionWithId(Action.SHOOT));
                }
                return true;
            case this.key.lookUp:
            case this.key.lookDown:
                if (!this.look_action) {
                    this.look_action = this.getActionWithId((key === this.key.lookUp) && Action.LOOK_UP || Action.LOOK_DOWN);
                    this.look_action.reset();
                    Timer.addAction(this.look_action);
                }
                return true;
            case this.key.view:
                world.changeCameraMode();
                return true;
        }
        return false;
    };

    Player.prototype.modKeyComboEventUp = function(mod, key, combo, event) {
        switch (key) {
            case 'f':
            case this.key.shoot:
                Timer.removeAction(this.getActionWithId(Action.SHOOT));
                this.shoot = false;
                return true;
            case 'up':
            case 'down':
            case this.key.forward:
            case this.key.backward:
                this.move = false;
                return true;
            case this.key.jump:
                this.jump = false;
                return true;
            case 'left':
            case 'right':
            case this.key.left:
            case this.key.right:
                this.rotate = 0;
                return true;
            case 'ctrl':
            case this.key.push:
                this.push = false;
                return true;
            case this.key.lookDown:
            case this.key.lookUp:
                if (this.look_action && this.look_action.id !== Action.LOOK_RESET) {
                    Timer.removeAction(this.look_action);
                }
                this.look_action = this.getActionWithId(Action.LOOK_RESET);
                Timer.addAction(this.look_action);
                return true;
            case this.key.view:
                return true;
        }
        return false;
    };

    return Player;

})(Bot);

module.exports = Player;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQSxxREFBQTtJQUFBOzs7QUFBQSxNQUFtQixPQUFBLENBQVEsS0FBUixDQUFuQixFQUFFLGlCQUFGLEVBQVM7O0FBRVQsR0FBQSxHQUFTLE9BQUEsQ0FBUSxPQUFSOztBQUNULE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjs7QUFDVCxLQUFBLEdBQVMsT0FBQSxDQUFRLFNBQVI7O0FBQ1QsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSOztBQUVIOzs7SUFFQyxnQkFBQTtBQUVDLFlBQUE7UUFBQSx5Q0FBQSxTQUFBO1FBQ0EsSUFBQyxDQUFBLElBQUQsR0FBUTtRQUVSLElBQUcsS0FBQSxDQUFNLElBQUEsR0FBTyxLQUFLLENBQUMsR0FBTixDQUFVLE1BQVYsRUFBaUIsRUFBakIsQ0FBYixDQUFIO1lBQ0ksSUFBQyxDQUFBLEdBQUQsR0FBTyxLQURYO1NBQUEsTUFBQTtZQUdJLElBQUMsQ0FBQSxHQUFELEdBQ0k7Z0JBQUEsT0FBQSxFQUFVLEdBQVY7Z0JBQ0EsUUFBQSxFQUFVLEdBRFY7Z0JBRUEsSUFBQSxFQUFVLEdBRlY7Z0JBR0EsS0FBQSxFQUFVLEdBSFY7Z0JBSUEsTUFBQSxFQUFVLEdBSlY7Z0JBS0EsUUFBQSxFQUFVLEdBTFY7Z0JBTUEsS0FBQSxFQUFVLE9BTlY7Z0JBT0EsSUFBQSxFQUFVLE9BUFY7Z0JBUUEsSUFBQSxFQUFVLEdBUlY7Z0JBU0EsSUFBQSxFQUFVLE9BVFY7O1lBVUosS0FBSyxDQUFDLEdBQU4sQ0FBVSxNQUFWLEVBQWlCLElBQUMsQ0FBQSxHQUFsQixFQWRKOztRQWdCQSxJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksTUFBSixDQUFXLElBQVgsRUFBYztZQUFBLE1BQUEsRUFBUSxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVgsR0FBeUIsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUE1QztTQUFkO1FBRVYsSUFB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QkFtQlEsSUFBQyxDQUFBLElBQUQsR0FBUTtBQUNSLHVCQUFPO0FBcEJmLGlCQXNCUyxJQUFDLENBQUEsR0FBRyxDQUFDLFFBdEJkO0FBQUEsaUJBc0J3QixJQUFDLENBQUEsR0FBRyxDQUFDLE1BdEI3QjtnQkF1QlEsSUFBRyxJQUFDLENBQUEsV0FBRCxJQUFpQixJQUFDLENBQUEsV0FBVyxDQUFDLEVBQWIsS0FBbUIsTUFBTSxDQUFDLFVBQTlDO29CQUNJLEtBQUssQ0FBQyxZQUFOLENBQW1CLElBQUMsQ0FBQSxXQUFwQixFQURKOztnQkFFQSxJQUFDLENBQUEsV0FBRCxHQUFlLElBQUMsQ0FBQSxlQUFELENBQWlCLE1BQU0sQ0FBQyxVQUF4QjtnQkFDZixLQUFLLENBQUMsU0FBTixDQUFnQixJQUFDLENBQUEsV0FBakI7QUFDQSx1QkFBTztBQTNCZixpQkE2QlMsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQTdCZDtBQThCUSx1QkFBTztBQTlCZjtlQWdDQTtJQW5DZ0I7Ozs7R0EzTUg7O0FBZ1ByQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIlxuIyAgIDAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCBcbiMgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwXG4jICAgMDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwMDAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIFxuIyAgIDAwMCAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbiMgICAwMDAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwXG5cbnsgdmFsaWQsIHByZWZzIH0gPSByZXF1aXJlICdreGsnXG5cbkJvdCAgICA9IHJlcXVpcmUgJy4vYm90J1xuQWN0aW9uID0gcmVxdWlyZSAnLi9hY3Rpb24nXG5UaW1lciAgPSByZXF1aXJlICcuL3RpbWVyJ1xuQ2FtZXJhID0gcmVxdWlyZSAnLi9jYW1lcmEnXG4gXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBCb3RcbiAgICBcbiAgICBAOiAtPlxuICAgICAgICBcbiAgICAgICAgc3VwZXJcbiAgICAgICAgQG5hbWUgPSAncGxheWVyJ1xuICAgICAgICBcbiAgICAgICAgaWYgdmFsaWQgcGtleSA9IHByZWZzLmdldCAna2V5cycge31cbiAgICAgICAgICAgIEBrZXkgPSBwa2V5XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBrZXkgPVxuICAgICAgICAgICAgICAgIGZvcndhcmQ6ICAndydcbiAgICAgICAgICAgICAgICBiYWNrd2FyZDogJ3MnXG4gICAgICAgICAgICAgICAgbGVmdDogICAgICdhJ1xuICAgICAgICAgICAgICAgIHJpZ2h0OiAgICAnZCdcbiAgICAgICAgICAgICAgICBsb29rVXA6ICAgJ2UnXG4gICAgICAgICAgICAgICAgbG9va0Rvd246ICdxJ1xuICAgICAgICAgICAgICAgIHNob290OiAgICAnZW50ZXInXG4gICAgICAgICAgICAgICAganVtcDogICAgICdzcGFjZSdcbiAgICAgICAgICAgICAgICB2aWV3OiAgICAgJ2MnXG4gICAgICAgICAgICAgICAgcHVzaDogICAgICdzaGlmdCdcbiAgICAgICAgICAgIHByZWZzLnNldCAna2V5cycgQGtleVxuXG4gICAgICAgIEBjYW1lcmEgPSBuZXcgQ2FtZXJhIEAsIGFzcGVjdDogd29ybGQudmlldy5vZmZzZXRXaWR0aCAvIHdvcmxkLnZpZXcub2Zmc2V0SGVpZ2h0XG5cbiAgICAgICAgQGxvb2tfYWN0aW9uID0gbnVsbFxuICAgICAgICBAbG9va19hbmdsZSAgPSAwLjBcbiAgICAgICAgQG5ld19kaXJfc2duID0gMS4wXG4gICAgICAgIEByb3RhdGUgICAgICA9IDBcbiAgICAgICAgXG4gICAgICAgIEByZWNvcmRlciAgICA9IG51bGxcbiAgICAgICAgQHBsYXliYWNrICAgID0gbnVsbFxuICAgICAgICBcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5MT09LX1VQLCAgICAnbG9vayB1cCcgICAgMjIwXG4gICAgICAgIEBhZGRBY3Rpb24gbmV3IEFjdGlvbiBALCBBY3Rpb24uTE9PS19ET1dOLCAgJ2xvb2sgZG93bicgIDIyMFxuICAgICAgICBAYWRkQWN0aW9uIG5ldyBBY3Rpb24gQCwgQWN0aW9uLkxPT0tfUkVTRVQsICdsb29rIHJlc2V0JyA2MFxuICAgIFxuICAgICAgICBAYWRkRXZlbnRXaXRoTmFtZSBcImxhbmRlZFwiXG4gICAgXG4gICAgYnVsbGV0SGl0U291bmQ6IC0+ICdCVUxMRVRfSElUX1BMQVlFUidcbiAgICAgICAgICAgIFxuICAgICMgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4gICAgIyAgIDAwMDAwMDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDBcbiAgICAjICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgXG4gICAgaW5pdEFjdGlvbjogKGFjdGlvbikgLT5cbiAgICAgICAgIyBrbG9nIFwiaW5pdEFjdGlvbiAje2FjdGlvbi5pZH0gI3thY3Rpb24ubmFtZX1cIlxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5DTElNQl9ET1dOXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfQ0xJTUInXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5GT1JXQVJEXG4gICAgICAgICAgICAgICAgd29ybGQucGxheVNvdW5kICdCT1RfTU9WRSdcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLlRVUk5fTEVGVCwgQWN0aW9uLlRVUk5fUklHSFRcbiAgICAgICAgICAgICAgICB3b3JsZC5wbGF5U291bmQgJ0JPVF9UVVJOJ1xuICAgICAgICAgICAgd2hlbiBBY3Rpb24uSlVNUFxuICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgIFxuICAgICAgICBzdXBlciBhY3Rpb25cbiAgICAgICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMCAgICAgMDBcbiAgICAjICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAwXG4gICAgIyAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgcGVyZm9ybUFjdGlvbjogKGFjdGlvbikgLT5cbiAgICAgICAgXG4gICAgICAgIHJlbFRpbWUgPSBhY3Rpb24uZ2V0UmVsYXRpdmVUaW1lKClcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBhY3Rpb24uaWRcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLk5PT1AgICAgICB0aGVuIHJldHVyblxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uTE9PS19VUCAgIHRoZW4gQGxvb2tfYW5nbGUgPSByZWxUaW1lICogOTAuMFxuICAgICAgICAgICAgd2hlbiBBY3Rpb24uTE9PS19ET1dOIHRoZW4gQGxvb2tfYW5nbGUgPSByZWxUaW1lICogLTkwLjBcbiAgICAgICAgICAgIHdoZW4gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICBpZiBAbG9va19hbmdsZSA+IDAgdGhlbiBAbG9va19hbmdsZSA9IE1hdGgubWluIEBsb29rX2FuZ2xlLCAoMS4wLXJlbFRpbWUpICogOTAuMFxuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgIEBsb29rX2FuZ2xlID0gTWF0aC5tYXggQGxvb2tfYW5nbGUsICgxLjAtcmVsVGltZSkgKiAtOTAuMFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHN1cGVyIGFjdGlvbiBcbiAgICBcbiAgICAjICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjICAgMDAwMDAwICAgIDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAwMDAgICAwMDBcbiAgICAjICAgMDAwICAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICBcbiAgICBmaW5pc2hBY3Rpb246IChhY3Rpb24pIC0+XG4gICAgXG4gICAgICAgIGlmIGFjdGlvbi5pZCA9PSBBY3Rpb24uTE9PS19SRVNFVFxuICAgICAgICAgICAgQGxvb2tfYWN0aW9uID0gbnVsbFxuICAgICAgICAgICAgQGxvb2tfYW5nbGUgID0gMC4wXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCA9PSBAbW92ZV9hY3Rpb24/LmlkICMgbW92ZSBmaW5pc2hlZCwgdXBkYXRlIGRpcmVjdGlvblxuICAgICAgICAgICAgICAgIEBkaXJfc2duID0gQG5ld19kaXJfc2duXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGFjdGlvbi5pZCAhPSBBY3Rpb24uTE9PS19VUCBhbmQgYWN0aW9uLmlkICE9IEFjdGlvbi5MT09LX0RPV05cbiAgICAgICAgICAgICAgICBzdXBlciBhY3Rpb25cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgYWN0aW9uLmlkID09IEFjdGlvbi5UVVJOX0xFRlQgb3IgYWN0aW9uLmlkID09IEFjdGlvbi5UVVJOX1JJR0hUXG4gICAgICAgICAgICAgICAgaWYgQHJvdGF0ZVxuICAgICAgICAgICAgICAgICAgICBAcm90YXRlX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQHJvdGF0ZVxuICAgICAgICAgICAgICAgICAgICBAcm90YXRlX2FjdGlvbi5yZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAcm90YXRlX2FjdGlvblxuICAgIFxuICAgIGRpZTogLT5cbiAgICAgICAgICAgICAgICBcbiAgICAjICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwIFxuICAgICMgICAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICBcbiAgICAjICAgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgIFxuICAgICAgICBcbiAgICBtb2RLZXlDb21ib0V2ZW50RG93bjogKG1vZCwga2V5LCBjb21ibywgZXZlbnQpIC0+XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAjIGtsb2cgXCJwbGF5ZXIubW9kS2V5Q29tYm9FdmVudERvd24gbW9kOiN7bW9kfSBrZXk6I3trZXl9IGNvbWJvOiN7Y29tYm99XCJcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBrZXlcbiAgICAgICAgICAgIHdoZW4gJ3VwJyAnZG93bicgQGtleS5mb3J3YXJkLCBAa2V5LmJhY2t3YXJkXG4gICAgICAgICAgICAgICAgQHB1c2ggPSAobW9kIGluIFsnY3RybCcgQGtleS5wdXNoXSlcbiAgICAgICAgICAgICAgICBAbW92ZSA9IHRydWUgIyB0cnkgdG8gbW92ZSBhcyBsb25nIGFzIHRoZSBrZXkgaXMgbm90IHJlbGVhc2VkXG4gICAgICAgICAgICAgICAgaWYgbm90IEBtb3ZlX2FjdGlvbj9cbiAgICAgICAgICAgICAgICAgICAgQG5ld19kaXJfc2duID0gQGRpcl9zZ24gPSAoa2V5IGluIFsnZG93bicgQGtleS5iYWNrd2FyZF0pIGFuZCAtMSBvciAxIFxuICAgICAgICAgICAgICAgICAgICBAbW92ZUJvdCgpICMgcGVyZm9ybSBuZXcgbW92ZSBhY3Rpb24gKGRlcGVuZGluZyBvbiBlbnZpcm9ubWVudClcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uSlVNUCBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMSAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ybGQuaXNVbm9jY3VwaWVkUG9zKEBwb3NpdGlvbi5wbHVzKEBnZXRVcCgpKS5wbHVzKEBnZXREaXIoKSkpIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLmlzVW5vY2N1cGllZFBvcyhAcG9zaXRpb24ucGx1cyhAZ2V0RGlyKCkpKSAjIGZvcndhcmQgYW5kIGFib3ZlIGZvcndhcmQgYWxzbyBlbXB0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QX0ZPUldBUkRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB3b3JsZC5wbGF5U291bmQgJ0JPVF9KVU1QJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24udGFrZU92ZXIgQG1vdmVfYWN0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAbW92ZV9hY3Rpb24gPSBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICBAbmV3X2Rpcl9zZ24gPSAoa2V5IGluIFsnZG93bicgQGtleS5iYWNrd2FyZF0pIGFuZCAtMSBvciAxXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdsZWZ0JyAncmlnaHQnIEBrZXkubGVmdCwgQGtleS5yaWdodFxuICAgICAgICAgICAgICAgIEByb3RhdGUgPSAoa2V5IGluIFsnbGVmdCcgQGtleS5sZWZ0XSkgYW5kIEFjdGlvbi5UVVJOX0xFRlQgb3IgQWN0aW9uLlRVUk5fUklHSFRcbiAgICAgICAgICAgICAgICBpZiBub3QgQHJvdGF0ZV9hY3Rpb24/ICMgcGxheWVyIGlzIG5vdCBwZXJmb3JtaW5nIGEgcm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgQHJvdGF0ZV9hY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEByb3RhdGVcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEByb3RhdGVfYWN0aW9uXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmp1bXBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBAanVtcCA9IHRydWUgIyBzd2l0Y2ggdG8ganVtcCBtb2RlIHVudGlsIGp1bXBfa2V5IHJlbGVhc2VkXG4gICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IHRydWVcbiAgICAgICAgICAgICAgICBpZiBub3QgQG1vdmVfYWN0aW9uPyBcbiAgICAgICAgICAgICAgICAgICAgQG1vdmVCb3QoKSAjIHBlcmZvcm0ganVtcCBhY3Rpb24gKGRlcGVuZGluZyBvbiBlbnZpcm9ubWVudClcbiAgICAgICAgICAgICAgICAgICAgQGp1bXBfb25jZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAjIGtsb2cgJ2p1bXA6bW92aW5nJ1xuICAgICAgICAgICAgICAgICAgICBpZiBAbW92ZV9hY3Rpb24uaWQgPT0gQWN0aW9uLkZPUldBUkQgYW5kIEBtb3ZlX2FjdGlvbi5nZXRSZWxhdGl2ZVRpbWUoKSA8IDAuNiBvciBcbiAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbi5pZCA9PSBBY3Rpb24uQ0xJTUJfRE9XTiBhbmQgQG1vdmVfYWN0aW9uLmdldFJlbGF0aXZlVGltZSgpIDwgMC40XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBhYm9ydCBjdXJyZW50IG1vdmUgYW5kIGp1bXAgaW5zdGVhZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICMga2xvZyAnanVtcDptb3ZlIG9yIGNsaW1iIGRvd24nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ybGQuaXNVbm9jY3VwaWVkUG9zIEBwb3NpdGlvbi5wbHVzIEBnZXRVcCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMga2xvZyAnanVtcDpjYW4gZG8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdvcmxkLmlzVW5vY2N1cGllZFBvcyBAcG9zaXRpb24ucGx1cyBAZ2V0VXAoKS5wbHVzIEBnZXREaXIoKSAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QX0ZPUldBUkRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5KVU1QXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLnBsYXlTb3VuZCAnQk9UX0pVTVAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi50YWtlT3ZlciBAbW92ZV9hY3Rpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lci5yZW1vdmVBY3Rpb24gQG1vdmVfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBtb3ZlX2FjdGlvbiA9IGFjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBtb3ZlX2FjdGlvblxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIEBtb3ZlX2FjdGlvbi5pZCBpbiBbQWN0aW9uLkpVTVAsIEFjdGlvbi5KVU1QX0ZPUldBUkRdXG4gICAgICAgICAgICAgICAgICAgICAgICBAanVtcF9vbmNlID0gZmFsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdjdHJsJyBAa2V5LnB1c2hcbiAgICAgICAgICAgICAgICBAcHVzaCA9IHRydWVcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdmJyBAa2V5LnNob290XG4gICAgICAgICAgICAgICAgaWYgbm90IEBzaG9vdFxuICAgICAgICAgICAgICAgICAgICBAc2hvb3QgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIFRpbWVyLmFkZEFjdGlvbiBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5TSE9PVFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS5sb29rVXAsIEBrZXkubG9va0Rvd25cbiAgICAgICAgICAgICAgICBpZiBub3QgQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgKGtleSA9PSBAa2V5Lmxvb2tVcCkgYW5kIEFjdGlvbi5MT09LX1VQIG9yIEFjdGlvbi5MT09LX0RPV05cbiAgICAgICAgICAgICAgICAgICAgQGxvb2tfYWN0aW9uLnJlc2V0KClcbiAgICAgICAgICAgICAgICAgICAgVGltZXIuYWRkQWN0aW9uIEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gQGtleS52aWV3XG4gICAgICAgICAgICAgICAgd29ybGQuY2hhbmdlQ2FtZXJhTW9kZSgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgIGZhbHNlXG4gICAgXG4gICAgIyAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMFxuICAgICMgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICBcbiAgICAjICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgXG4gICAgIyAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgIFxuICAgICMgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDBcbiAgICBcbiAgICBtb2RLZXlDb21ib0V2ZW50VXA6IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPlxuICAgICAgICAjIEBwdXNoID0gZmFsc2UgaWYgQGtleS5wdXNoID09ICdzaGlmdCdcbiAgICAgICAgIyBrbG9nIFwicGxheWVyLm1vZEtleUNvbWJvRXZlbnRVcCBtb2Q6I3ttb2R9IGtleToje2tleX0gY29tYm86I3tjb21ib31cIlxuICAgICAgICBzd2l0Y2gga2V5ICAgIFxuICAgICAgICAgICAgd2hlbiAnZicgQGtleS5zaG9vdFxuICAgICAgICAgICAgICAgIFRpbWVyLnJlbW92ZUFjdGlvbiBAZ2V0QWN0aW9uV2l0aElkIEFjdGlvbi5TSE9PVFxuICAgICAgICAgICAgICAgIEBzaG9vdCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAndXAnICdkb3duJyBAa2V5LmZvcndhcmQsIEBrZXkuYmFja3dhcmRcbiAgICAgICAgICAgICAgICBAbW92ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5Lmp1bXBcbiAgICAgICAgICAgICAgICBAanVtcCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnbGVmdCcgJ3JpZ2h0JyBAa2V5LmxlZnQsIEBrZXkucmlnaHRcbiAgICAgICAgICAgICAgICBAcm90YXRlID0gMFxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gJ2N0cmwnIEBrZXkucHVzaFxuICAgICAgICAgICAgICAgIEBwdXNoID0gZmFsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuIEBrZXkubG9va0Rvd24sIEBrZXkubG9va1VwXG4gICAgICAgICAgICAgICAgaWYgQGxvb2tfYWN0aW9uIGFuZCBAbG9va19hY3Rpb24uaWQgIT0gQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICAgICAgVGltZXIucmVtb3ZlQWN0aW9uIEBsb29rX2FjdGlvblxuICAgICAgICAgICAgICAgIEBsb29rX2FjdGlvbiA9IEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLkxPT0tfUkVTRVRcbiAgICAgICAgICAgICAgICBUaW1lci5hZGRBY3Rpb24gQGxvb2tfYWN0aW9uXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiBAa2V5LnZpZXcgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICBmYWxzZVxuICAgIFxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJcbiJdfQ==
//# sourceURL=../coffee/player.coffee