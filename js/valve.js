// koffee 1.4.0
var Action, Face, Pushable, Quaternion, Valve, log,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

log = require('./tools/log');

Quaternion = require('./lib/quaternion');

Pushable = require('./pushable');

Action = require('./action');

Face = require('./face');

Valve = (function(superClass) {
    extend(Valve, superClass);

    function Valve(face) {
        this.face = face;
        Valve.__super__.constructor.apply(this, arguments);
        this.angle = 0.0;
        this.active = false;
        this.clockwise = false;
        this.addAction(new Action(this, Action.ROTATE, "rotation", 2000, Action.REPEAT));
    }

    Valve.prototype.updateMesh = function() {
        var rot;
        rot = Quaternion.rotationAroundVector((this.clockwise && 1 || -1) * this.angle, 0, 0, 1);
        return this.mesh.quaternion.copy(Face.orientationForFace(this.face).mul(rot));
    };

    Valve.prototype.setPosition = function(pos) {
        var dir, p, sum;
        Valve.__super__.setPosition.call(this, pos);
        p = this.getPos();
        dir = this.face % 3;
        sum = ((dir === Face.Y || dir === Face.Z) && p.x || 0) + ((dir === Face.X || dir === Face.Z) && p.y || 0) + ((dir === Face.X || dir === Face.Y) && p.z || 0);
        return this.clockwise = sum % 2;
    };

    Valve.prototype.performAction = function(action) {
        switch (action.id) {
            case Action.ROTATE:
                this.angle += action.getRelativeDelta() * 360;
                return this.updateMesh();
            default:
                return Valve.__super__.performAction.call(this, action);
        }
    };

    return Valve;

})(Pushable);

module.exports = Valve;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdmUuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFNQSxJQUFBLDhDQUFBO0lBQUE7OztBQUFBLEdBQUEsR0FBYSxPQUFBLENBQVEsYUFBUjs7QUFDYixVQUFBLEdBQWEsT0FBQSxDQUFRLGtCQUFSOztBQUNiLFFBQUEsR0FBYSxPQUFBLENBQVEsWUFBUjs7QUFDYixNQUFBLEdBQWEsT0FBQSxDQUFRLFVBQVI7O0FBQ2IsSUFBQSxHQUFhLE9BQUEsQ0FBUSxRQUFSOztBQUVQOzs7SUFFVyxlQUFDLElBQUQ7UUFBQyxJQUFDLENBQUEsT0FBRDtRQUNWLHdDQUFBLFNBQUE7UUFDQSxJQUFDLENBQUEsS0FBRCxHQUFhO1FBQ2IsSUFBQyxDQUFBLE1BQUQsR0FBYTtRQUNiLElBQUMsQ0FBQSxTQUFELEdBQWE7UUFDYixJQUFDLENBQUEsU0FBRCxDQUFXLElBQUksTUFBSixDQUFXLElBQVgsRUFBYyxNQUFNLENBQUMsTUFBckIsRUFBNkIsVUFBN0IsRUFBeUMsSUFBekMsRUFBK0MsTUFBTSxDQUFDLE1BQXRELENBQVg7SUFMUzs7b0JBUWIsVUFBQSxHQUFZLFNBQUE7QUFFUixZQUFBO1FBQUEsR0FBQSxHQUFNLFVBQVUsQ0FBQyxvQkFBWCxDQUFnQyxDQUFDLElBQUMsQ0FBQSxTQUFELElBQWUsQ0FBZixJQUFvQixDQUFDLENBQXRCLENBQUEsR0FBMkIsSUFBQyxDQUFBLEtBQTVELEVBQW1FLENBQW5FLEVBQXFFLENBQXJFLEVBQXVFLENBQXZFO2VBQ04sSUFBQyxDQUFBLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBakIsQ0FBc0IsSUFBSSxDQUFDLGtCQUFMLENBQXdCLElBQUMsQ0FBQSxJQUF6QixDQUE4QixDQUFDLEdBQS9CLENBQW1DLEdBQW5DLENBQXRCO0lBSFE7O29CQUtaLFdBQUEsR0FBYSxTQUFDLEdBQUQ7QUFDVCxZQUFBO1FBQUEsdUNBQU0sR0FBTjtRQUNBLENBQUEsR0FBSSxJQUFDLENBQUEsTUFBRCxDQUFBO1FBQ0osR0FBQSxHQUFNLElBQUMsQ0FBQSxJQUFELEdBQVE7UUFDZCxHQUFBLEdBQU0sQ0FBQyxDQUFDLEdBQUEsS0FBTyxJQUFJLENBQUMsQ0FBWixJQUFpQixHQUFBLEtBQU8sSUFBSSxDQUFDLENBQTlCLENBQUEsSUFBcUMsQ0FBQyxDQUFDLENBQXZDLElBQTRDLENBQTdDLENBQUEsR0FBa0QsQ0FBQyxDQUFDLEdBQUEsS0FBTyxJQUFJLENBQUMsQ0FBWixJQUFpQixHQUFBLEtBQU8sSUFBSSxDQUFDLENBQTlCLENBQUEsSUFBcUMsQ0FBQyxDQUFDLENBQXZDLElBQTRDLENBQTdDLENBQWxELEdBQW9HLENBQUMsQ0FBQyxHQUFBLEtBQU8sSUFBSSxDQUFDLENBQVosSUFBaUIsR0FBQSxLQUFPLElBQUksQ0FBQyxDQUE5QixDQUFBLElBQXFDLENBQUMsQ0FBQyxDQUF2QyxJQUE0QyxDQUE3QztlQUMxRyxJQUFDLENBQUEsU0FBRCxHQUFhLEdBQUEsR0FBTTtJQUxWOztvQkFRYixhQUFBLEdBQWUsU0FBQyxNQUFEO0FBQ1gsZ0JBQU8sTUFBTSxDQUFDLEVBQWQ7QUFBQSxpQkFDUyxNQUFNLENBQUMsTUFEaEI7Z0JBRVEsSUFBQyxDQUFBLEtBQUQsSUFBVSxNQUFNLENBQUMsZ0JBQVAsQ0FBQSxDQUFBLEdBQTRCO3VCQUN0QyxJQUFDLENBQUEsVUFBRCxDQUFBO0FBSFI7dUJBSVMseUNBQU0sTUFBTjtBQUpUO0lBRFc7Ozs7R0F2QkM7O0FBOEJwQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgICBcbiMgIDAwMCAwMDAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAgMDAwICAgMDAwMDAwMCBcbiMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwICAgICBcbiMgICAgIDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgICAwICAgICAgMDAwMDAwMDBcblxubG9nICAgICAgICA9IHJlcXVpcmUgJy4vdG9vbHMvbG9nJ1xuUXVhdGVybmlvbiA9IHJlcXVpcmUgJy4vbGliL3F1YXRlcm5pb24nXG5QdXNoYWJsZSAgID0gcmVxdWlyZSAnLi9wdXNoYWJsZSdcbkFjdGlvbiAgICAgPSByZXF1aXJlICcuL2FjdGlvbidcbkZhY2UgICAgICAgPSByZXF1aXJlICcuL2ZhY2UnXG5cbmNsYXNzIFZhbHZlIGV4dGVuZHMgUHVzaGFibGVcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKEBmYWNlKSAtPlxuICAgICAgICBzdXBlclxuICAgICAgICBAYW5nbGUgICAgID0gMC4wXG4gICAgICAgIEBhY3RpdmUgICAgPSBmYWxzZVxuICAgICAgICBAY2xvY2t3aXNlID0gZmFsc2VcbiAgICAgICAgQGFkZEFjdGlvbiBuZXcgQWN0aW9uIEAsIEFjdGlvbi5ST1RBVEUsIFwicm90YXRpb25cIiwgMjAwMCwgQWN0aW9uLlJFUEVBVFxuICAgICAgICAjIEBzdGFydFRpbWVkQWN0aW9uIEBnZXRBY3Rpb25XaXRoSWQgQWN0aW9uLlJPVEFURVxuICAgIFxuICAgIHVwZGF0ZU1lc2g6IC0+XG4gICAgICAgICMgbG9nIFwiVmFsdmUudXBkYXRlTWVzaCAje0BhbmdsZX0gI3tAZmFjZX1cIlxuICAgICAgICByb3QgPSBRdWF0ZXJuaW9uLnJvdGF0aW9uQXJvdW5kVmVjdG9yIChAY2xvY2t3aXNlIGFuZCAxIG9yIC0xKSAqIEBhbmdsZSwgMCwwLDFcbiAgICAgICAgQG1lc2gucXVhdGVybmlvbi5jb3B5IEZhY2Uub3JpZW50YXRpb25Gb3JGYWNlKEBmYWNlKS5tdWwgcm90XG4gICAgICAgIFxuICAgIHNldFBvc2l0aW9uOiAocG9zKSAtPlxuICAgICAgICBzdXBlciBwb3NcbiAgICAgICAgcCA9IEBnZXRQb3MoKVxuICAgICAgICBkaXIgPSBAZmFjZSAlIDNcbiAgICAgICAgc3VtID0gKChkaXIgPT0gRmFjZS5ZIG9yIGRpciA9PSBGYWNlLlopIGFuZCBwLnggb3IgMCkgKyAoKGRpciA9PSBGYWNlLlggb3IgZGlyID09IEZhY2UuWikgYW5kIHAueSBvciAwKSArICgoZGlyID09IEZhY2UuWCBvciBkaXIgPT0gRmFjZS5ZKSBhbmQgcC56IG9yIDApXG4gICAgICAgIEBjbG9ja3dpc2UgPSBzdW0gJSAyXG4gICAgICAgICMgbG9nIFwiVmFsdmUuc2V0UG9zaXRpb24gc3VtICN7c3VtfSBAY2xvY2t3aXNlICN7QGNsb2Nrd2lzZX1cIiwgcG9zXG4gICAgICAgICAgICAgICBcbiAgICBwZXJmb3JtQWN0aW9uOiAoYWN0aW9uKSAtPlxuICAgICAgICBzd2l0Y2ggYWN0aW9uLmlkXG4gICAgICAgICAgICB3aGVuIEFjdGlvbi5ST1RBVEUgXG4gICAgICAgICAgICAgICAgQGFuZ2xlICs9IGFjdGlvbi5nZXRSZWxhdGl2ZURlbHRhKCkgKiAzNjBcbiAgICAgICAgICAgICAgICBAdXBkYXRlTWVzaCgpXG4gICAgICAgICAgICBlbHNlIHN1cGVyIGFjdGlvblxuICAgIFxubW9kdWxlLmV4cG9ydHMgPSBWYWx2ZVxuIl19
//# sourceURL=../coffee/valve.coffee