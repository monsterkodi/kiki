// koffee 1.4.0
var Face, Gate, Geom, Item, Material, Vector, Wire,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

Item = require('./item');

Geom = require('./geom');

Face = require('./face');

Gate = require('./gate');

Vector = require('./lib/vector');

Material = require('./material');

Wire = (function(superClass) {
    extend(Wire, superClass);

    Wire.UP = 1;

    Wire.RIGHT = 2;

    Wire.DOWN = 4;

    Wire.LEFT = 8;

    Wire.VERTICAL = 5;

    Wire.HORIZONTAL = 10;

    Wire.ALL = 15;

    function Wire(face, connections) {
        this.face = face != null ? face : Face.Z;
        this.connections = connections != null ? connections : Wire.ALL;
        this.glow = null;
        this.active = false;
        this.value = 1.0;
        Wire.__super__.constructor.apply(this, arguments);
        this.SWITCH_OFF_EVENT = this.addEventWithName("off");
        this.SWITCH_ON_EVENT = this.addEventWithName("on");
        this.SWITCHED_EVENT = this.addEventWithName("switched");
    }

    Wire.prototype.createMesh = function() {
        var geom, h, o, plane, s, w;
        o = 0.005;
        geom = new THREE.Geometry;
        h = 0.1;
        s = 0.5;
        w = s + o;
        if (this.connections & Wire.RIGHT) {
            plane = new THREE.PlaneGeometry(w, h);
            plane.translate(w / 2, 0, -s + o);
            geom.merge(plane);
        }
        if (this.connections & Wire.LEFT) {
            plane = new THREE.PlaneGeometry(w, h);
            plane.translate(-w / 2, 0, -s + o);
            geom.merge(plane);
        }
        if (this.connections & Wire.UP) {
            plane = new THREE.PlaneGeometry(h, w);
            plane.translate(0, w / 2, -s + o);
            geom.merge(plane);
        }
        if (this.connections & Wire.DOWN) {
            plane = new THREE.PlaneGeometry(h, w);
            plane.translate(0, -w / 2, -s + o);
            geom.merge(plane);
        }
        this.wire = new THREE.Mesh(geom, Material.wire);
        this.mesh = new THREE.Mesh(Geom.wire(), Material.wirePlate);
        this.mesh.add(this.wire);
        this.mesh.receiveShadow = true;
        this.mesh.position.copy(Face.normal(this.face).mul(-(0.5 + o)));
        return this.mesh.quaternion.copy(Face.orientation(this.face));
    };

    Wire.prototype.updateActive = function() {
        var j, len, ref, results, wire;
        ref = this.neighborWires();
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
            wire = ref[j];
            if (wire.active) {
                results.push(this.setActive(true));
            } else {
                results.push(void 0);
            }
        }
        return results;
    };

    Wire.prototype.setActive = function(active) {
        var gate, j, len, neighbors, wire;
        if (this.active !== active) {
            this.active = active;
            neighbors = this.neighborWires();
            for (j = 0, len = neighbors.length; j < len; j++) {
                wire = neighbors[j];
                wire.setActive(this.active);
            }
            gate = world.getObjectOfTypeAtPos(Gate, this.getPos());
            if (gate != null) {
                gate.setActive(this.active);
            }
            if (this.active) {
                if (this.glow == null) {
                    this.glow = new THREE.Sprite(Material.glow);
                    this.glow.position.set(0, 0, -0.3);
                    this.glow.scale.set(.5, .5, 1);
                    this.glow.renderOrder = 999;
                    this.mesh.add(this.glow);
                }
            } else if (this.glow != null) {
                this.mesh.remove(this.glow);
                this.glow = null;
            }
            this.events[this.active && this.SWITCH_ON_EVENT || this.SWITCH_OFF_EVENT].triggerActions();
            return this.events[this.SWITCHED_EVENT].triggerActions();
        }
    };

    Wire.prototype.neighborWires = function() {
        var i, iter, j, k, l, len, len1, len2, m, n, neighbor_dirs, neighbor_point, neighbor_points, neighbors, point, points, ref, rot, wires;
        wires = [];
        points = this.connectionPoints();
        neighbor_dirs = [];
        rot = Face.orientationForFace(this.face);
        n = Face.normalVectorForFace(this.face);
        neighbor_dirs.push(new Vector(0, 0, 0));
        if (this.connections & Wire.RIGHT) {
            neighbor_dirs.push(rot.rotate(new Vector(1, 0, 0)));
            neighbor_dirs.push(rot.rotate(new Vector(1, 0, 0)).minus(n));
        }
        if (this.connections & Wire.LEFT) {
            neighbor_dirs.push(rot.rotate(new Vector(-1, 0, 0)));
            neighbor_dirs.push(rot.rotate(new Vector(-1, 0, 0)).minus(n));
        }
        if (this.connections & Wire.UP) {
            neighbor_dirs.push(rot.rotate(new Vector(0, 1, 0)));
            neighbor_dirs.push(rot.rotate(new Vector(0, 1, 0)).minus(n));
        }
        if (this.connections & Wire.DOWN) {
            neighbor_dirs.push(rot.rotate(new Vector(0, -1, 0)));
            neighbor_dirs.push(rot.rotate(new Vector(0, -1, 0)).minus(n));
        }
        for (i = j = 0, ref = neighbor_dirs.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
            neighbors = world.getObjectsOfTypeAtPos(Wire, this.position.plus(neighbor_dirs[i]));
            for (k = 0, len = neighbors.length; k < len; k++) {
                iter = neighbors[k];
                if (iter === this) {
                    continue;
                }
                neighbor_points = iter.connectionPoints();
                for (l = 0, len1 = points.length; l < len1; l++) {
                    point = points[l];
                    for (m = 0, len2 = neighbor_points.length; m < len2; m++) {
                        neighbor_point = neighbor_points[m];
                        if (neighbor_point.minus(point).length() < 0.1) {
                            wires.push(iter);
                        }
                    }
                }
            }
        }
        return wires;
    };

    Wire.prototype.connectionPoints = function() {
        var points, rot, to_border;
        points = [];
        to_border = Face.normal(this.face).mul(-0.5);
        rot = Face.orientation(this.face);
        if (this.connections & Wire.RIGHT) {
            points.push(this.position.plus(to_border.plus(rot.rotate(new Vector(0.5, 0, 0)))));
        }
        if (this.connections & Wire.LEFT) {
            points.push(this.position.plus(to_border.plus(rot.rotate(new Vector(-0.5, 0, 0)))));
        }
        if (this.connections & Wire.UP) {
            points.push(this.position.plus(to_border.plus(rot.rotate(new Vector(0, 0.5, 0)))));
        }
        if (this.connections & Wire.DOWN) {
            points.push(this.position.plus(to_border.plus(rot.rotate(new Vector(0, -0.5, 0)))));
        }
        return points;
    };

    return Wire;

})(Item);

module.exports = Wire;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lyZS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU1BLElBQUEsOENBQUE7SUFBQTs7O0FBQUEsSUFBQSxHQUFXLE9BQUEsQ0FBUSxRQUFSOztBQUNYLElBQUEsR0FBVyxPQUFBLENBQVEsUUFBUjs7QUFDWCxJQUFBLEdBQVcsT0FBQSxDQUFRLFFBQVI7O0FBQ1gsSUFBQSxHQUFXLE9BQUEsQ0FBUSxRQUFSOztBQUNYLE1BQUEsR0FBVyxPQUFBLENBQVEsY0FBUjs7QUFDWCxRQUFBLEdBQVcsT0FBQSxDQUFRLFlBQVI7O0FBRUw7OztJQUVGLElBQUMsQ0FBQSxFQUFELEdBQWE7O0lBQ2IsSUFBQyxDQUFBLEtBQUQsR0FBYTs7SUFDYixJQUFDLENBQUEsSUFBRCxHQUFhOztJQUNiLElBQUMsQ0FBQSxJQUFELEdBQWE7O0lBQ2IsSUFBQyxDQUFBLFFBQUQsR0FBYTs7SUFDYixJQUFDLENBQUEsVUFBRCxHQUFhOztJQUNiLElBQUMsQ0FBQSxHQUFELEdBQWE7O0lBRVYsY0FBQyxJQUFELEVBQWUsV0FBZjtRQUFDLElBQUMsQ0FBQSxzQkFBRCxPQUFNLElBQUksQ0FBQztRQUFHLElBQUMsQ0FBQSxvQ0FBRCxjQUFhLElBQUksQ0FBQztRQUNoQyxJQUFDLENBQUEsSUFBRCxHQUFVO1FBQ1YsSUFBQyxDQUFBLE1BQUQsR0FBVTtRQUNWLElBQUMsQ0FBQSxLQUFELEdBQVU7UUFFVix1Q0FBQSxTQUFBO1FBRUEsSUFBQyxDQUFBLGdCQUFELEdBQW9CLElBQUMsQ0FBQSxnQkFBRCxDQUFrQixLQUFsQjtRQUNwQixJQUFDLENBQUEsZUFBRCxHQUFvQixJQUFDLENBQUEsZ0JBQUQsQ0FBa0IsSUFBbEI7UUFDcEIsSUFBQyxDQUFBLGNBQUQsR0FBb0IsSUFBQyxDQUFBLGdCQUFELENBQWtCLFVBQWxCO0lBVHJCOzttQkFXSCxVQUFBLEdBQVksU0FBQTtBQUNSLFlBQUE7UUFBQSxDQUFBLEdBQUk7UUFDSixJQUFB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QUFwQixDQUFYLENBQWYsQ0FBZixDQUFaLEVBREo7O2VBRUE7SUFaYzs7OztHQXhISDs7QUFzSW5CLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyAwMDAgICAwMDAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMFxuIyAwMDAgMCAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIFxuIyAwMDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwIFxuIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIFxuIyAwMCAgICAgMDAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMFxuXG5JdGVtICAgICA9IHJlcXVpcmUgJy4vaXRlbSdcbkdlb20gICAgID0gcmVxdWlyZSAnLi9nZW9tJ1xuRmFjZSAgICAgPSByZXF1aXJlICcuL2ZhY2UnXG5HYXRlICAgICA9IHJlcXVpcmUgJy4vZ2F0ZSdcblZlY3RvciAgID0gcmVxdWlyZSAnLi9saWIvdmVjdG9yJ1xuTWF0ZXJpYWwgPSByZXF1aXJlICcuL21hdGVyaWFsJ1xuXG5jbGFzcyBXaXJlIGV4dGVuZHMgSXRlbVxuXG4gICAgQFVQICAgICAgICAgPTFcbiAgICBAUklHSFQgICAgICA9MiBcbiAgICBARE9XTiAgICAgICA9NFxuICAgIEBMRUZUICAgICAgID04XG4gICAgQFZFUlRJQ0FMICAgPTVcbiAgICBASE9SSVpPTlRBTCA9MTBcbiAgICBAQUxMICAgICAgICA9MTVcbiAgICBcbiAgICBAOiAoQGZhY2U9RmFjZS5aLCBAY29ubmVjdGlvbnM9V2lyZS5BTEwpIC0+XG4gICAgICAgIEBnbG93ICAgPSBudWxsXG4gICAgICAgIEBhY3RpdmUgPSBmYWxzZVxuICAgICAgICBAdmFsdWUgID0gMS4wXG4gICAgICAgIFxuICAgICAgICBzdXBlciBcbiAgICBcbiAgICAgICAgQFNXSVRDSF9PRkZfRVZFTlQgPSBAYWRkRXZlbnRXaXRoTmFtZSBcIm9mZlwiXG4gICAgICAgIEBTV0lUQ0hfT05fRVZFTlQgID0gQGFkZEV2ZW50V2l0aE5hbWUgXCJvblwiXG4gICAgICAgIEBTV0lUQ0hFRF9FVkVOVCAgID0gQGFkZEV2ZW50V2l0aE5hbWUgXCJzd2l0Y2hlZFwiXG4gICAgXG4gICAgY3JlYXRlTWVzaDogLT5cbiAgICAgICAgbyA9IDAuMDA1XG4gICAgICAgIGdlb20gPSBuZXcgVEhSRUUuR2VvbWV0cnlcbiAgICAgICAgXG4gICAgICAgIGggPSAwLjFcbiAgICAgICAgcyA9IDAuNVxuICAgICAgICB3ID0gcytvXG4gICAgICAgIFxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLlJJR0hUIFxuICAgICAgICAgICAgcGxhbmUgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSAgdywgaFxuICAgICAgICAgICAgcGxhbmUudHJhbnNsYXRlIHcvMiwgMCwgLXMrb1xuICAgICAgICAgICAgZ2VvbS5tZXJnZSBwbGFuZVxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLkxFRlQgICBcbiAgICAgICAgICAgIHBsYW5lID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkgIHcsIGhcbiAgICAgICAgICAgIHBsYW5lLnRyYW5zbGF0ZSAtdy8yLCAwLCAtcytvXG4gICAgICAgICAgICBnZW9tLm1lcmdlIHBsYW5lXG4gICAgICAgIGlmIEBjb25uZWN0aW9ucyAmIFdpcmUuVVAgXG4gICAgICAgICAgICBwbGFuZSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5ICBoLCB3XG4gICAgICAgICAgICBwbGFuZS50cmFuc2xhdGUgMCwgdy8yLCAtcytvXG4gICAgICAgICAgICBnZW9tLm1lcmdlIHBsYW5lXG4gICAgICAgIGlmIEBjb25uZWN0aW9ucyAmIFdpcmUuRE9XTiAgICBcbiAgICAgICAgICAgIHBsYW5lID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkgaCwgd1xuICAgICAgICAgICAgcGxhbmUudHJhbnNsYXRlIDAsIC13LzIsIC1zK29cbiAgICAgICAgICAgIGdlb20ubWVyZ2UgcGxhbmVcbiAgICAgICAgXG4gICAgICAgIEB3aXJlID0gbmV3IFRIUkVFLk1lc2ggZ2VvbSwgICAgICAgIE1hdGVyaWFsLndpcmUgICAgICAgICAgICBcbiAgICAgICAgQG1lc2ggPSBuZXcgVEhSRUUuTWVzaCBHZW9tLndpcmUoKSwgTWF0ZXJpYWwud2lyZVBsYXRlXG4gICAgICAgIEBtZXNoLmFkZCBAd2lyZVxuICAgICAgICBAbWVzaC5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgICAgICBAbWVzaC5wb3NpdGlvbi5jb3B5IEZhY2Uubm9ybWFsKEBmYWNlKS5tdWwgLSgwLjUrbylcbiAgICAgICAgQG1lc2gucXVhdGVybmlvbi5jb3B5IEZhY2Uub3JpZW50YXRpb24gQGZhY2VcbiAgICAgICAgXG4gICAgdXBkYXRlQWN0aXZlOiAtPlxuICAgICAgICBcbiAgICAgICAgZm9yIHdpcmUgaW4gQG5laWdoYm9yV2lyZXMoKVxuICAgICAgICAgICAgQHNldEFjdGl2ZSB0cnVlIGlmIHdpcmUuYWN0aXZlXG4gICAgXG4gICAgc2V0QWN0aXZlOiAoYWN0aXZlKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQGFjdGl2ZSAhPSBhY3RpdmVcbiAgICAgICAgICAgIEBhY3RpdmUgPSBhY3RpdmVcbiAgICAgICAgICAgIG5laWdoYm9ycyA9IEBuZWlnaGJvcldpcmVzKClcblxuICAgICAgICAgICAgZm9yIHdpcmUgaW4gbmVpZ2hib3JzXG4gICAgICAgICAgICAgICAgd2lyZS5zZXRBY3RpdmUgQGFjdGl2ZVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGdhdGUgPSB3b3JsZC5nZXRPYmplY3RPZlR5cGVBdFBvcyBHYXRlLCBAZ2V0UG9zKClcbiAgICAgICAgICAgIGdhdGU/LnNldEFjdGl2ZSBAYWN0aXZlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIEBhY3RpdmVcbiAgICAgICAgICAgICAgICBpZiBub3QgQGdsb3c/XG4gICAgICAgICAgICAgICAgICAgIEBnbG93ID0gbmV3IFRIUkVFLlNwcml0ZSBNYXRlcmlhbC5nbG93XG4gICAgICAgICAgICAgICAgICAgIEBnbG93LnBvc2l0aW9uLnNldCAwLCAwLCAtMC4zXG4gICAgICAgICAgICAgICAgICAgIEBnbG93LnNjYWxlLnNldCAuNSwgLjUsIDFcbiAgICAgICAgICAgICAgICAgICAgQGdsb3cucmVuZGVyT3JkZXIgPSA5OTlcbiAgICAgICAgICAgICAgICAgICAgQG1lc2guYWRkIEBnbG93XG4gICAgICAgICAgICBlbHNlIGlmIEBnbG93P1xuICAgICAgICAgICAgICAgIEBtZXNoLnJlbW92ZSBAZ2xvd1xuICAgICAgICAgICAgICAgIEBnbG93ID0gbnVsbFxuICAgIFxuICAgICAgICAgICAgQGV2ZW50c1tAYWN0aXZlIGFuZCBAU1dJVENIX09OX0VWRU5UIG9yIEBTV0lUQ0hfT0ZGX0VWRU5UXS50cmlnZ2VyQWN0aW9ucygpXG4gICAgICAgICAgICBAZXZlbnRzW0BTV0lUQ0hFRF9FVkVOVF0udHJpZ2dlckFjdGlvbnMoKVxuICAgIFxuICAgIG5laWdoYm9yV2lyZXM6IC0+XG4gICAgICAgIFxuICAgICAgICB3aXJlcyA9IFtdXG4gICAgICAgIHBvaW50cyA9IEBjb25uZWN0aW9uUG9pbnRzKClcblxuICAgICAgICBuZWlnaGJvcl9kaXJzID0gW11cbiAgICAgICAgIFxuICAgICAgICByb3QgPSBGYWNlLm9yaWVudGF0aW9uRm9yRmFjZSBAZmFjZVxuICAgICAgICBuICAgPSBGYWNlLm5vcm1hbFZlY3RvckZvckZhY2UgQGZhY2VcbiAgICBcbiAgICAgICAgbmVpZ2hib3JfZGlycy5wdXNoIG5ldyBWZWN0b3IgMCwwLDAgXG4gICAgICAgICBcbiAgICAgICAgaWYgQGNvbm5lY3Rpb25zICYgV2lyZS5SSUdIVCBcbiAgICAgICAgICAgIG5laWdoYm9yX2RpcnMucHVzaCByb3Qucm90YXRlIG5ldyBWZWN0b3IoMSwwLDApXG4gICAgICAgICAgICBuZWlnaGJvcl9kaXJzLnB1c2ggcm90LnJvdGF0ZShuZXcgVmVjdG9yKDEsMCwwKSkubWludXMgblxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLkxFRlQgIFxuICAgICAgICAgICAgbmVpZ2hib3JfZGlycy5wdXNoIHJvdC5yb3RhdGUgbmV3IFZlY3RvcigtMSwwLDApXG4gICAgICAgICAgICBuZWlnaGJvcl9kaXJzLnB1c2ggcm90LnJvdGF0ZShuZXcgVmVjdG9yKC0xLDAsMCkpLm1pbnVzIG5cbiAgICAgICAgaWYgQGNvbm5lY3Rpb25zICYgV2lyZS5VUCAgICBcbiAgICAgICAgICAgIG5laWdoYm9yX2RpcnMucHVzaCByb3Qucm90YXRlIG5ldyBWZWN0b3IoMCwxLDApXG4gICAgICAgICAgICBuZWlnaGJvcl9kaXJzLnB1c2ggcm90LnJvdGF0ZShuZXcgVmVjdG9yKDAsMSwwKSkubWludXMgblxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLkRPV05cbiAgICAgICAgICAgIG5laWdoYm9yX2RpcnMucHVzaCByb3Qucm90YXRlIG5ldyBWZWN0b3IoMCwtMSwwKVxuICAgICAgICAgICAgbmVpZ2hib3JfZGlycy5wdXNoIHJvdC5yb3RhdGUobmV3IFZlY3RvcigwLC0xLDApKS5taW51cyBuXG4gICAgICAgICBcbiAgICAgICAgZm9yIGkgaW4gWzAuLi5uZWlnaGJvcl9kaXJzLmxlbmd0aF1cbiAgICAgICAgICAgIG5laWdoYm9ycyA9IHdvcmxkLmdldE9iamVjdHNPZlR5cGVBdFBvcyBXaXJlLCBAcG9zaXRpb24ucGx1cyBuZWlnaGJvcl9kaXJzW2ldXG4gICAgICAgICAgICBmb3IgaXRlciBpbiBuZWlnaGJvcnNcbiAgICAgICAgICAgICAgICBjb250aW51ZSBpZiBpdGVyID09IEBcbiAgICAgICAgICAgICAgICBuZWlnaGJvcl9wb2ludHMgPSBpdGVyLmNvbm5lY3Rpb25Qb2ludHMoKVxuICAgICAgICAgICAgICAgIGZvciBwb2ludCBpbiBwb2ludHNcbiAgICAgICAgICAgICAgICAgICAgZm9yIG5laWdoYm9yX3BvaW50IGluIG5laWdoYm9yX3BvaW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmVpZ2hib3JfcG9pbnQubWludXMocG9pbnQpLmxlbmd0aCgpIDwgMC4xXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lyZXMucHVzaCBpdGVyXG4gICAgICAgIHdpcmVzXG4gICAgXG4gICAgY29ubmVjdGlvblBvaW50czogLT5cbiAgICAgICAgcG9pbnRzID0gW11cbiAgICAgICAgdG9fYm9yZGVyID0gRmFjZS5ub3JtYWwoQGZhY2UpLm11bCAtMC41XG4gICAgICAgIHJvdCA9IEZhY2Uub3JpZW50YXRpb24gQGZhY2VcbiAgICAgICAgaWYgQGNvbm5lY3Rpb25zICYgV2lyZS5SSUdIVCBcbiAgICAgICAgICAgIHBvaW50cy5wdXNoIEBwb3NpdGlvbi5wbHVzIHRvX2JvcmRlci5wbHVzIHJvdC5yb3RhdGUgbmV3IFZlY3RvciAwLjUsIDAsIDBcbiAgICAgICAgaWYgQGNvbm5lY3Rpb25zICYgV2lyZS5MRUZUXG4gICAgICAgICAgICBwb2ludHMucHVzaCBAcG9zaXRpb24ucGx1cyB0b19ib3JkZXIucGx1cyByb3Qucm90YXRlIG5ldyBWZWN0b3IgLTAuNSwgMCwgMFxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLlVQIFxuICAgICAgICAgICAgcG9pbnRzLnB1c2ggQHBvc2l0aW9uLnBsdXMgdG9fYm9yZGVyLnBsdXMgcm90LnJvdGF0ZSBuZXcgVmVjdG9yIDAsIDAuNSwgMFxuICAgICAgICBpZiBAY29ubmVjdGlvbnMgJiBXaXJlLkRPV05cbiAgICAgICAgICAgIHBvaW50cy5wdXNoIEBwb3NpdGlvbi5wbHVzIHRvX2JvcmRlci5wbHVzIHJvdC5yb3RhdGUgbmV3IFZlY3RvciAwLCAtMC41LCAwXG4gICAgICAgIHBvaW50c1xuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gV2lyZVxuIl19
//# sourceURL=../coffee/wire.coffee